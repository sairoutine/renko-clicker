!function t(e,i,r){function o(a,s){if(!i[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){var i=e[a][1][t];return o(i?i:t)},h,h.exports,t,e,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,i){"use strict";var r={};r.images={bg_super:"./image/bg_super.png",super_logo:"./image/super_logo.png",renko_base:"./image/renko/base/00.png",renko_eye_00:"./image/renko/eye/00.png",renko_eyebrow_00:"./image/renko/eyebrow/00.png",renko_mouse_00:"./image/renko/mouse/00.png",merry_base:"./image/merry/base/00.png",merry_eye_00:"./image/merry/eye/00.png",merry_eyebrow_00:"./image/merry/eyebrow/00.png",merry_mouse_00:"./image/merry/mouse/00.png"},r.sounds={flash:{path:"./sound/flash",volume:1},got:{path:"./sound/got",volume:1}},r.bgms={},e.exports=r},{}],2:[function(t,e,i){"use strict";var r=t("./debug_constant"),o={DEBUG:{}};r.ON&&(o.DEBUG=r),e.exports=o},{"./debug_constant":3}],3:[function(t,e,i){"use strict";var r={ON:!1};e.exports=r},{}],4:[function(t,e,i){"use strict";var r=t("./hakurei").core,o=t("./hakurei").util,n=t("./scene/main"),a=t("./scene/loading"),s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments)},s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.addScene("loading",new a(this)),this.addScene("main",new n(this)),this.changeScene("loading")},e.exports=s},{"./hakurei":5,"./scene/loading":42,"./scene/main":43}],5:[function(t,e,i){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":13}],6:[function(t,e,i){"use strict";var r=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0,this.audio_context=null,window&&window.AudioContext&&(this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode),this._playing_bgm_name=null,this.audio_source=null};r.prototype.init=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0,this._playing_bgm_name=null,this.audio_source=null},r.prototype.loadSound=function(t,e,i){var r=this;r.loading_audio_num++,i||(i=1);var o=function(){r.loaded_audio_num++},n=new Audio(e);n.volume=i,n.addEventListener("canplay",o),n.load(),r.sounds[t]={id:1<<r.id++,audio:n}},r.prototype.loadBGM=function(t,e,i,r,o){var n=this;n.loading_audio_num++;var a=function(e){n.loaded_audio_num++,n.bgms[t]={audio:e,volume:i,loopStart:r,loopEnd:o}},s=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;n.audio_context.decodeAudioData(t,a,s)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)},r.prototype.isAllLoaded=function(){return this.loaded_audio_num===this.loading_audio_num},r.prototype.playSound=function(t){this.soundflag|=this.sounds[t].id},r.prototype.executePlaySound=function(){for(var t in this.sounds)this.soundflag&this.sounds[t].id&&(this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),this.soundflag&=~this.sounds[t].id)},r.prototype.playBGM=function(t){var e=this;e.stopBGM(),e._playing_bgm_name=t,e.audio_source=e._createSourceNode(t),e.audio_source.start(0)},r.prototype.changeBGM=function(t){this._playing_bgm_name!==t&&this.playBGM(t)},r.prototype.stopBGM=function(){var t=this;t.isPlayingBGM()&&(t.audio_source.stop(0),t.audio_source=null,t._playing_bgm_name=null)},r.prototype.isPlayingBGM=function(){return this.audio_source?!0:!1},r.prototype.currentPlayingBGM=function(){return this._playing_bgm_name},r.prototype._createSourceNode=function(t){var e=this,i=e.bgms[t],r=e.audio_context.createBufferSource();r.buffer=i.audio,(i.loopStart||i.loopEnd)&&(r.loop=!0),i.loopStart&&(r.loopStart=i.loopStart),i.loopEnd&&(r.loopEnd=i.loopEnd);var o=this.audio_context.createGain();return o.gain.value=i.volume||1,r.connect(o),o.connect(e.audio_context.destination),r.start=r.start||r.noteOn,r.stop=r.stop||r.noteOff,r},r.prototype.progress=function(){return this.loaded_audio_num/this.loading_audio_num},e.exports=r},{}],7:[function(t,e,i){"use strict";var r=function(){this.is_done=!1};r.prototype.init=function(){this.is_done=!1},r.prototype.isAllLoaded=function(){return this.is_done},r.prototype.notifyLoadingDone=function(){this.is_done=!0},r.prototype.progress=function(){return this.is_done?1:0},e.exports=r},{}],8:[function(t,e,i){"use strict";var r=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};r.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},r.prototype.loadImage=function(t,e){var i=this;i.loading_image_num++;var r=function(){i.loaded_image_num++},o=new Image;o.src=e,o.onload=r,this.images[t]=o},r.prototype.isAllLoaded=function(){return this.loaded_image_num===this.loading_image_num},r.prototype.getImage=function(t){return this.images[t]},r.prototype.progress=function(){return this.loaded_image_num/this.loading_image_num},e.exports=r},{}],9:[function(t,e,i){"use strict";var r={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=r},{}],10:[function(t,e,i){"use strict";var r={SPRITE3D:{}};r.SPRITE3D.V_ITEM_SIZE=3,r.SPRITE3D.V_ITEM_NUM=4,r.SPRITE3D.V_SIZE=r.SPRITE3D.V_ITEM_SIZE*r.SPRITE3D.V_ITEM_NUM,r.SPRITE3D.C_ITEM_SIZE=2,r.SPRITE3D.C_ITEM_NUM=4,r.SPRITE3D.C_SIZE=r.SPRITE3D.C_ITEM_SIZE*r.SPRITE3D.C_ITEM_NUM,r.SPRITE3D.I_ITEM_SIZE=1,r.SPRITE3D.I_ITEM_NUM=6,r.SPRITE3D.I_SIZE=r.SPRITE3D.I_ITEM_SIZE*r.SPRITE3D.I_ITEM_NUM,r.SPRITE3D.A_ITEM_SIZE=4,r.SPRITE3D.A_ITEM_NUM=4,r.SPRITE3D.A_SIZE=r.SPRITE3D.A_ITEM_SIZE*r.SPRITE3D.A_ITEM_NUM,e.exports=r},{}],11:[function(t,e,i){"use strict";var r=t("webgl-debug"),o=(t("./constant"),t("./debug_manager")),n=t("./input_manager"),a=t("./asset_loader/image"),s=t("./asset_loader/audio"),u=t("./asset_loader/font"),c=t("./scene/loading"),h=t("./shader_program"),l=t("./shader/main.vs"),f=t("./shader/main.fs"),_=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?(this.gl=this.createWebGLContext(this.canvas_dom),this.sprite_3d_shader=new h(this.gl,l,f,["aTextureCoordinates","aVertexPosition","aColor"],["uMVMatrix","uPMatrix","uSampler"])):this.ctx=this.canvas_dom.getContext("2d"),this.debug_manager=new o(this),this.input_manager=new n,this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this.frame_count=0,this.request_id=null,this.image_loader=new a,this.audio_loader=new s,this.font_loader=new u};_.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.frame_count=0,this.request_id=null,this.input_manager.init(),this.image_loader.init(),this.audio_loader.init(),this.font_loader.init(),this.addScene("loading",new c(this))},_.prototype.isRunning=function(){return this.request_id?!0:!1},_.prototype.startRun=function(){this.isRunning()||this.run()},_.prototype.stopRun=function(){this.isRunning()&&(cancelAnimationFrame(this.request_id),this.request_id=null)},_.prototype.run=function(){this.input_manager.beforeRun(),this.changeNextSceneIfReserved(),this.audio_loader.executePlaySound();var t=this.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw()),this.frame_count++,this.input_manager.afterRun(),this.request_id=requestAnimationFrame(this.run.bind(this))},_.prototype.currentScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},_.prototype.addScene=function(t,e){this.scenes[t]=e},_.prototype.changeScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},_.prototype.changeNextSceneIfReserved=function(){if(this._reserved_next_scene)if(this.currentScene()&&this.currentScene().isSetFadeOut()&&!this.currentScene().isInFadeOut())this.currentScene().startFadeOut();else if(this.currentScene()&&this.currentScene().isSetFadeOut()&&this.currentScene().isInFadeOut());else{this.current_scene=this._reserved_next_scene.shift();var t=this.currentScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},_.prototype.changeSceneWithLoading=function(t,e){e||(e={}),this.changeScene("loading",e,t)},_.prototype.clearCanvas=function(){this.is2D()?this.ctx.clearRect(0,0,this.width,this.height):this.is3D()&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))},_.prototype.is2D=function(){return this.ctx?!0:!1},_.prototype.is3D=function(){return this.gl?!0:!1},_.prototype.isKeyDown=function(t){return this.input_manager.isKeyDown(t)},_.prototype.isKeyPush=function(t){return this.input_manager.isKeyPush(t)},_.prototype.getKeyDownTime=function(t){return this.input_manager.getKeyDownTime(t)},_.prototype.isLeftClickDown=function(){return this.input_manager.isLeftClickDown()},_.prototype.isLeftClickPush=function(){return this.input_manager.isLeftClickPush()},_.prototype.isRightClickDown=function(){return this.input_manager.isRightClickDown()},_.prototype.isRightClickPush=function(){return this.input_manager.isRightClickPush()},_.prototype.mousePositionX=function(){return this.input_manager.mousePositionX()},_.prototype.mousePositionY=function(){return this.input_manager.mousePositionX()},_.prototype.mouseMoveX=function(){return this.input_manager.mouseMoveX()},_.prototype.mouseMoveY=function(){return this.input_manager.mouseMoveY()},_.prototype.mouseScroll=function(){return this.input_manager.mouseScroll()},_.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},_.prototype.fontLoadingDone=function(){this.font_loader.notifyLoadingDone()},_.prototype.setupEvents=function(){if(window){var t=this;window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),window.document&&window.document.fonts&&!navigator.userAgent.toLowerCase().indexOf("safari")?window.document.fonts.addEventListener("loadingdone",function(){t.fontLoadingDone()}):t.fontLoadingDone(),this.input_manager.setupEvents(this.canvas_dom)}},_.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=r.makeDebugContext(e)}catch(i){throw i}if(!e)throw new Error("Could not initialize WebGL");return e},e.exports=_},{"./asset_loader/audio":6,"./asset_loader/font":7,"./asset_loader/image":8,"./constant":9,"./debug_manager":12,"./input_manager":14,"./scene/loading":33,"./shader/main.fs":35,"./shader/main.vs":36,"./shader_program":37,"webgl-debug":25}],12:[function(t,e,i){"use strict";var r=function(t){this.core=t,this.dom=null,this.is_debug_mode=!1};r.prototype.setOn=function(t){this.is_debug_mode=!0,this.dom=t},r.prototype.setOff=function(){this.is_debug_mode=!1,this.dom=null},r.prototype.addMenuText=function(t){if(this.is_debug_mode){var e=window.document.createElement("pre");e.textContent=t,this.dom.appendChild(e)}},r.prototype.addMenuButton=function(t,e){if(this.is_debug_mode){var i=this.core,r=window.document.createElement("input");r.setAttribute("type","button"),r.setAttribute("value",t),r.onclick=function(){e(i)},this.dom.appendChild(r)}},e.exports=r},{}],13:[function(t,e,i){"use strict";e.exports={util:t("./util"),core:t("./core"),constant:t("./constant"),serif_manager:t("./serif_manager"),shader_program:t("./shader_program"),scene:{base:t("./scene/base"),loading:t("./scene/loading")},object:{base:t("./object/base"),sprite:t("./object/sprite"),sprite3d:t("./object/sprite3d"),pool_manager:t("./object/pool_manager"),pool_manager3d:t("./object/pool_manager3d"),ui_parts:t("./object/ui_parts")},asset_loader:{image:t("./asset_loader/image"),audio:t("./asset_loader/audio"),font:t("./asset_loader/font")},storage:{base:t("./storage/base"),save:t("./storage/save")}}},{"./asset_loader/audio":6,"./asset_loader/font":7,"./asset_loader/image":8,"./constant":9,"./core":11,"./object/base":26,"./object/pool_manager":27,"./object/pool_manager3d":28,"./object/sprite":29,"./object/sprite3d":30,"./object/ui_parts":31,"./scene/base":32,"./scene/loading":33,"./serif_manager":34,"./shader_program":37,"./storage/base":38,"./storage/save":39,"./util":40}],14:[function(t,e,i){"use strict";var r=t("./constant"),o=t("./util"),n={0:r.BUTTON_Z,1:r.BUTTON_X,2:r.BUTTON_SPACE,3:r.BUTTON_SHIFT},a=function(){this.current_keyflag=0,this.before_keyflag=0,this._key_bit_code_to_down_time={},this._button_id_to_key_bit_code=o.shallowCopyHash(n),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0,this.is_connect_gamepad=!1};a.prototype.init=function(){this.current_keyflag=0,this.before_keyflag=0,this.initPressedKeyTime(),this._button_id_to_key_bit_code=o.shallowCopyHash(n),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0,this.is_connect_gamepad=!1},a.prototype.enableGamePad=function(){this.is_connect_gamepad=!0},a.prototype.beforeRun=function(){this.handleGamePad(),this.handlePressedKeyTime()},a.prototype.afterRun=function(){this.before_keyflag=this.current_keyflag,this.before_is_left_clicked=this.is_left_clicked,this.before_is_right_clicked=this.is_right_clicked,this.mouse_scroll=0,this.mouse_change_x=0,this.mouse_change_y=0},a.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},a.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},a.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},a.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},a.prototype.getKeyDownTime=function(t){return this._key_bit_code_to_down_time[t]},a.prototype.handleMouseDown=function(t){"which"in t?(this.is_left_clicked=1===t.which,this.is_right_clicked=3===t.which):"button"in t&&(this.is_left_clicked=1===t.button,this.is_right_clicked=2===t.button),t.preventDefault()},a.prototype.handleMouseUp=function(t){"which"in t?(this.is_left_clicked=1===t.which?!1:this.is_left_clicked,this.is_right_clicked=3===t.which?!1:this.is_right_clicked):"button"in t&&(this.is_left_clicked=1===t.button?!1:this.is_left_clicked,this.is_right_clicked=2===t.button?!1:this.is_right_clicked),t.preventDefault()},a.prototype.isLeftClickDown=function(){return this.is_left_clicked},a.prototype.isLeftClickPush=function(){return this.is_left_clicked&&!this.before_is_left_clicked},a.prototype.isRightClickDown=function(){return this.is_right_clicked},a.prototype.isRightClickPush=function(){return this.is_right_clicked&&!this.before_is_right_clicked},a.prototype.handleMouseMove=function(t){t=t?t:window.event,t.preventDefault(),this.mouse_change_x=this.mouse_x-t.clientX,this.mouse_change_y=this.mouse_y-t.clientY,this.mouse_x=t.clientX,this.mouse_y=t.clientY},a.prototype.mousePositionX=function(){return this.mouse_x},a.prototype.mousePositionY=function(){return this.mouse_y},a.prototype.mouseMoveX=function(){return this.mouse_change_x},a.prototype.mouseMoveY=function(){return this.mouse_change_y},a.prototype.handleMouseWheel=function(t){this.mouse_scroll=t.detail?t.detail:-t.wheelDelta/120},a.prototype.mouseScroll=function(){return this.mouse_scroll},a.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=r.BUTTON_SHIFT;break;case 32:e=r.BUTTON_SPACE;break;case 37:e=r.BUTTON_LEFT;break;case 38:e=r.BUTTON_UP;break;case 39:e=r.BUTTON_RIGHT;break;case 40:e=r.BUTTON_DOWN;break;case 88:e=r.BUTTON_X;break;case 90:e=r.BUTTON_Z}return e},a.prototype.handleGamePad=function(){if(this.is_connect_gamepad){var t=window.navigator.getGamepads(),e=t[0];if(e){for(var i=0,o=e.buttons.length;o>i;i++)i in this._button_id_to_key_bit_code&&(e.buttons[i].pressed?this.current_keyflag|=this.getKeyByButtonId(i):this.current_keyflag&=~this.getKeyByButtonId(i));e.axes[1]<-.5?this.current_keyflag|=r.BUTTON_UP:this.current_keyflag&=~r.BUTTON_UP,e.axes[1]>.5?this.current_keyflag|=r.BUTTON_DOWN:this.current_keyflag&=~r.BUTTON_DOWN,e.axes[0]<-.5?this.current_keyflag|=r.BUTTON_LEFT:this.current_keyflag&=~r.BUTTON_LEFT,e.axes[0]>.5?this.current_keyflag|=r.BUTTON_RIGHT:this.current_keyflag&=~r.BUTTON_RIGHT}}},a.prototype.initPressedKeyTime=function(){this._key_bit_code_to_down_time={};for(var t in r){var e=r[t];this._key_bit_code_to_down_time[e]=0}},a.prototype.handlePressedKeyTime=function(){for(var t in r){var e=r[t];this.isKeyDown(e)?this._key_bit_code_to_down_time[e]++:this._key_bit_code_to_down_time[e]=0}},a.prototype.setupEvents=function(t){var e=this;window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){e.handleKeyUp(t)},t.onmousedown=function(t){e.handleMouseDown(t)},t.onmouseup=function(t){e.handleMouseUp(t)},t.onmousemove=function(t){e.handleMouseMove(t)};var i=window.navi&&/Firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener&&t.addEventListener(i,function(t){var i=window.event||t;e.handleMouseWheel(i)},!1),window.Gamepad&&window.navigator&&window.navigator.getGamepads&&e.enableGamePad()},a.prototype.getKeyByButtonId=function(t){var e=this._button_id_to_key_bit_code[t];return e||(e=0),e},a.prototype.getAnyButtonId=function(){if(this.is_connect_gamepad){var t=window.navigator.getGamepads(),e=t[0];if(e)for(var i=0;i<e.buttons.length;i++)if(e.buttons[i].pressed)return i}},e.exports=a},{"./constant":9,"./util":40}],15:[function(t,e,i){i.glMatrix=t("./gl-matrix/common.js"),i.mat2=t("./gl-matrix/mat2.js"),i.mat2d=t("./gl-matrix/mat2d.js"),i.mat3=t("./gl-matrix/mat3.js"),i.mat4=t("./gl-matrix/mat4.js"),i.quat=t("./gl-matrix/quat.js"),i.vec2=t("./gl-matrix/vec2.js"),i.vec3=t("./gl-matrix/vec3.js"),i.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":16,"./gl-matrix/mat2.js":17,"./gl-matrix/mat2d.js":18,"./gl-matrix/mat3.js":19,"./gl-matrix/mat4.js":20,"./gl-matrix/quat.js":21,"./gl-matrix/vec2.js":22,"./gl-matrix/vec3.js":23,"./gl-matrix/vec4.js":24}],16:[function(t,e,i){var r={};r.EPSILON=1e-6,r.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,r.RANDOM=Math.random,r.ENABLE_SIMD=!1,r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this,r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE,r.setMatrixArrayType=function(t){r.ARRAY_TYPE=t};var o=Math.PI/180;r.toRadian=function(t){return t*o},r.equals=function(t,e){return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=r},{}],17:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},o.fromValues=function(t,e,i,o){var n=new r.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=o,n},o.set=function(t,e,i,r,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=o,t},o.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},o.invert=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=i*n-o*r;return a?(a=1/a,t[0]=n*a,t[1]=-r*a,t[2]=-o*a,t[3]=i*a,t):null},o.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},o.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},o.multiply=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=i[0],u=i[1],c=i[2],h=i[3];return t[0]=r*s+n*u,t[1]=o*s+a*u,t[2]=r*c+n*h,t[3]=o*c+a*h,t},o.mul=o.multiply,o.rotate=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+n*s,t[1]=o*u+a*s,t[2]=r*-s+n*u,t[3]=o*-s+a*u,t},o.scale=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=i[0],u=i[1];return t[0]=r*s,t[1]=o*s,t[2]=n*u,t[3]=a*u,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},o.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},o.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},o.sub=o.subtract,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},o.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},o.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},e.exports=o},{"./common.js":16}],18:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},o.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},o.fromValues=function(t,e,i,o,n,a){var s=new r.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=i,s[3]=o,s[4]=n,s[5]=a,s},o.set=function(t,e,i,r,o,n,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=o,t[4]=n,t[5]=a,t},o.invert=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=i*n-r*o;return u?(u=1/u,t[0]=n*u,t[1]=-r*u,t[2]=-o*u,t[3]=i*u,t[4]=(o*s-n*a)*u,t[5]=(r*a-i*s)*u,t):null},o.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},o.multiply=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=i[0],h=i[1],l=i[2],f=i[3],_=i[4],d=i[5];return t[0]=r*c+n*h,t[1]=o*c+a*h,t[2]=r*l+n*f,t[3]=o*l+a*f,t[4]=r*_+n*d+s,t[5]=o*_+a*d+u,t},o.mul=o.multiply,o.rotate=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=o*h+a*c,t[2]=r*-c+n*h,t[3]=o*-c+a*h,t[4]=s,t[5]=u,t},o.scale=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=o*c,t[2]=n*h,t[3]=a*h,t[4]=s,t[5]=u,t},o.translate=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=o,t[2]=n,t[3]=a,t[4]=r*c+n*h+s,t[5]=o*c+a*h+u,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},o.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},o.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=e[0],h=e[1],l=e[2],f=e[3],_=e[4],d=e[5];return Math.abs(i-c)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(n-l)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-f)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-_)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(u-d)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))},e.exports=o},{"./common.js":16}],19:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},o.fromValues=function(t,e,i,o,n,a,s,u,c){var h=new r.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=i,h[3]=o,h[4]=n,h[5]=a,h[6]=s,h[7]=u,h[8]=c,h},o.set=function(t,e,i,r,o,n,a,s,u,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=o,t[4]=n,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.invert=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*a-s*c,f=-h*n+s*u,_=c*n-a*u,d=i*l+r*f+o*_;return d?(d=1/d,t[0]=l*d,t[1]=(-h*r+o*c)*d,t[2]=(s*r-o*a)*d,t[3]=f*d,t[4]=(h*i-o*u)*d,t[5]=(-s*i+o*n)*d,t[6]=_*d,t[7]=(-c*i+r*u)*d,t[8]=(a*i-r*n)*d,t):null},o.adjoint=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=a*h-s*c,t[1]=o*c-r*h,t[2]=r*s-o*a,t[3]=s*u-n*h,t[4]=i*h-o*u,t[5]=o*n-i*s,t[6]=n*c-a*u,t[7]=r*u-i*c,t[8]=i*a-r*n,t},o.determinant=function(t){var e=t[0],i=t[1],r=t[2],o=t[3],n=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*n-a*u)+i*(-c*o+a*s)+r*(u*o-n*s)},o.multiply=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=i[0],_=i[1],d=i[2],p=i[3],m=i[4],M=i[5],g=i[6],x=i[7],S=i[8];return t[0]=f*r+_*a+d*c,t[1]=f*o+_*s+d*h,t[2]=f*n+_*u+d*l,t[3]=p*r+m*a+M*c,t[4]=p*o+m*s+M*h,t[5]=p*n+m*u+M*l,t[6]=g*r+x*a+S*c,t[7]=g*o+x*s+S*h,t[8]=g*n+x*u+S*l,t},o.mul=o.multiply,o.translate=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=i[0],_=i[1];return t[0]=r,t[1]=o,t[2]=n,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+_*a+c,t[7]=f*o+_*s+h,t[8]=f*n+_*u+l,t},o.rotate=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(i),_=Math.cos(i);return t[0]=_*r+f*a,t[1]=_*o+f*s,t[2]=_*n+f*u,t[3]=_*a-f*r,t[4]=_*s-f*o,t[5]=_*u-f*n,t[6]=c,t[7]=h,t[8]=l,t},o.scale=function(t,e,i){var r=i[0],o=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=o*e[3],t[4]=o*e[4],t[5]=o*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},o.fromQuat=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=i+i,s=r+r,u=o+o,c=i*a,h=r*a,l=r*s,f=o*a,_=o*s,d=o*u,p=n*a,m=n*s,M=n*u;return t[0]=1-l-d,t[3]=h-M,t[6]=f+m,t[1]=h+M,t[4]=1-c-d,t[7]=_-p,t[2]=f-m,t[5]=_+p,t[8]=1-c-l,t},o.normalFromMat4=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],_=e[11],d=e[12],p=e[13],m=e[14],M=e[15],g=i*s-r*a,x=i*u-o*a,S=i*c-n*a,b=r*u-o*s,v=r*c-n*s,y=o*c-n*u,I=h*p-l*d,D=h*m-f*d,w=h*M-_*d,F=l*m-f*p,E=l*M-_*p,T=f*M-_*m,A=g*T-x*E+S*F+b*w-v*D+y*I;return A?(A=1/A,t[0]=(s*T-u*E+c*F)*A,t[1]=(u*w-a*T-c*D)*A,t[2]=(a*E-s*w+c*I)*A,t[3]=(o*E-r*T-n*F)*A,t[4]=(i*T-o*w+n*D)*A,t[5]=(r*w-i*E-n*I)*A,t[6]=(p*y-m*v+M*b)*A,t[7]=(m*S-d*y-M*x)*A,t[8]=(d*v-p*S+M*g)*A,t):null},o.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},o.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=t[6],h=t[7],l=t[8],f=e[0],_=e[1],d=e[2],p=e[3],m=e[4],M=e[5],g=t[6],x=e[7],S=e[8];return Math.abs(i-f)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-_)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(n-d)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-M)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-g)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(h-x)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(l-S)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))},e.exports=o},{"./common.js":16}],20:[function(t,e,i){var r=t("./common.js"),o={scalar:{},SIMD:{}};o.create=function(){var t=new r.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.clone=function(t){var e=new r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.fromValues=function(t,e,i,o,n,a,s,u,c,h,l,f,_,d,p,m){var M=new r.ARRAY_TYPE(16);return M[0]=t,M[1]=e,M[2]=i,M[3]=o,M[4]=n,M[5]=a,M[6]=s,M[7]=u,M[8]=c,M[9]=h,M[10]=l,M[11]=f,M[12]=_,M[13]=d,M[14]=p,M[15]=m,M},o.set=function(t,e,i,r,o,n,a,s,u,c,h,l,f,_,d,p,m){return t[0]=e,t[1]=i,t[2]=r,t[3]=o,t[4]=n,t[5]=a,
t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=l,t[11]=f,t[12]=_,t[13]=d,t[14]=p,t[15]=m,t},o.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.scalar.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],o=e[3],n=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=n,t[11]=e[14],t[12]=o,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},o.SIMD.transpose=function(t,e){var i,r,o,n,a,s,u,c,h,l;return i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(o,n,0,1,4,5),u=SIMD.Float32x4.shuffle(a,s,0,2,4,6),c=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,c),a=SIMD.Float32x4.shuffle(i,r,2,3,6,7),s=SIMD.Float32x4.shuffle(o,n,2,3,6,7),h=SIMD.Float32x4.shuffle(a,s,0,2,4,6),l=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,l),t},o.transpose=r.USE_SIMD?o.SIMD.transpose:o.scalar.transpose,o.scalar.invert=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],_=e[11],d=e[12],p=e[13],m=e[14],M=e[15],g=i*s-r*a,x=i*u-o*a,S=i*c-n*a,b=r*u-o*s,v=r*c-n*s,y=o*c-n*u,I=h*p-l*d,D=h*m-f*d,w=h*M-_*d,F=l*m-f*p,E=l*M-_*p,T=f*M-_*m,A=g*T-x*E+S*F+b*w-v*D+y*I;return A?(A=1/A,t[0]=(s*T-u*E+c*F)*A,t[1]=(o*E-r*T-n*F)*A,t[2]=(p*y-m*v+M*b)*A,t[3]=(f*v-l*y-_*b)*A,t[4]=(u*w-a*T-c*D)*A,t[5]=(i*T-o*w+n*D)*A,t[6]=(m*S-d*y-M*x)*A,t[7]=(h*y-f*S+_*x)*A,t[8]=(a*E-s*w+c*I)*A,t[9]=(r*w-i*E-n*I)*A,t[10]=(d*v-p*S+M*g)*A,t[11]=(l*S-h*v-_*g)*A,t[12]=(s*D-a*F-u*I)*A,t[13]=(i*F-r*D+o*I)*A,t[14]=(p*x-d*b-m*g)*A,t[15]=(h*b-l*x+f*g)*A,t):null},o.SIMD.invert=function(t,e){var i,r,o,n,a,s,u,c,h,l,f=SIMD.Float32x4.load(e,0),_=SIMD.Float32x4.load(e,4),d=SIMD.Float32x4.load(e,8),p=SIMD.Float32x4.load(e,12);return a=SIMD.Float32x4.shuffle(f,_,0,1,4,5),r=SIMD.Float32x4.shuffle(d,p,0,1,4,5),i=SIMD.Float32x4.shuffle(a,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,a,1,3,5,7),a=SIMD.Float32x4.shuffle(f,_,2,3,6,7),n=SIMD.Float32x4.shuffle(d,p,2,3,6,7),o=SIMD.Float32x4.shuffle(a,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,a,1,3,5,7),a=SIMD.Float32x4.mul(o,n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.mul(r,a),u=SIMD.Float32x4.mul(i,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),a=SIMD.Float32x4.mul(r,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),s),h=SIMD.Float32x4.mul(i,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,a)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),s),c=SIMD.Float32x4.mul(i,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,a)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),a=SIMD.Float32x4.mul(i,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),c),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),h),a=SIMD.Float32x4.swizzle(a,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),c),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(o,a)),a=SIMD.Float32x4.mul(i,n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(o,a)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),c),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.mul(i,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,a)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),h),l=SIMD.Float32x4.mul(i,s),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),a=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(a,a))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,c)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,h)),t):null},o.invert=r.USE_SIMD?o.SIMD.invert:o.scalar.invert,o.scalar.adjoint=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],_=e[11],d=e[12],p=e[13],m=e[14],M=e[15];return t[0]=s*(f*M-_*m)-l*(u*M-c*m)+p*(u*_-c*f),t[1]=-(r*(f*M-_*m)-l*(o*M-n*m)+p*(o*_-n*f)),t[2]=r*(u*M-c*m)-s*(o*M-n*m)+p*(o*c-n*u),t[3]=-(r*(u*_-c*f)-s*(o*_-n*f)+l*(o*c-n*u)),t[4]=-(a*(f*M-_*m)-h*(u*M-c*m)+d*(u*_-c*f)),t[5]=i*(f*M-_*m)-h*(o*M-n*m)+d*(o*_-n*f),t[6]=-(i*(u*M-c*m)-a*(o*M-n*m)+d*(o*c-n*u)),t[7]=i*(u*_-c*f)-a*(o*_-n*f)+h*(o*c-n*u),t[8]=a*(l*M-_*p)-h*(s*M-c*p)+d*(s*_-c*l),t[9]=-(i*(l*M-_*p)-h*(r*M-n*p)+d*(r*_-n*l)),t[10]=i*(s*M-c*p)-a*(r*M-n*p)+d*(r*c-n*s),t[11]=-(i*(s*_-c*l)-a*(r*_-n*l)+h*(r*c-n*s)),t[12]=-(a*(l*m-f*p)-h*(s*m-u*p)+d*(s*f-u*l)),t[13]=i*(l*m-f*p)-h*(r*m-o*p)+d*(r*f-o*l),t[14]=-(i*(s*m-u*p)-a*(r*m-o*p)+d*(r*u-o*s)),t[15]=i*(s*f-u*l)-a*(r*f-o*l)+h*(r*u-o*s),t},o.SIMD.adjoint=function(t,e){var i,r,o,n,a,s,u,c,h,l,f,_,d,i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(o,n,0,1,4,5),a=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(i,r,2,3,6,7),c=SIMD.Float32x4.shuffle(o,n,2,3,6,7),u=SIMD.Float32x4.shuffle(h,c,0,2,4,6),c=SIMD.Float32x4.shuffle(c,h,1,3,5,7),h=SIMD.Float32x4.mul(u,c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.mul(s,h),f=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),l),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),h=SIMD.Float32x4.mul(s,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),l),d=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(c,h)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),l),_=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,h)),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),_),_=SIMD.Float32x4.swizzle(_,2,3,0,1),h=SIMD.Float32x4.mul(a,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),_),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),d),h=SIMD.Float32x4.swizzle(h,2,3,0,1),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),_),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,h)),h=SIMD.Float32x4.mul(a,c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),_),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),_=SIMD.Float32x4.sub(_,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(a,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,h)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),d),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,_),SIMD.Float32x4.store(t,12,d),t},o.adjoint=r.USE_SIMD?o.SIMD.adjoint:o.scalar.adjoint,o.determinant=function(t){var e=t[0],i=t[1],r=t[2],o=t[3],n=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],_=t[12],d=t[13],p=t[14],m=t[15],M=e*a-i*n,g=e*s-r*n,x=e*u-o*n,S=i*s-r*a,b=i*u-o*a,v=r*u-o*s,y=c*d-h*_,I=c*p-l*_,D=c*m-f*_,w=h*p-l*d,F=h*m-f*d,E=l*m-f*p;return M*E-g*F+x*w+S*D-b*I+v*y},o.SIMD.multiply=function(t,e,i){var r=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(i,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),a))));SIMD.Float32x4.store(t,0,u);var c=SIMD.Float32x4.load(i,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),a))));SIMD.Float32x4.store(t,4,h);var l=SIMD.Float32x4.load(i,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),a))));SIMD.Float32x4.store(t,8,f);var _=SIMD.Float32x4.load(i,12),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),a))));return SIMD.Float32x4.store(t,12,d),t},o.scalar.multiply=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],_=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15],x=i[0],S=i[1],b=i[2],v=i[3];return t[0]=x*r+S*s+b*l+v*p,t[1]=x*o+S*u+b*f+v*m,t[2]=x*n+S*c+b*_+v*M,t[3]=x*a+S*h+b*d+v*g,x=i[4],S=i[5],b=i[6],v=i[7],t[4]=x*r+S*s+b*l+v*p,t[5]=x*o+S*u+b*f+v*m,t[6]=x*n+S*c+b*_+v*M,t[7]=x*a+S*h+b*d+v*g,x=i[8],S=i[9],b=i[10],v=i[11],t[8]=x*r+S*s+b*l+v*p,t[9]=x*o+S*u+b*f+v*m,t[10]=x*n+S*c+b*_+v*M,t[11]=x*a+S*h+b*d+v*g,x=i[12],S=i[13],b=i[14],v=i[15],t[12]=x*r+S*s+b*l+v*p,t[13]=x*o+S*u+b*f+v*m,t[14]=x*n+S*c+b*_+v*M,t[15]=x*a+S*h+b*d+v*g,t},o.multiply=r.USE_SIMD?o.SIMD.multiply:o.scalar.multiply,o.mul=o.multiply,o.scalar.translate=function(t,e,i){var r,o,n,a,s,u,c,h,l,f,_,d,p=i[0],m=i[1],M=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*M+e[12],t[13]=e[1]*p+e[5]*m+e[9]*M+e[13],t[14]=e[2]*p+e[6]*m+e[10]*M+e[14],t[15]=e[3]*p+e[7]*m+e[11]*M+e[15]):(r=e[0],o=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],_=e[10],d=e[11],t[0]=r,t[1]=o,t[2]=n,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=_,t[11]=d,t[12]=r*p+s*m+l*M+e[12],t[13]=o*p+u*m+f*M+e[13],t[14]=n*p+c*m+_*M+e[14],t[15]=a*p+h*m+d*M+e[15]),t},o.SIMD.translate=function(t,e,i){var r=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(i[0],i[1],i[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,0,0,0,0)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,1,1,1,1)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(r,SIMD.Float32x4.add(o,SIMD.Float32x4.add(n,a)));return SIMD.Float32x4.store(t,12,u),t},o.translate=r.USE_SIMD?o.SIMD.translate:o.scalar.translate,o.scalar.scale=function(t,e,i){var r=i[0],o=i[1],n=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.SIMD.scale=function(t,e,i){var r,o,n,a=SIMD.Float32x4(i[0],i[1],i[2],0);return r=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,0,0,0,0))),o=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,1,1,1,1))),n=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(a,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},o.scale=r.USE_SIMD?o.SIMD.scale:o.scalar.scale,o.rotate=function(t,e,i,o){var n,a,s,u,c,h,l,f,_,d,p,m,M,g,x,S,b,v,y,I,D,w,F,E,T=o[0],A=o[1],R=o[2],P=Math.sqrt(T*T+A*A+R*R);return Math.abs(P)<r.EPSILON?null:(P=1/P,T*=P,A*=P,R*=P,n=Math.sin(i),a=Math.cos(i),s=1-a,u=e[0],c=e[1],h=e[2],l=e[3],f=e[4],_=e[5],d=e[6],p=e[7],m=e[8],M=e[9],g=e[10],x=e[11],S=T*T*s+a,b=A*T*s+R*n,v=R*T*s-A*n,y=T*A*s-R*n,I=A*A*s+a,D=R*A*s+T*n,w=T*R*s+A*n,F=A*R*s-T*n,E=R*R*s+a,t[0]=u*S+f*b+m*v,t[1]=c*S+_*b+M*v,t[2]=h*S+d*b+g*v,t[3]=l*S+p*b+x*v,t[4]=u*y+f*I+m*D,t[5]=c*y+_*I+M*D,t[6]=h*y+d*I+g*D,t[7]=l*y+p*I+x*D,t[8]=u*w+f*F+m*E,t[9]=c*w+_*F+M*E,t[10]=h*w+d*F+g*E,t[11]=l*w+p*F+x*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},o.scalar.rotateX=function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[4],a=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*o+c*r,t[5]=a*o+h*r,t[6]=s*o+l*r,t[7]=u*o+f*r,t[8]=c*o-n*r,t[9]=h*o-a*r,t[10]=l*o-s*r,t[11]=f*o-u*r,t},o.SIMD.rotateX=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),o=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),SIMD.Float32x4.mul(n,r))),t},o.rotateX=r.USE_SIMD?o.SIMD.rotateX:o.scalar.rotateX,o.scalar.rotateY=function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],a=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o-c*r,t[1]=a*o-h*r,t[2]=s*o-l*r,t[3]=u*o-f*r,t[8]=n*r+c*o,t[9]=a*r+h*o,t[10]=s*r+l*o,t[11]=u*r+f*o,t},o.SIMD.rotateY=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),o=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,r),SIMD.Float32x4.mul(a,o))),t},o.rotateY=r.USE_SIMD?o.SIMD.rotateY:o.scalar.rotateY,o.scalar.rotateZ=function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],a=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o+c*r,t[1]=a*o+h*r,t[2]=s*o+l*r,t[3]=u*o+f*r,t[4]=c*o-n*r,t[5]=h*o-a*r,t[6]=l*o-s*r,t[7]=f*o-u*r,t},o.SIMD.rotateZ=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),o=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),SIMD.Float32x4.mul(a,r))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),SIMD.Float32x4.mul(n,r))),t},o.rotateZ=r.USE_SIMD?o.SIMD.rotateZ:o.scalar.rotateZ,o.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e,i){var o,n,a,s=i[0],u=i[1],c=i[2],h=Math.sqrt(s*s+u*u+c*c);return Math.abs(h)<r.EPSILON?null:(h=1/h,s*=h,u*=h,c*=h,o=Math.sin(e),n=Math.cos(e),a=1-n,t[0]=s*s*a+n,t[1]=u*s*a+c*o,t[2]=c*s*a-u*o,t[3]=0,t[4]=s*u*a-c*o,t[5]=u*u*a+n,t[6]=c*u*a+s*o,t[7]=0,t[8]=s*c*a+u*o,t[9]=u*c*a-s*o,t[10]=c*c*a+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},o.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotationTranslation=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=r+r,u=o+o,c=n+n,h=r*s,l=r*u,f=r*c,_=o*u,d=o*c,p=n*c,m=a*s,M=a*u,g=a*c;return t[0]=1-(_+p),t[1]=l+g,t[2]=f-M,t[3]=0,t[4]=l-g,t[5]=1-(h+p),t[6]=d+m,t[7]=0,t[8]=f+M,t[9]=d-m,t[10]=1-(h+_),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},o.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},o.getRotation=function(t,e){var i=e[0]+e[5]+e[10],r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},o.fromRotationTranslationScale=function(t,e,i,r){var o=e[0],n=e[1],a=e[2],s=e[3],u=o+o,c=n+n,h=a+a,l=o*u,f=o*c,_=o*h,d=n*c,p=n*h,m=a*h,M=s*u,g=s*c,x=s*h,S=r[0],b=r[1],v=r[2];return t[0]=(1-(d+m))*S,t[1]=(f+x)*S,t[2]=(_-g)*S,t[3]=0,t[4]=(f-x)*b,t[5]=(1-(l+m))*b,t[6]=(p+M)*b,t[7]=0,t[8]=(_+g)*v,t[9]=(p-M)*v,t[10]=(1-(l+d))*v,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},o.fromRotationTranslationScaleOrigin=function(t,e,i,r,o){var n=e[0],a=e[1],s=e[2],u=e[3],c=n+n,h=a+a,l=s+s,f=n*c,_=n*h,d=n*l,p=a*h,m=a*l,M=s*l,g=u*c,x=u*h,S=u*l,b=r[0],v=r[1],y=r[2],I=o[0],D=o[1],w=o[2];return t[0]=(1-(p+M))*b,t[1]=(_+S)*b,t[2]=(d-x)*b,t[3]=0,t[4]=(_-S)*v,t[5]=(1-(f+M))*v,t[6]=(m+g)*v,t[7]=0,t[8]=(d+x)*y,t[9]=(m-g)*y,t[10]=(1-(f+p))*y,t[11]=0,t[12]=i[0]+I-(t[0]*I+t[4]*D+t[8]*w),t[13]=i[1]+D-(t[1]*I+t[5]*D+t[9]*w),t[14]=i[2]+w-(t[2]*I+t[6]*D+t[10]*w),t[15]=1,t},o.fromQuat=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=i+i,s=r+r,u=o+o,c=i*a,h=r*a,l=r*s,f=o*a,_=o*s,d=o*u,p=n*a,m=n*s,M=n*u;return t[0]=1-l-d,t[1]=h+M,t[2]=f-m,t[3]=0,t[4]=h-M,t[5]=1-c-d,t[6]=_+p,t[7]=0,t[8]=f+m,t[9]=_-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.frustum=function(t,e,i,r,o,n,a){var s=1/(i-e),u=1/(o-r),c=1/(n-a);return t[0]=2*n*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*u,t[6]=0,t[7]=0,t[8]=(i+e)*s,t[9]=(o+r)*u,t[10]=(a+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*c,t[15]=0,t},o.perspective=function(t,e,i,r,o){var n=1/Math.tan(e/2),a=1/(r-o);return t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(o+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*r*a,t[15]=0,t},o.perspectiveFromFieldOfView=function(t,e,i,r){var o=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(o+n);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(o-n)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},o.ortho=function(t,e,i,r,o,n,a){var s=1/(e-i),u=1/(r-o),c=1/(n-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*s,t[13]=(o+r)*u,t[14]=(a+n)*c,t[15]=1,t},o.lookAt=function(t,e,i,n){var a,s,u,c,h,l,f,_,d,p,m=e[0],M=e[1],g=e[2],x=n[0],S=n[1],b=n[2],v=i[0],y=i[1],I=i[2];return Math.abs(m-v)<r.EPSILON&&Math.abs(M-y)<r.EPSILON&&Math.abs(g-I)<r.EPSILON?o.identity(t):(f=m-v,_=M-y,d=g-I,p=1/Math.sqrt(f*f+_*_+d*d),f*=p,_*=p,d*=p,a=S*d-b*_,s=b*f-x*d,u=x*_-S*f,p=Math.sqrt(a*a+s*s+u*u),p?(p=1/p,a*=p,s*=p,u*=p):(a=0,s=0,u=0),c=_*u-d*s,h=d*a-f*u,l=f*s-_*a,p=Math.sqrt(c*c+h*h+l*l),p?(p=1/p,c*=p,h*=p,l*=p):(c=0,h=0,l=0),t[0]=a,t[1]=c,t[2]=f,t[3]=0,t[4]=s,t[5]=h,t[6]=_,t[7]=0,t[8]=u,t[9]=l,t[10]=d,t[11]=0,t[12]=-(a*m+s*M+u*g),t[13]=-(c*m+h*M+l*g),t[14]=-(f*m+_*M+d*g),t[15]=1,t)},o.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},o.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t},o.sub=o.subtract,o.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},o.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=t[6],h=t[7],l=t[8],f=t[9],_=t[10],d=t[11],p=t[12],m=t[13],M=t[14],g=t[15],x=e[0],S=e[1],b=e[2],v=e[3],y=e[4],I=e[5],D=e[6],w=e[7],F=e[8],E=e[9],T=e[10],A=e[11],R=e[12],P=e[13],k=e[14],O=e[15];return Math.abs(i-x)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-S)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(n-b)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-v)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-y)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-I)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(c-D)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-w)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(l-F)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(f-E)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(_-T)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(T))&&Math.abs(d-A)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-R)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-P)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(M-k)<=r.EPSILON*Math.max(1,Math.abs(M),Math.abs(k))&&Math.abs(g-O)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))},e.exports=o},{"./common.js":16}],21:[function(t,e,i){var r=t("./common.js"),o=t("./mat3.js"),n=t("./vec3.js"),a=t("./vec4.js"),s={};s.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=n.create(),e=n.fromValues(1,0,0),i=n.fromValues(0,1,0);return function(r,o,a){var u=n.dot(o,a);return-.999999>u?(n.cross(t,e,o),n.length(t)<1e-6&&n.cross(t,i,o),n.normalize(t,t),s.setAxisAngle(r,t,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(n.cross(t,o,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+u,s.normalize(r,r))}}(),s.setAxes=function(){var t=o.create();return function(e,i,r,o){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=o[0],t[4]=o[1],t[7]=o[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=a.clone,s.fromValues=a.fromValues,s.copy=a.copy,s.set=a.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,i){i=.5*i;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},s.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},s.add=a.add,s.multiply=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3],s=i[0],u=i[1],c=i[2],h=i[3];return t[0]=r*h+a*s+o*c-n*u,t[1]=o*h+a*u+n*s-r*c,t[2]=n*h+a*c+r*u-o*s,t[3]=a*h-r*s-o*u-n*c,t},s.mul=s.multiply,s.scale=a.scale,s.rotateX=function(t,e,i){i*=.5;var r=e[0],o=e[1],n=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+a*s,t[1]=o*u+n*s,t[2]=n*u-o*s,t[3]=a*u-r*s,t},s.rotateY=function(t,e,i){i*=.5;var r=e[0],o=e[1],n=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u-n*s,t[1]=o*u+a*s,t[2]=n*u+r*s,t[3]=a*u-o*s,t},s.rotateZ=function(t,e,i){i*=.5;var r=e[0],o=e[1],n=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=r*u+o*s,t[1]=o*u-r*s,t[2]=n*u+a*s,t[3]=a*u-n*s,t},s.calculateW=function(t,e){var i=e[0],r=e[1],o=e[2];return t[0]=i,t[1]=r,t[2]=o,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-o*o)),t},s.dot=a.dot,s.lerp=a.lerp,s.slerp=function(t,e,i,r){var o,n,a,s,u,c=e[0],h=e[1],l=e[2],f=e[3],_=i[0],d=i[1],p=i[2],m=i[3];return n=c*_+h*d+l*p+f*m,0>n&&(n=-n,_=-_,d=-d,p=-p,m=-m),1-n>1e-6?(o=Math.acos(n),a=Math.sin(o),s=Math.sin((1-r)*o)/a,u=Math.sin(r*o)/a):(s=1-r,u=r),t[0]=s*c+u*_,t[1]=s*h+u*d,t[2]=s*l+u*p,t[3]=s*f+u*m,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(i,r,o,n,a,u){return s.slerp(t,r,a,u),s.slerp(e,o,n,u),s.slerp(i,t,e,2*u*(1-u)),i}}(),s.invert=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=i*i+r*r+o*o+n*n,s=a?1/a:0;return t[0]=-i*s,t[1]=-r*s,t[2]=-o*s,t[3]=n*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=a.length,s.len=s.length,s.squaredLength=a.squaredLength,s.sqrLen=s.squaredLength,s.normalize=a.normalize,s.fromMat3=function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var n=(o+1)%3,a=(o+2)%3;i=Math.sqrt(e[3*o+o]-e[3*n+n]-e[3*a+a]+1),t[o]=.5*i,i=.5/i,t[3]=(e[3*n+a]-e[3*a+n])*i,t[n]=(e[3*n+o]+e[3*o+n])*i,t[a]=(e[3*a+o]+e[3*o+a])*i}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=a.exactEquals,s.equals=a.equals,e.exports=s},{"./common.js":16,"./mat3.js":19,"./vec3.js":23,"./vec4.js":24}],22:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,i){return t[0]=e,t[1]=i,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},o.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},o.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},o.normalize=function(t,e){var i=e[0],r=e[1],o=i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},o.lerp=function(t,e,i,r){var o=e[0],n=e[1];return t[0]=o+r*(i[0]-o),t[1]=n+r*(i[1]-n),t},o.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},o.transformMat2=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o,t[1]=i[1]*r+i[3]*o,t},o.transformMat2d=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[2]*o+i[4],t[1]=i[1]*r+i[3]*o+i[5],t},o.transformMat3=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[3]*o+i[6],t[1]=i[1]*r+i[4]*o+i[7],t},o.transformMat4=function(t,e,i){var r=e[0],o=e[1];return t[0]=i[0]*r+i[4]*o+i[12],t[1]=i[1]*r+i[5]*o+i[13],t},o.forEach=function(){var t=o.create();return function(e,i,r,o,n,a){var s,u;for(i||(i=2),r||(r=0),u=o?Math.min(o*i+r,e.length):e.length,s=r;u>s;s+=i)t[0]=e[s],t[1]=e[s+1],n(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},o.equals=function(t,e){var i=t[0],o=t[1],n=e[0],a=e[1];return Math.abs(i-n)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(o-a)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))},e.exports=o},{"./common.js":16}],23:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new r.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,i){var o=new r.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=i,o},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},o.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},o.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(i*i+r*r+o*o)},o.dist=o.distance,o.squaredDistance=function(t,e){
var i=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return i*i+r*r+o*o},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},o.normalize=function(t,e){var i=e[0],r=e[1],o=e[2],n=i*i+r*r+o*o;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=i[0],s=i[1],u=i[2];return t[0]=o*u-n*s,t[1]=n*a-r*u,t[2]=r*s-o*a,t},o.lerp=function(t,e,i,r){var o=e[0],n=e[1],a=e[2];return t[0]=o+r*(i[0]-o),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t},o.hermite=function(t,e,i,r,o,n){var a=n*n,s=a*(2*n-3)+1,u=a*(n-2)+n,c=a*(n-1),h=a*(3-2*n);return t[0]=e[0]*s+i[0]*u+r[0]*c+o[0]*h,t[1]=e[1]*s+i[1]*u+r[1]*c+o[1]*h,t[2]=e[2]*s+i[2]*u+r[2]*c+o[2]*h,t},o.bezier=function(t,e,i,r,o,n){var a=1-n,s=a*a,u=n*n,c=s*a,h=3*n*s,l=3*u*a,f=u*n;return t[0]=e[0]*c+i[0]*h+r[0]*l+o[0]*f,t[1]=e[1]*c+i[1]*h+r[1]*l+o[1]*f,t[2]=e[2]*c+i[2]*h+r[2]*l+o[2]*f,t},o.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI,o=2*r.RANDOM()-1,n=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=o*e,t},o.transformMat4=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=i[3]*r+i[7]*o+i[11]*n+i[15];return a=a||1,t[0]=(i[0]*r+i[4]*o+i[8]*n+i[12])/a,t[1]=(i[1]*r+i[5]*o+i[9]*n+i[13])/a,t[2]=(i[2]*r+i[6]*o+i[10]*n+i[14])/a,t},o.transformMat3=function(t,e,i){var r=e[0],o=e[1],n=e[2];return t[0]=r*i[0]+o*i[3]+n*i[6],t[1]=r*i[1]+o*i[4]+n*i[7],t[2]=r*i[2]+o*i[5]+n*i[8],t},o.transformQuat=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=i[0],s=i[1],u=i[2],c=i[3],h=c*r+s*n-u*o,l=c*o+u*r-a*n,f=c*n+a*o-s*r,_=-a*r-s*o-u*n;return t[0]=h*c+_*-a+l*-u-f*-s,t[1]=l*c+_*-s+f*-a-h*-u,t[2]=f*c+_*-u+h*-s-l*-a,t},o.rotateX=function(t,e,i,r){var o=[],n=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],n[0]=o[0],n[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),n[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t},o.rotateY=function(t,e,i,r){var o=[],n=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],n[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),n[1]=o[1],n[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t},o.rotateZ=function(t,e,i,r){var o=[],n=[];return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],n[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),n[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),n[2]=o[2],t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t},o.forEach=function(){var t=o.create();return function(e,i,r,o,n,a){var s,u;for(i||(i=3),r||(r=0),u=o?Math.min(o*i+r,e.length):e.length,s=r;u>s;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],n(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),o.angle=function(t,e){var i=o.fromValues(t[0],t[1],t[2]),r=o.fromValues(e[0],e[1],e[2]);o.normalize(i,i),o.normalize(r,r);var n=o.dot(i,r);return n>1?0:Math.acos(n)},o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-s)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))},e.exports=o},{"./common.js":16}],24:[function(t,e,i){var r=t("./common.js"),o={};o.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},o.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},o.fromValues=function(t,e,i,o){var n=new r.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=o,n},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},o.set=function(t,e,i,r,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=o,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},o.sub=o.subtract,o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},o.mul=o.multiply,o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},o.div=o.divide,o.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},o.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},o.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},o.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},o.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},o.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},o.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(i*i+r*r+o*o+n*n)},o.dist=o.distance,o.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2],n=e[3]-t[3];return i*i+r*r+o*o+n*n},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],i=t[1],r=t[2],o=t[3];return Math.sqrt(e*e+i*i+r*r+o*o)},o.len=o.length,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],o=t[3];return e*e+i*i+r*r+o*o},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},o.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},o.normalize=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],a=i*i+r*r+o*o+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=o*a,t[3]=n*a),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},o.lerp=function(t,e,i,r){var o=e[0],n=e[1],a=e[2],s=e[3];return t[0]=o+r*(i[0]-o),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a),t[3]=s+r*(i[3]-s),t},o.random=function(t,e){return e=e||1,t[0]=r.RANDOM(),t[1]=r.RANDOM(),t[2]=r.RANDOM(),t[3]=r.RANDOM(),o.normalize(t,t),o.scale(t,t,e),t},o.transformMat4=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=e[3];return t[0]=i[0]*r+i[4]*o+i[8]*n+i[12]*a,t[1]=i[1]*r+i[5]*o+i[9]*n+i[13]*a,t[2]=i[2]*r+i[6]*o+i[10]*n+i[14]*a,t[3]=i[3]*r+i[7]*o+i[11]*n+i[15]*a,t},o.transformQuat=function(t,e,i){var r=e[0],o=e[1],n=e[2],a=i[0],s=i[1],u=i[2],c=i[3],h=c*r+s*n-u*o,l=c*o+u*r-a*n,f=c*n+a*o-s*r,_=-a*r-s*o-u*n;return t[0]=h*c+_*-a+l*-u-f*-s,t[1]=l*c+_*-s+f*-a-h*-u,t[2]=f*c+_*-u+h*-s-l*-a,t[3]=e[3],t},o.forEach=function(){var t=o.create();return function(e,i,r,o,n,a){var s,u;for(i||(i=4),r||(r=0),u=o?Math.min(o*i+r,e.length):e.length,s=r;u>s;s+=i)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],n(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),o.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.equals=function(t,e){var i=t[0],o=t[1],n=t[2],a=t[3],s=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},e.exports=o},{"./common.js":16}],25:[function(t,e,i){(function(t){WebGLDebugUtils=function(){function e(t){if(null==d){d={},p={};for(var e in t)"number"==typeof t[e]&&(d[t[e]]=e,p[e]=t[e])}}function i(){if(null==d)throw"WebGLDebugUtils.init(ctx) not called"}function r(t){return i(),void 0!==d[t]}function o(t){i();var e=d[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function n(t,e,i,r){var n=_[t];if(void 0!==n){var n=n[e];if(void 0!==n&&n[i]){if("object"==typeof n[i]&&void 0!==n[i].enumBitwiseOr){for(var a=n[i].enumBitwiseOr,s=0,u=[],c=0;c<a.length;++c){var h=p[a[c]];0!==(r&h)&&(s|=h,u.push(o(h)))}return s===r?u.join(" | "):o(r)}return o(r)}}return null===r?"null":void 0===r?"undefined":r.toString()}function a(t,e){for(var i="",r=e.length,o=0;r>o;++o)i+=(0==o?"":", ")+n(t,r,o,e[o]);return i}function s(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}function u(t,i,r,a){function c(t,e){return function(){r&&r(e,arguments);var o=t[e].apply(t,arguments),n=a.getError();return 0!=n&&(h[n]=!0,i(n,e,arguments)),o}}a=a||t,e(t),i=i||function(t,e,i){for(var r="",a=i.length,s=0;a>s;++s)r+=(0==s?"":", ")+n(e,a,s,i[s]);f("WebGL error "+o(t)+" in "+e+"("+r+")")};var h={},l={};for(var _ in t)if("function"==typeof t[_])if("getExtension"!=_)l[_]=c(t,_);else{var d=c(t,_);l[_]=function(){var e=d.apply(t,arguments);return u(e,i,r,a)}}else s(l,t,_);return l.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return t.NO_ERROR},l}function c(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var r=0;e>r;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0);t.deleteBuffer(i);for(var o=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),r=0;o>r;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function i(t){var e=t.addEventListener;t.addEventListener=function(i,r,o){switch(i){case"webglcontextlost":y(r);break;case"webglcontextrestored":I(r);break;default:e.apply(t,arguments)}}}function r(){for(var t=Object.keys(v),e=0;e<t.length;++e)delete v[t]}function o(){++x,m||g==x&&t.loseContext()}function n(t,e){var i=t[e];return function(){if(o(),!m){var e=i.apply(t,arguments);return e}}}function a(){for(var t=0;t<M.length;++t){var e=M[t];e instanceof WebGLBuffer?l.deleteBuffer(e):e instanceof WebGLFramebuffer?l.deleteFramebuffer(e):e instanceof WebGLProgram?l.deleteProgram(e):e instanceof WebGLRenderbuffer?l.deleteRenderbuffer(e):e instanceof WebGLShader?l.deleteShader(e):e instanceof WebGLTexture&&l.deleteTexture(e)}}function u(t){return{statusMessage:t,preventDefault:function(){S=!0}}}function h(t){for(var e in t)"function"==typeof t[e]?f[e]=n(t,e):s(f,t,e);f.getError=function(){if(o(),!m)for(var t;t=l.getError();)v[t]=!0;for(var t in v)if(v[t])return delete v[t],t;return f.NO_ERROR};for(var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<i.length;++r){var a=i[r];f[a]=function(e){return function(){if(o(),m)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=p,M.push(i),i}}(t[a])}for(var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],r=0;r<u.length;++r){var a=u[r];f[a]=function(e){return function(){return o(),m?null:e.apply(t,arguments)}}(f[a])}for(var c=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],r=0;r<c.length;++r){var a=c[r];f[a]=function(e){return function(){return o(),m?!1:e.apply(t,arguments)}}(f[a])}return f.checkFramebufferStatus=function(e){return function(){return o(),m?f.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(f.checkFramebufferStatus),f.getAttribLocation=function(e){return function(){return o(),m?-1:e.apply(t,arguments)}}(f.getAttribLocation),f.getVertexAttribOffset=function(e){return function(){return o(),m?0:e.apply(t,arguments)}}(f.getVertexAttribOffset),f.isContextLost=function(){return m},f}var l,f,_=[],d=[],f={},p=1,m=!1,M=[],g=0,x=0,S=!1,b=0,v={};t.getContext=function(e){return function(){var i=e.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=l){if(l)throw"got different context";l=i,f=h(l)}return f}return i}}(t.getContext);var y=function(t){_.push(e(t))},I=function(t){d.push(e(t))};return i(t),t.loseContext=function(){if(!m){for(m=!0,g=0,++p;l.getError(););r(),v[l.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),i=_.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);b>=0&&setTimeout(function(){t.restoreContext()},b)},0)}},t.restoreContext=function(){m&&d.length&&setTimeout(function(){if(!S)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),c(l),m=!1,x=0,S=!1;for(var t=d.slice(),e=u("context restored"),i=0;i<t.length;++i)t[i](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";g=x+t},t.getNumCalls=function(){return x},t.setRestoreTimeout=function(t){b=t},t}"undefined"==typeof window&&(window=t);var l=function(t){window.console&&window.console.log&&window.console.log(t)},f=function(t){window.console&&window.console.error?window.console.error(t):l(t)},_={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},d=null,p=null;return{init:e,mightBeEnum:r,glEnumToString:o,glFunctionArgToString:n,glFunctionArgsToString:a,makeDebugContext:u,makeLostContextSimulatingCanvas:h,resetToInitialState:c}}(),e.exports=WebGLDebugUtils}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],26:[function(t,e,i){"use strict";var r=t("../util"),o=0,n=!1,a=function(t,e){this.scene=t,this.core=t.core,this.parent=e,this.id=++o,this.frame_count=0,this._x=0,this._y=0,this.auto_disable_times_map={},this.velocity={magnitude:0,theta:0},this.objects=[]};a.prototype.init=function(){this.frame_count=0,this.auto_disable_times_map={};for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},a.prototype.beforeDraw=function(){this.frame_count++,this.checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.move()},a.prototype.draw=function(){var t=this.core.ctx;n&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore());for(var e=0,i=this.objects.length;i>e;e++)this.objects[e].draw()},a.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},a.prototype.addSubObject=function(t){this.objects.push(t)},a.prototype.removeSubObject=function(t){for(var e=0,i=this.objects.length;i>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},a.prototype.removeAllSubObject=function(){this.objects=[]},a.prototype.move=function(){var t=r.calcMoveXByVelocity(this.velocity),e=r.calcMoveYByVelocity(this.velocity);this._x+=t,this._y+=e},a.prototype.onCollision=function(t){},a.prototype.width=function(){return 0},a.prototype.height=function(){return 0},a.prototype.globalCenterX=function(){return this.scene.x()+this.x()},a.prototype.globalCenterY=function(){return this.scene.y()+this.y()},a.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},a.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},a.prototype.globalUpY=function(){return this.scene.x()+this.y()-this.height()/2},a.prototype.globalDownY=function(){return this.scene.x()+this.y()+this.height()/2},a.prototype.collisionWidth=function(t){return 0},a.prototype.collisionHeight=function(t){return 0},a.prototype.isCollision=function(t){return!0},a.prototype.checkCollisionWithPosition=function(t,e){return this.checkCollisionByPosition(t,e)?(this.onCollision(),!0):!1},a.prototype.checkCollisionWithObject=function(t){var e=this;return t.checkCollisionByObject(e)?(t.onCollision(e),e.onCollision(t),!0):!1},a.prototype.checkCollisionWithObjects=function(t){for(var e=this,i=!1,r=0;r<t.length;r++){var o=t[r];e.checkCollisionByObject(o)&&(e.onCollision(o),o.onCollision(e),i=!0)}return i},a.prototype.checkCollision=function(t){return this.checkCollisionByObject(t)},a.prototype.checkCollisionByObject=function(t){return this.isCollision(t)&&t.isCollision(this)&&Math.abs(this.x()-t.x())<this.collisionWidth(t)/2+t.collisionWidth(this)/2&&Math.abs(this.y()-t.y())<this.collisionHeight(t)/2+t.collisionHeight(this)/2?!0:!1},a.prototype.checkCollisionByPosition=function(t,e){return this.isCollision()&&this.x()-this.collisionWidth()/2<t&&t<this.x()+this.collisionWidth()/2&&this.y()-this.collisionHeight()/2<e&&e<this.y()+this.collisionHeight()/2?!0:!1},a.prototype.getCollisionLeftX=function(t){return this.x()-this.collisionWidth(t)/2},a.prototype.getCollisionRightX=function(t){return this.x()+this.collisionWidth(t)/2},a.prototype.getCollisionUpY=function(t){return this.y()-this.collisionHeight(t)/2},a.prototype.getCollisionDownY=function(t){return this.y()+this.collisionHeight(t)/2},a.prototype.setAutoDisableFlag=function(t,e){var i=this;i[t]=!0,i.auto_disable_times_map[t]=i.frame_count+e},a.prototype.checkAutoDisableFlags=function(){var t=this;for(var e in t.auto_disable_times_map)this.auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t.auto_disable_times_map[e])},a.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},a.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},a.prototype.setVelocity=function(t){this.velocity=t};var s=100;a.prototype.isOutOfStage=function(){return this.x()+s<0||this.y()+s<0||this.x()>this.core.width+s||this.y()>this.core.height+s?!0:!1},e.exports=a},{"../util":40}],27:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={}};o.inherit(n,r),n.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={}},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},n.prototype.draw=function(){r.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},n.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},n.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},n.prototype.remove=function(t){delete this.objects[t]},n.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];t.checkCollision(i)&&(t.onCollision(i),i.onCollision(t))}},n.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var r=this.objects[e],o=t.objects[i];if(r.onCollision(o),o.onCollision(r),!this.objects[e])break}},n.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},e.exports=n},{"../util":40,"./base":26}],28:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=t("gl-matrix"),a=t("../constant_3d").SPRITE3D,s=function(t,e){r.apply(this,arguments),this.Class=e,this.objects={},this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[];var i=this.core.gl;this.vBuffer=i.createBuffer(),this.cBuffer=i.createBuffer(),this.iBuffer=i.createBuffer(),this.aBuffer=i.createBuffer(),this.mvMatrix=n.mat4.create(),this.pMatrix=n.mat4.create()};o.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.objects={},this._initmvpMatrix()},s.prototype._initmvpMatrix=function(){n.mat4.identity(this.mvMatrix),n.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._setOrthographicProjection=function(){n.mat4.identity(this.pMatrix);var t=.1,e=10;n.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw();this._updateAttributes()},s.prototype._updateAttributes=function(){this._resetAttributes();var t=0;for(var e in this.objects){var i=this.objects[e];if(i.isShow()){var r;for(r=0;r<a.V_SIZE;r++)this.vertices[t*a.V_SIZE+r]=i.vertices[r];for(r=0;r<a.C_SIZE;r++)this.coordinates[t*a.C_SIZE+r]=i.coordinates[r];for(r=0;r<a.I_SIZE;r++)this.indices[t*a.I_SIZE+r]=t*a.V_ITEM_NUM+i.indices[r];for(r=0;r<a.A_SIZE;r++)this.colors[t*a.A_SIZE+r]=i.colors[r];t++}}},s.prototype._resetAttributes=function(){this.vertices.length=0,this.coordinates.length=0,this.indices.length=0,this.colors.length=0},s.prototype.draw=function(){if(r.prototype.draw.apply(this,arguments),0!==this.vertices.length){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),a.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),a.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),a.A_ITEM_SIZE);for(var i in this.objects){var o=this.objects[i].texture;this._setupTexture("uSampler",0,o);break}t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}},s.prototype._setupAttribute=function(t,e,i,r){var o=this.core.gl,n=this.shader();o.bindBuffer(o.ARRAY_BUFFER,e),o.bufferData(o.ARRAY_BUFFER,i,o.STATIC_DRAW),o.enableVertexAttribArray(n.attribute_locations[t]),o.vertexAttribPointer(n.attribute_locations[t],r,o.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,i){var r=this.core.gl,o=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,i),r.uniform1i(o.uniform_locations[t],e)},s.prototype.afterDraw=function(){r.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},s.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},s.prototype.remove=function(t){delete this.objects[t]},s.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];t.checkCollision(i)&&(t.onCollision(i),i.onCollision(t))}},s.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var r=this.objects[e],o=t.objects[i];if(r.onCollision(o),o.onCollision(r),!this.objects[e])break}},s.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},s.prototype.shader=function(){return this.core.sprite_3d_shader},e.exports=s},{"../constant_3d":10,"../util":40,"./base":26,"gl-matrix":15}],29:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t){r.apply(this,arguments),this.current_sprite_index=0};o.inherit(n,r),n.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},n.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var i=o.thetaToRadian(this.velocity.theta+this.rotateAdjust());e.rotate(i);var n=this.spriteWidth(),a=this.spriteHeight();n||(n=t.width),a||(a=t.height);var s=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.globalAlpha=this.alpha(),e.drawImage(t,n*this.spriteIndexX(),a*this.spriteIndexY(),n,a,-s/2,-u/2,s,u),e.restore()}r.prototype.draw.apply(this,arguments)},n.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},n.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},n.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},n.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},n.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},n.prototype.isShow=function(){return!0},n.prototype.spriteAnimationSpan=function(){return 0},n.prototype.spriteIndices=function(){return[{x:0,y:0}]},n.prototype.spriteWidth=function(){return 0},n.prototype.spriteHeight=function(){return 0},n.prototype.rotateAdjust=function(){return 0},n.prototype.scale=function(){return 0},n.prototype.scaleWidth=function(){return 1},n.prototype.scaleHeight=function(){return 1},n.prototype.isReflect=function(){return!1},n.prototype.alpha=function(){return 1},e.exports=n},{"../util":40,"./base":26}],30:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=t("../constant_3d").SPRITE3D,a=t("gl-matrix"),s=function(t){r.apply(this,arguments),this.current_sprite_index=0,this._z=0,this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[],this.vertices.length=n.V_SIZE,this.coordinates.length=n.C_SIZE,this.indices.length=n.I_SIZE,this.colors.length=n.A_SIZE;var e=this.core.gl;this.vBuffer=e.createBuffer(),this.cBuffer=e.createBuffer(),this.iBuffer=e.createBuffer(),this.aBuffer=e.createBuffer(),this.texture=null,this.mvMatrix=a.mat4.create(),this.pMatrix=a.mat4.create()};o.inherit(s,r),s.prototype.init=function(){r.prototype.init.apply(this,arguments),this.current_sprite_index=0,this._initmvpMatrix(),this._initVertices(),this._initCoordinates(),this._initIndices(),this._initColors(),this._initTexture()},s.prototype._initmvpMatrix=function(){a.mat4.identity(this.mvMatrix),a.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._initVertices=function(){var t=this.spriteWidth()/2,e=this.spriteHeight()/2;this.vertices[0]=-t,this.vertices[1]=-e,this.vertices[2]=-1,this.vertices[3]=t,this.vertices[4]=-e,this.vertices[5]=-1,this.vertices[6]=t,this.vertices[7]=e,this.vertices[8]=-1,this.vertices[9]=-t,this.vertices[10]=e,this.vertices[11]=-1},s.prototype._initCoordinates=function(){var t=this.core.image_loader.getImage(this.spriteName()),e=this.spriteWidth()/t.width,i=this.spriteHeight()/t.height,r=e*this.spriteIndexX(),o=i*this.spriteIndexY(),n=r+e,a=o+i;this.coordinates[0]=r,this.coordinates[1]=a,this.coordinates[2]=n,this.coordinates[3]=a,this.coordinates[4]=n,this.coordinates[5]=o,this.coordinates[6]=r,this.coordinates[7]=o},s.prototype._initIndices=function(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3},s.prototype._initColors=function(){this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1,this.colors[12]=1,this.colors[13]=1,this.colors[14]=1,this.colors[15]=1},s.prototype._initTexture=function(){var t=this.core.gl,e=this.core.image_loader.getImage(this.spriteName()),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this.texture=i},s.prototype._setOrthographicProjection=function(){a.mat4.identity(this.pMatrix);var t=.1,e=10;a.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0)),this._initVertices(),this._initCoordinates(),this._translate()},s.prototype._translate=function(){for(var t=0;t<n.V_ITEM_NUM;t++)this.vertices[t*n.V_ITEM_SIZE+0]+=this.x(),this.vertices[t*n.V_ITEM_SIZE+1]-=this.y(),this.vertices[t*n.V_ITEM_SIZE+2]+=this.z()},s.prototype._rotate=function(){for(var t=this._getRadian(),e=0;e<n.V_ITEM_NUM;e++){var i=this.vertices[e*n.V_ITEM_SIZE+0],r=this.vertices[e*n.V_ITEM_SIZE+1];this.vertices[e*n.V_ITEM_SIZE+0]=i*Math.cos(t)-r*Math.sin(t),this.vertices[e*n.V_ITEM_SIZE+1]=i*Math.sin(t)+r*Math.cos(t)}},s.prototype._getRadian=function(){var t=this.velocity.theta;return o.thetaToRadian(t)},s.prototype.draw=function(){if(this.isShow()){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),
t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),n.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),n.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),n.A_ITEM_SIZE),this._setupTexture("uSampler",0,this.texture),t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.setupAdditionalVariables(),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}r.prototype.draw.apply(this,arguments)},s.prototype._setupAttribute=function(t,e,i,r){var o=this.core.gl,n=this.shader();o.bindBuffer(o.ARRAY_BUFFER,e),o.bufferData(o.ARRAY_BUFFER,i,o.STATIC_DRAW),o.enableVertexAttribArray(n.attribute_locations[t]),o.vertexAttribPointer(n.attribute_locations[t],r,o.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,i){var r=this.core.gl,o=this.shader();r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,i),r.uniform1i(o.uniform_locations[t],e)},s.prototype.z=function(t){return"undefined"!=typeof t&&(this._z=t),this._z},s.prototype.shader=function(){return this.core.sprite_3d_shader},s.prototype.setupAdditionalVariables=function(){},s.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},s.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},s.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},s.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},s.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},s.prototype.isShow=function(){return!0},s.prototype.spriteAnimationSpan=function(){return 0},s.prototype.spriteIndices=function(){return[{x:0,y:0}]},s.prototype.spriteWidth=function(){return 0},s.prototype.spriteHeight=function(){return 0},s.prototype.rotateAdjust=function(){return 0},s.prototype.scaleWidth=function(){return 1},s.prototype.scaleHeight=function(){return 1},s.prototype.isReflect=function(){return!1},e.exports=s},{"../constant_3d":10,"../util":40,"./base":26,"gl-matrix":15}],31:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t,e,i,o,n,a){r.apply(this,arguments),this.x(e),this.y(i),this._width=o,this._height=n,this._draw_function=a.bind(this),this._is_show_rect=!1,this._scale=1};o.inherit(n,r),n.prototype.collisionWidth=function(){return this._width},n.prototype.collisionHeight=function(){return this._height},n.prototype.setShowRect=function(){return this._is_show_rect=!0,this},n.prototype.setVariable=function(t,e){return this[t]=e,this},n.prototype.draw=function(){var t=this.core.ctx;t.save(),this._draw_function(),t.restore(),this._is_show_rect&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},e.exports=n},{"../util":40,"./base":26}],32:[function(t,e,i){"use strict";var r=function(t,e){this.core=t,this.parent=e,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null};r.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._x=0,this._y=0,this.frame_count=0,this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},r.prototype.beforeDraw=function(){this.frame_count++,this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw()},r.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},r.prototype.afterDraw=function(){var t,e=this.core.ctx;this.isInFadeIn()?(e.save(),t=this.frame_count-this._fade_in_start_frame_count<this._fade_in_duration?1-(this.frame_count-this._fade_in_start_frame_count)/this._fade_in_duration:0,e.globalAlpha=t,e.fillStyle=this._fade_in_color,e.fillRect(0,0,this.width,this.height),e.restore(),1===t&&this._quitFadeIn()):this.isInFadeOut()&&(e.save(),t=this.frame_count-this._fade_out_start_frame_count<this._fade_out_duration?(this.frame_count-this._fade_out_start_frame_count)/this._fade_out_duration:1,e.globalAlpha=t,e.fillStyle=this._fade_out_color,e.fillRect(0,0,this.width,this.height),e.restore(),1===t&&this._quitFadeOut());for(var i=0,r=this.objects.length;r>i;i++)this.objects[i].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},r.prototype.addObject=function(t){this.objects.push(t)},r.prototype.addObjects=function(t){this.objects=this.objects.concat(t)},r.prototype.removeAllObject=function(){this.objects=[]},r.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},r.prototype.getSubScene=function(t){return this.scenes[t]},r.prototype.addSubScene=function(t,e){this.scenes[t]=e},r.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},r.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},r.prototype.setFadeIn=function(t,e){this._fade_in_duration=t||30,this._fade_in_color=e||"white",this._startFadeIn()},r.prototype._startFadeIn=function(){this._quitFadeOut(),this._fade_in_start_frame_count=this.frame_count},r.prototype._quitFadeIn=function(){this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null},r.prototype.isInFadeIn=function(){return null!==this._fade_in_start_frame_count?!0:!1},r.prototype.setFadeOut=function(t,e){this._fade_out_duration=t||30,this._fade_out_color=e||"black"},r.prototype.startFadeOut=function(){this.isSetFadeOut()&&(this._quitFadeIn(),this._fade_out_start_frame_count=this.frame_count)},r.prototype._quitFadeOut=function(){this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null},r.prototype.isInFadeOut=function(){return null!==this._fade_out_start_frame_count?!0:!1},r.prototype.isSetFadeOut=function(){return this._fade_out_duration&&this._fade_out_color?!0:!1},r.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},r.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},e.exports=r},{}],33:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t){r.apply(this,arguments),this.next_scene_name=null};o.inherit(n,r),n.prototype.init=function(t,e){r.prototype.init.apply(this,arguments);var i=t.images||[],o=t.sounds||[],n=t.bgms||[];this.next_scene_name=e;for(var a in i)this.core.image_loader.loadImage(a,i[a]);for(var s in o){var u=o[s];this.core.audio_loader.loadSound(s,u.path,u.volume)}for(var c in n){var h=n[c];this.core.audio_loader.loadBGM(c,h.path,1,h.loopStart,h.loopEnd)}},n.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.audio_loader.isAllLoaded()&&this.notifyAllLoaded()},n.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},n.prototype.draw=function(){r.prototype.draw.apply(this,arguments)},n.prototype.notifyAllLoaded=function(){this.next_scene_name&&this.core.changeScene(this.next_scene_name)},e.exports=n},{"../util":40,"./base":32}],34:[function(t,e,i){"use strict";var r=10,o=t("./util"),n=function(){this._timeoutID=null,this._script=null,this._progress=null,this._chara_id_list=[],this._exp_id_list=[],this._option={},this._pos=null,this._is_background_changed=!1,this._background_image_name=null,this._char_list="",this._char_idx=0,this._is_enable_printing_message=!0,this._line_num=0,this._printing_lines=[]};n.prototype.init=function(t){t||console.error("set script arguments to use serif_manager class"),this._script=t,this._chara_id_list=[],this._exp_id_list=[],this._option={},this._progress=-1,this._timeoutID=null,this._pos=null,this._is_background_changed=!1,this._background_image_name=null,this._char_list="",this._char_idx=0,this._is_enable_printing_message=!0,this._line_num=0,this._printing_lines=[],this.is_end()||this.next()},n.prototype.isEnd=function(){return this._progress===this._script.length-1},n.prototype.next=function(){this._progress++;var t=this._script[this._progress];this._showChara(t),this._showBackground(t),this._setOption(t),t.serif?this._printMessage(t.serif):this.next()},n.prototype._showBackground=function(t){this._is_background_changed=!1,t.background&&this._background_image_name!==t.background&&(this._is_background_changed=!0,this._background_image_name=t.background)},n.prototype._showChara=function(t){var e=t.pos;e&&("left"===e&&(e=0),"right"===e&&(e=1),this._pos=e,this._chara_id_list[e]=t.chara,this._exp_id_list[e]=t.exp)},n.prototype._setOption=function(t){this._option=t.option||{},t.font_color&&(this._option=o.shallowCopyHash(this.option),this._option.font_color=t.font_color)},n.prototype._printMessage=function(t){this._cancelPrintMessage(),this._char_list=t.split(""),this._char_idx=0,this._line_num=0,this._printing_lines=[],this._startPrintMessage()},n.prototype._startPrintMessage=function(){var t=this._char_list.length;if(!(this._char_idx>=t)){if(this._is_enable_printing_message){var e=this._char_list[this._char_idx];this._char_idx++,"\n"===e?this._line_num++:(this._printing_lines[this._line_num]||(this._printing_lines[this._line_num]=""),this._printing_lines[this._line_num]=this._printing_lines[this._line_num]+e)}this._timeoutID=setTimeout(this._startPrintMessage.bind(this),r)}},n.prototype._cancelPrintMessage=function(){null!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},n.prototype.startPrintMessage=function(){this._is_enable_printing_message=!0},n.prototype.cancelPrintMessage=function(){this._is_enable_printing_message=!1},n.prototype.isBackgroundChanged=function(){return this._is_background_changed},n.prototype.getBackgroundImageName=function(){return this._background_image_name},n.prototype.getImageName=function(t){return t=t||0,this._chara_id_list[t]?this._chara_id_list[t]+"_"+this._exp_id_list[t]:null},n.prototype.isTalking=function(t){return this._pos===t?!0:!1},n.prototype.getOption=function(){return this._option},n.prototype.lines=function(){return this._printing_lines},n.prototype.right_image=function(){var t=1;return this.getImageName(t)},n.prototype.left_image=function(){var t=0;return this.getImageName(t)},n.prototype.is_right_talking=function(){var t=1;return this.isTalking(t)},n.prototype.is_left_talking=function(){var t=0;return this.isTalking(t)},n.prototype.font_color=function(){return this._option.font_color},n.prototype.is_end=function(){return this.isEnd()},n.prototype.is_background_changed=function(){return this.isBackgroundChanged()},n.prototype.background_image=function(){return this.getBackgroundImageName()},e.exports=n},{"./util":40}],35:[function(t,e,i){e.exports="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	vec4 textureColor = texture2D(uSampler, vTextureCoordinates);\n	gl_FragColor = textureColor * vColor;\n}\n\n"},{}],36:[function(t,e,i){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoordinates;\nattribute vec4 aColor;\n\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n	vTextureCoordinates = aTextureCoordinates;\n	vColor = aColor;\n}\n\n"},{}],37:[function(t,e,i){"use strict";var r=(t("gl-matrix"),function(t,e,i,r,o){if(!t)throw new Error("arguments 1 must be WebGLRenderingContext instance");this.gl=t;var n,a=this.createShader(t,t.VERTEX_SHADER,e),s=this.createShader(t,t.FRAGMENT_SHADER,i),u=this.createShaderProgram(t,a,s),c={};for(n=0;n<r.length;n++)c[r[n]]=t.getAttribLocation(u,r[n]);var h={};for(n=0;n<o.length;n++)h[o[n]]=t.getUniformLocation(u,o[n]);this.shader_program=u,this.attribute_locations=c,this.uniform_locations=h});r.prototype.createShader=function(t,e,i){if(e!==t.VERTEX_SHADER&&e!==t.FRAGMENT_SHADER)throw new Error("type must be vertex or fragment");var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw(e===t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(r);return r},r.prototype.createShaderProgram=function(t,e,i){var r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("Could not initialize shaders:\n\n"+t.getProgramInfoLog(r));return r},e.exports=r},{"gl-matrix":15}],38:[function(t,e,i){"use strict";var r=t("../util"),o="hakurei_engine:default",n=function(t){t||(t={}),this._data=t};n.KEY=function(){return o},n.prototype.set=function(t,e){this._data[t]=e},n.prototype.get=function(t){return this._data[t]},n.prototype.remove=function(t){return delete this._data[t]},n.prototype.isEmpty=function(t){return 0===Object.keys(this._data).length},n.prototype.toHash=function(){return r.shallowCopyHash(this._data)},n.isLocalMode=function(){return r.isElectron()?!0:!1},n.prototype.save=function(){var t=this.constructor;t.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},n.prototype._saveToLocalFile=function(){var t=this.constructor,e=window.require("fs"),i=JSON.stringify(this._data),r=t._localFileDirectoryPath(),o=r+t._localFileName(t.KEY());e.existsSync(r)||e.mkdirSync(r),e.writeFileSync(o,i)},n._localFileDirectoryPath=function(){var t=window.require("path"),e=window.require("electron").remote.app,i=e.getPath("appData"),r=e.getName();return t.join(i,r,"save/")},n._localFileName=function(t){return t+".json"},n._localFilePath=function(t){return this._localFileDirectoryPath()+this._localFileName(t)},n.prototype._saveToWebStorage=function(){var t=this.constructor,e=t.KEY(),i=JSON.stringify(this._data);try{window.localStorage.setItem(e,i)}catch(r){}},n.load=function(){var t;t=this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage();var e=this;return t?new e(t):new e},n._loadFromLocalFile=function(){var t=window.require("fs"),e=this._localFilePath(this.KEY());if(!t.existsSync(e))return null;var i=t.readFileSync(e,{encoding:"utf8"});return i?JSON.parse(i):null},n._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(i){}return t?JSON.parse(t):null},n.prototype.del=function(){var t=this.constructor;t.isLocalMode()?this._removeLocalFile():this._removeWebStorage(),this._data={}},n.prototype._removeLocalFile=function(){var t=this.constructor,e=window.require("fs"),i=this._localFilePath(t.KEY());e.existsSync(i)&&e.unlinkSync(i)},n.prototype._removeWebStorage=function(){var t=this.constructor,e=t.KEY();try{window.localStorage.removeItem(e)}catch(i){}},e.exports=n},{"../util":40}],39:[function(t,e,i){"use strict";var r=t("./base"),o=t("../util"),n=function(t){r.apply(this,arguments)};o.inherit(n,r),n.KEY=function(){var t="hakurei_engine:save";return!this.isLocalMode()&&window&&window.location?t+":"+window.location.pathname:"save"},e.exports=n},{"../util":40,"./base":38}],40:[function(t,e,i){"use strict";var r={inherit:function(t,e){var i=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=i(e.prototype),t.prototype.constructor=t;for(var r in e)t[r]=e[r]},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(r.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(r.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,i=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16);return"rgb("+i+", "+r+", "+o+")"},clamp:function(t,e,i){return e>t?e:t>i?i:t},isElectron:function(){return"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?!0:!1},canPlayOgg:function(){var t=document.createElement("audio");return t.canPlayType?t.canPlayType("audio/ogg"):!1},shallowCopyHash:function(t){var e={};for(var i in t)e[i]=t[i];return e}};e.exports=r},{}],41:[function(t,e,i){"use strict";var r,o=t("./game");window.onload=function(){var t=document.getElementById("mainCanvas"),e={};r=new o(t,e),r.setupEvents(),r.init(),r.startRun()},window.require&&window.require("electron").webFrame.setVisualZoomLevelLimits(1,1)},{"./game":4}],42:[function(t,e,i){"use strict";var r=t("../hakurei").scene.base,o=t("../hakurei").util,n=t("../assets_config"),a=(t("../constant"),function(t){r.apply(this,arguments)});o.inherit(a,r),a.prototype.init=function(){r.prototype.init.apply(this,arguments);var t=o.canPlayOgg()?".ogg":".m4a";for(var e in n.images)this.core.image_loader.loadImage(e,n.images[e]);for(var i in n.sounds){var a=n.sounds[i];this.core.audio_loader.loadSound(i,a.path+t,a.volume)}for(var s in n.bgms){var u=n.bgms[s];this.core.audio_loader.loadBGM(s,u.path,1,u.loopStart,u.loopEnd)}},a.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.audio_loader.isAllLoaded()&&this.core.changeScene("main")},a.prototype.draw=function(){r.prototype.draw.apply(this,arguments);var t=this.core.ctx;if(t){t.save(),t.fillStyle="white",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,i=15,o="";o=i>e&&e>=0?"":2*i>e&&e>=1*i?".":3*i>e&&e>=2*i?"..":"...",t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="left",t.font="30px 'OradanoGSRR'",t.fillText("Now Loading"+o,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="rgb(119, 66, 244)",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()}},a.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},e.exports=a},{"../assets_config":1,"../constant":2,"../hakurei":5}],43:[function(t,e,i){"use strict";var r=t("../hakurei").scene.base,o=t("../hakurei").util,n=(t("../hakurei").constant,t("../hakurei").object.ui_parts),a=100,s=5,u=1200,c=function(t){r.apply(this,arguments);var e=this;e.ui_parts=[],e.renko_canvas=null,e.renko=new n(e,this.width/2,this.height/2,400,320,function(){this.core.input_manager.isLeftClickDown()?this.size>.5&&(this.size-=.05):1>this.size&&(this.size+=.05);var t=this.core.ctx;t.save(),t.translate(this.x(),this.y()),t.drawImage(e.renko_canvas,-e.renko_canvas.width/2*this.size,-e.renko_canvas.height/2*this.size,e.renko_canvas.width*this.size,e.renko_canvas.height*this.size),t.restore()}),e.renko.setVariable("size",1)};o.inherit(c,r),c.prototype.init=function(t,e){r.prototype.init.apply(this,arguments),this.removeAllObject(),this.renko_canvas=this._createRenko("00","00","00"),this.renko.init(),this.score=0,this._renko_chan_score=0,this._renko_chan_time=0,this.is_renko_chan_time=!1,this._renko_chan_time_logo=0},c.prototype.beforeDraw=function(){if(r.prototype.beforeDraw.apply(this,arguments),this.renko.beforeDraw(),this.removeOutOfStageObjects(),this.core.input_manager.isLeftClickPush()){var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();if(this.renko.checkCollisionWithPosition(t,e)){if(this.is_renko_chan_time){for(var i=10,o=0,n=i;n>o;o++)this.addObject(this._createMerry());this.score+=i}else this.addObject(this._createMerry()),this.score+=1,this._renko_chan_score+=1;this.core.audio_loader.playSound("got")}}!this.is_renko_chan_time&&this._renko_chan_score>=a?(this.is_renko_chan_time=!0,this._renko_chan_score=0,this._renko_chan_time=u,this._renko_chan_time_logo=0,this.core.audio_loader.playSound("flash")):this.is_renko_chan_time&&(this._renko_chan_time<=0?(this.is_renko_chan_time=!1,this._renko_chan_time=0):(this._renko_chan_time--,this._renko_chan_time_logo<100&&(this._renko_chan_time_logo+=2)))},c.prototype.draw=function(){var t=this.core.ctx;if(this.is_renko_chan_time){var e=this.core.image_loader.getImage("bg_super");t.drawImage(e,0,0,e.width,e.height,0,0,this.core.width,this.core.height)}else t.fillStyle="white",t.fillRect(0,0,this.width,this.height);r.prototype.draw.apply(this,arguments),this.renko.draw(),t.font="48px 'Comic Sans MS'",t.textAlign="right",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )",t.fillText("Score: "+this.score,this.width-10,this.height-10),this._showGauge(),this._showLogo(),t.restore()},c.prototype._createRenko=function(){var t=window.document.createElement("canvas");t.width=400,t.height=320;var e=t.getContext("2d"),i=this.core.image_loader.getImage("renko_base");e.drawImage(i,0,0,i.width,i.height);var r=this.core.image_loader.getImage("renko_eye_00");e.drawImage(r,0,0,r.width,r.height);var o=this.core.image_loader.getImage("renko_eyebrow_00");e.drawImage(o,0,0,o.width,o.height);var n=this.core.image_loader.getImage("renko_mouse_00");return e.drawImage(n,0,0,n.width,n.height),t},c.prototype._createMerry=function(){var t=window.document.createElement("canvas");t.width=400,t.height=320;var e=t.getContext("2d"),i=this.core.image_loader.getImage("merry_base");e.drawImage(i,0,0,i.width,i.height);var r=this.core.image_loader.getImage("merry_eye_00");e.drawImage(r,0,0,r.width,r.height);var o=this.core.image_loader.getImage("merry_eyebrow_00");e.drawImage(o,0,0,o.width,o.height);var a=this.core.image_loader.getImage("merry_mouse_00");e.drawImage(a,0,0,a.width,a.height);var s=Math.floor(Math.random()*this.width),u=-60,c=Math.floor(360*Math.random()),h=10+Math.floor(5*Math.random());return new n(this,s,u,0,0,function(){this.y(this.y()+h);var e=this.core.ctx;e.save(),e.translate(this.x(),this.y()),e.rotate(c),e.drawImage(t,-t.width/2,-t.height/2,.5*t.width,.5*t.height),e.restore()})},c.prototype._showGauge=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.fillRect(s,s,this._renko_chan_score/a*(this.width-2*s),4*s),t.restore()},c.prototype._showLogo=function(){if(this.is_renko_chan_time){var t=this.core.ctx;t.save();var e=this.core.image_loader.getImage("super_logo");t.translate(this.width/2+50,80);var i=e.width*this._renko_chan_time_logo/100*.5,r=e.height*this._renko_chan_time_logo/100*1;t.drawImage(e,-i/2,-r/2,i,r),t.restore()}};var h=100;c.prototype.removeOutOfStageObjects=function(){for(var t=[],e=0,i=this.objects.length;i>e;e++){var r=this.objects[e];r.x()+h<0||r.y()+h<0||r.x()>this.width+h||r.y()>this.height+h||t.push(r)}this.objects=t},e.exports=c},{"../hakurei":5}]},{},[41]);