!function(){function t(e,o,i){function r(a,s){if(!o[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=o[a]={exports:{}};e[a][0].call(h.exports,function(t){var o=e[a][1][t];return r(o||t)},h,h.exports,t,e,o,i)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}return t}()({1:[function(t,e,o){"use strict";var i={};i.images={bg_super:"./image/bg_super.png",super_logo:"./image/super_logo.png",renko_base:"./image/renko/base/00.png",renko_eye_00:"./image/renko/eye/00.png",renko_eyebrow_00:"./image/renko/eyebrow/00.png",renko_mouse_00:"./image/renko/mouse/00.png",merry_base:"./image/merry/base/00.png",merry_eye_00:"./image/merry/eye/00.png",merry_eyebrow_00:"./image/merry/eyebrow/00.png",merry_mouse_00:"./image/merry/mouse/00.png"},i.sounds={flash:{path:"./sound/flash",volume:1},got:{path:"./sound/got",volume:1}},i.bgms={},e.exports=i},{}],2:[function(t,e,o){"use strict";var i=t("./hakurei").core,r=t("./hakurei").util,n=t("./scene/main"),a=t("./scene/loading"),s=function(t){i.apply(this,arguments)};r.inherit(s,i),s.prototype.init=function(){i.prototype.init.apply(this,arguments)},s.prototype.init=function(){i.prototype.init.apply(this,arguments),this.scene_manager.addScene("loading",new a(this)),this.scene_manager.addScene("main",new n(this)),this.scene_manager.changeScene("loading")},e.exports=s},{"./hakurei":3,"./scene/loading":55,"./scene/main":56}],3:[function(t,e,o){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":10}],4:[function(t,e,o){"use strict";var i=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this.audio_context=null,window&&window.AudioContext&&(this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode),this._audio_source_map={}};i.prototype.init=function(){this.stopAllBGM(),this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this._audio_source_map={}},i.prototype.loadSound=function(t,e,o){if(window&&window.Audio){var i=this;i.loading_audio_num++,"undefined"==typeof o&&(o=1);var r=function(){i.loaded_audio_num++},n=new window.Audio(e);n.volume=o,n.addEventListener("canplay",r),n.addEventListener("error",function(){throw new Error("Audio Element error. code: "+n.error.code+", message: "+n.error.message)}),n.load(),i.sounds[t]={audio:n}}},i.prototype.loadBGM=function(t,e,o,i,r){if(this.audio_context){var n=this;n.loading_audio_num++,"undefined"==typeof o&&(o=1);var a=function(e){n.loaded_audio_num++,n.bgms[t]={audio:e,volume:o,loopStart:i,loopEnd:r}},s=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;n.audio_context.decodeAudioData(t,a,s)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)}},i.prototype.isAllLoaded=function(){return this.loaded_audio_num===this.loading_audio_num},i.prototype.playSound=function(t){if(this.audio_context){if(!(t in this.sounds))throw new Error("Can't find sound '"+t+"'.");this._reserved_play_sound_name_map[t]=!0}},i.prototype.executePlaySound=function(){for(var t in this._reserved_play_sound_name_map)this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),delete this._reserved_play_sound_name_map[t]},i.prototype.playSoundByDataURL=function(t,e){if(window&&window.Audio){"undefined"==typeof e&&(e=1);var o=new window.Audio;o.volume=e,o.src=t,o.addEventListener("canplay",function(){o.play()}),o.addEventListener("error",function(){throw new Error("Audio Element error. code: "+o.error.code+", message: "+o.error.message)}),o.load()}},i.prototype.playBGM=function(t){this.stopAllBGM(),this.addBGM(t)},i.prototype.addBGM=function(t){this.audio_context&&(this.isPlayingBGM(t)&&this.stopBGM(t),this._audio_source_map[t]=this._createSourceNodeAndGainNode(t),this._audio_source_map[t].source_node.start(0))},i.prototype.changeBGM=function(t){this.isPlayingBGM(t)||this.playBGM(t)},i.prototype.stopAllBGM=function(){for(var t in this._audio_source_map)this.stopBGM(t)},i.prototype.stopBGMWithout=function(t){for(var e in this._audio_source_map)e!==t&&this.stopBGM(e)},i.prototype.stopBGM=function(t){return"undefined"==typeof t?this.stopAllBGM():(this.fadeOutBGM(.1,t),void(t in this._audio_source_map&&delete this._audio_source_map[t]))},i.prototype.isPlayingBGM=function(t){return"undefined"==typeof t?Object.keys(this._audio_source_map).length?!0:!1:t in this._audio_source_map?!0:!1},i.prototype.fadeOutAllBGM=function(t){for(var e in this._audio_source_map)this.fadeOutBGM(t,e)},i.prototype.fadeOutBGM=function(t,e){if(this.audio_context){if("undefined"==typeof e)return this.fadeOutAllBGM(t);var o=this._audio_source_map[e];if(o){var i=o.gain_node,r=i.gain,n=this.audio_context.currentTime;r.cancelScheduledValues(n),r.setValueAtTime(r.value,n);var a=n+t;r.linearRampToValueAtTime(0,a)}}},i.prototype.muteAllBGM=function(){for(var t in this._audio_source_map)this.muteBGM(t)},i.prototype.muteBGM=function(t){if(this.audio_context){if("undefined"==typeof t)return this.muteAllBGM();var e=this._audio_source_map[t];if(e){var o=e.gain_node;o.gain.setValueAtTime(0,this.audio_context.currentTime)}}},i.prototype.unMuteAllBGM=function(){for(var t in this._audio_source_map)this.unMuteBGM(t)},i.prototype.unMuteBGM=function(t){if(this.audio_context){if("undefined"==typeof t)return this.unMuteAllBGM();var e=this._audio_source_map[t];if(e){var o=e.gain_node,i=this.bgms[t];o.gain.setValueAtTime(i.volume,this.audio_context.currentTime)}}},i.prototype.unMuteWithFadeInAllBGM=function(t){for(var e in this._audio_source_map)this.unMuteWithFadeInBGM(t,e)},i.prototype.unMuteWithFadeInBGM=function(t,e){if(this.audio_context){if("undefined"==typeof e)return this.unMuteWithFadeInAllBGM(t);var o=this._audio_source_map[e];if(o){var i=this.bgms[e],r=o.gain_node,n=r.gain,a=this.audio_context.currentTime;n.setValueAtTime(n.value,a);var s=a+t;n.linearRampToValueAtTime(i.volume,s)}}},i.prototype._createSourceNodeAndGainNode=function(t){if(this.audio_context){var e=this,o=e.bgms[t],i=e.audio_context.createBufferSource();i.buffer=o.audio,("loopStart"in o||"loopEnd"in o)&&(i.loop=!0),o.loopStart&&(i.loopStart=o.loopStart),o.loopEnd&&(i.loopEnd=o.loopEnd);var r=e.audio_context.createGain();return r.gain.setValueAtTime(o.volume,e.audio_context.currentTime),i.connect(r),r.connect(e.audio_context.destination),i.start=i.start||i.noteOn,i.stop=i.stop||i.noteOff,{source_node:i,gain_node:r}}},i.prototype.progress=function(){return 0===this.loading_audio_num?1:this.loaded_audio_num/this.loading_audio_num},e.exports=i},{}],5:[function(t,e,o){"use strict";var i=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={},this._hiddenCanvas=null};i.prototype.init=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={}},i.prototype.isAllLoaded=function(){for(var t in this._fontStatues)if(!this.isLoaded(t))return!1;return!0},i.prototype.progress=function(){var t=0,e=0;for(var o in this._fontStatues)t++,this.isLoaded(o)&&e++;return 0===t?1:e/t},i.prototype.setupEvents=function(){var t=this;t.canUseCssFontLoading()?window.document.fonts.ready.then(function(e){t._isLoadedDone=!0,t._loadedFonts=e})["catch"](function(t){throw new Error("Can't load font.")}):t.canUseCssFont()?window.document.fonts.addEventListener("loadingdone",function(){t._isLoadedDone=!0,t._loadedFonts=null}):(t._isLoadedDone=!0,t._loadedFonts=null)};var r=window.document&&window.document.fonts&&window.document.fonts.ready&&document.fonts.ready.then;i.prototype.canUseCssFontLoading=function(){return r},i.prototype.canUseCssFont=function(){return window.document&&window.document.fonts&&!this.isSafari10()},i.prototype.isSafari10=function(){return navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("version/10.0")},i.prototype.isLoaded=function(t){if(!(t in this._fontStatues))return!1;var e=this._fontStatues[t];if(e.is_loaded)return!0;var o=this.checkFontLoaded(t);return o&&(e.is_loaded=!0),o},i.prototype.checkFontLoaded=function(t){if(this.canUseCssFontLoading())return window.document.fonts.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=window.document.createElement("canvas"));var e,o,i=this._hiddenCanvas.getContext("2d"),r="abcdefghijklmnopqrstuvwxyz";return i.font="40px "+t+", sans-serif",e=i.measureText(r).width,i.font="40px sans-serif",o=i.measureText(r).width,e!==o},i.prototype.loadFont=function(t,e,o){return window.document?(this._fontStatues[t]={is_loaded:!1},this._createFontFaceStyle(t,e,o),this._createFontLoadingDOM(t),!0):!1},i.prototype._createFontFaceStyle=function(t,e,o){var i=window.document.getElementsByTagName("head");if(!i)throw new Error("Fontloader class needs head tag in html file.");var r;r="undefined"!=typeof o?'@font-face { font-family: "'+t+'"; src: url("'+e+'") format("'+o+'"); }':'@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';var n=window.document.createElement("style");n.type="text/css",i.item(0).appendChild(n),n.sheet.insertRule(r,0)},i.prototype._createFontLoadingDOM=function(t){var e=window.document.createElement("div"),o=window.document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(o),window.document.body.appendChild(e)},e.exports=i},{}],6:[function(t,e,o){"use strict";var i=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};i.prototype.init=function(){for(var t in this.images)this.images[t].image.src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},i.prototype.loadImage=function(t,e,o,i){var r=this;r.loading_image_num++;var n=function(){r.loaded_image_num++},a=new Image;a.src=e,a.onload=n,this.images[t]={scale_width:o,scale_height:i,image:a}},i.prototype.isAllLoaded=function(){return this.loaded_image_num===this.loading_image_num},i.prototype.isLoaded=function(t){return t in this.images?!0:!1},i.prototype.getImage=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].image},i.prototype.getScaleWidth=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].scale_width},i.prototype.getScaleHeight=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t].scale_height},i.prototype.progress=function(){return 0===this.loading_image_num?1:this.loaded_image_num/this.loading_image_num},e.exports=i},{}],7:[function(t,e,o){"use strict";var i={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=i},{}],8:[function(t,e,o){"use strict";var i={SPRITE3D:{}};i.SPRITE3D.V_ITEM_SIZE=3,i.SPRITE3D.V_ITEM_NUM=4,i.SPRITE3D.V_SIZE=i.SPRITE3D.V_ITEM_SIZE*i.SPRITE3D.V_ITEM_NUM,i.SPRITE3D.C_ITEM_SIZE=2,i.SPRITE3D.C_ITEM_NUM=4,i.SPRITE3D.C_SIZE=i.SPRITE3D.C_ITEM_SIZE*i.SPRITE3D.C_ITEM_NUM,i.SPRITE3D.I_ITEM_SIZE=1,i.SPRITE3D.I_ITEM_NUM=6,i.SPRITE3D.I_SIZE=i.SPRITE3D.I_ITEM_SIZE*i.SPRITE3D.I_ITEM_NUM,i.SPRITE3D.A_ITEM_SIZE=4,i.SPRITE3D.A_ITEM_NUM=4,i.SPRITE3D.A_SIZE=i.SPRITE3D.A_ITEM_SIZE*i.SPRITE3D.A_ITEM_NUM,e.exports=i},{}],9:[function(t,e,o){"use strict";var i=t("webgl-debug"),r=t("./util"),n=t("./manager/debug"),a=t("./manager/scene"),s=t("./manager/time"),u=t("./manager/save"),c=t("./manager/input"),h=t("./asset_loader/image"),l=t("./asset_loader/audio"),_=t("./asset_loader/font"),p=t("./storage/scenario"),d=t("./shader_program"),f=t("./shader/main.vs"),m=t("./shader/main.fs"),g=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?(this.gl=this.createWebGLContext(this.canvas_dom),this.sprite_3d_shader=new d(this.gl,f,m,["aTextureCoordinates","aVertexPosition","aColor"],["uMVMatrix","uPMatrix","uSampler"])):this.ctx=this.canvas_dom.getContext("2d"),this.debug_manager=new n(this),this.scene_manager=new a(this),this.time_manager=new s(this),this.save_manager=new u,this.input_manager=new c,this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this._cursor_image_name=null,this._default_cursor_image_name=null,this.frame_count=0,this.request_id=null,this.image_loader=new h,this.audio_loader=new l,this.font_loader=new _,this.save_manager.addClass("scenario",p)};g.prototype.init=function(){this.frame_count=0,this.request_id=null,this.debug_manager.init(),this.scene_manager.init(),this.time_manager.init(),this.input_manager.init(),this.image_loader.init(),this.audio_loader.init(),this.font_loader.init(),this.save_manager.initialLoad()},g.prototype.reload=function(){this.init()},g.prototype.isRunning=function(){return this.request_id?!0:!1},g.prototype.startRun=function(){this.isRunning()||this.run()},g.prototype.stopRun=function(){this.isRunning()&&(cancelAnimationFrame(this.request_id),this.request_id=null)},g.prototype.run=function(){this.debug_manager.beforeRun(),this.scene_manager.beforeRun(),this.input_manager.beforeRun(),this.time_manager.executeEvents(),this.audio_loader.executePlaySound(),this.changeDefaultCursorImage();var t=this.scene_manager.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw(),this.scene_manager.drawTransition(),this._renderCursorImage()),this.frame_count++,this.debug_manager.afterRun(),this.input_manager.afterRun(),this.request_id=requestAnimationFrame(r.bind(this.run,this))},g.prototype.clearCanvas=function(){this.is2D()?this.ctx.clearRect(0,0,this.width,this.height):this.is3D()&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))},g.prototype.is2D=function(){return this.ctx?!0:!1},g.prototype.is3D=function(){return this.gl?!0:!1},g.prototype.isKeyDown=function(t){return this.input_manager.isKeyDown(t)},g.prototype.isKeyPush=function(t){return this.input_manager.isKeyPush(t)},g.prototype.getKeyDownTime=function(t){return this.input_manager.getKeyDownTime(t)},g.prototype.isLeftClickDown=function(){return this.input_manager.isLeftClickDown()},g.prototype.isLeftClickPush=function(){return this.input_manager.isLeftClickPush()},g.prototype.isRightClickDown=function(){return this.input_manager.isRightClickDown()},g.prototype.isRightClickPush=function(){return this.input_manager.isRightClickPush()},g.prototype.mousePositionX=function(){return this.input_manager.mousePositionX()},g.prototype.mousePositionY=function(){return this.input_manager.mousePositionX()},g.prototype.mouseMoveX=function(){return this.input_manager.mouseMoveX()},g.prototype.mouseMoveY=function(){return this.input_manager.mouseMoveY()},g.prototype.mouseScroll=function(){return this.input_manager.mouseScroll()},g.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},g.prototype.isAllLoaded=function(){return this.image_loader.isAllLoaded()&&this.audio_loader.isAllLoaded()&&this.font_loader.isAllLoaded()?!0:!1},g.prototype.setupEvents=function(){window&&(window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),this._setupError(),this.font_loader.setupEvents(),this.input_manager.setupEvents(this.canvas_dom))},g.prototype._setupError=function(){var t=this;window.onerror=function(e,o,i,r,n){t.showError(e,o,i,r,n)}},g.prototype.showError=function(t,e,o,i,r){if(this.clearCanvas(),this.is2D()){var n=this.ctx,a=24,s=80;n.save(),n.fillStyle="black",n.fillRect(0,0,this.width,this.height),n.restore(),n.save(),n.fillStyle="red",n.font="48px 'sans-serif'",n.fillText("Error",a,s),s+=48,n.fillStyle="white",n.font="24px 'sans-serif'",n.fillText(t,a,s),s+=29,n.fillText("Time: "+(new Date).toString(),a,s),s+=29,n.fillText("File: "+e,a,s),s+=29,n.fillText("Line: "+o+", Column:"+i,a,s),s+=29,n.fillText("Stack Trace: ",a,s),s+=29,a+=29;for(var u=r.stack.split("\n"),c=0,h=u.length;h>c;c++){var l=u[c];n.fillText(l,a,s),s+=29}n.restore()}else this.is3D()&&window.alert(t+"\n"+o+":"+i)},g.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=i.makeDebugContext(e)}catch(o){throw o}if(!e)throw new Error("Could not initialize WebGL");return e},g.prototype.enableCursorImage=function(t){this.canvas_dom.style.cursor="none",this._default_cursor_image_name=t},g.prototype.isUsingCursorImage=function(){return this._default_cursor_image_name?!0:!1},g.prototype.changeCursorImage=function(t){this._cursor_image_name=t},g.prototype.disableCursorImage=function(t){this.isUsingCursorImage()&&(this.canvas_dom.style.cursor="auto",this._cursor_image_name=null,this._default_cursor_image_name=null)},g.prototype.changeDefaultCursorImage=function(){this.isUsingCursorImage()&&(this._cursor_image_name=this._default_cursor_image_name)},g.prototype._renderCursorImage=function(){if(this.isUsingCursorImage()&&this.image_loader.isLoaded(this._cursor_image_name)){var t=this.ctx;if(t){t.save();var e=this.image_loader.getImage(this._cursor_image_name),o=this.input_manager.mousePositionX(),i=this.input_manager.mousePositionY(),r=this.image_loader.getScaleWidth(this._cursor_image_name),n=this.image_loader.getScaleHeight(this._cursor_image_name);t.translate(o,i),t.drawImage(e,0,0,e.width*r,e.height*n),t.restore()}}},g.prototype.setTimeout=function(t,e){console.error("core's setTimeout method is deprecated."),this.time_manager.setTimeout(t,e)},g.prototype.currentScene=function(){return console.error("core's currentScene method is deprecated."),this.scene_manager.currentScene.apply(this.scene_manager,arguments)},g.prototype.addScene=function(t,e){return console.error("core's addScene method is deprecated."),this.scene_manager.addScene.apply(this.scene_manager,arguments)},g.prototype.changeScene=function(t,e){return console.error("core's changeScene method is deprecated."),this.scene_manager.changeScene.apply(this.scene_manager,arguments)},g.prototype.changeNextSceneIfReserved=function(){return console.error("core's changeNextSceneIfReserved method is deprecated."),this.scene_manager.changeNextSceneIfReserved.apply(this.scene_manager,arguments)},g.prototype.changeSceneWithLoading=function(t,e){return console.error("core's changeSceneWithLoading method is deprecated."),this.scene_manager.changeSceneWithLoading.apply(this.scene_manager,arguments)},e.exports=g},{"./asset_loader/audio":4,"./asset_loader/font":5,"./asset_loader/image":6,"./manager/debug":11,"./manager/input":12,"./manager/save":13,"./manager/scene":15,"./manager/time":17,"./shader/main.fs":47,"./shader/main.vs":48,"./shader_program":49,"./storage/scenario":52,"./util":53,"webgl-debug":30}],10:[function(t,e,o){"use strict";var i={util:t("./util"),core:t("./core"),shader_program:t("./shader_program"),constant:t("./util").assign(t("./constant/button"),{button:t("./constant/button")}),serif_manager:t("./manager/scenario"),save_manager:t("./manager/save"),manager:{save:t("./manager/save"),scenario:t("./manager/scenario")},scene:{base:t("./scene/base"),loading:t("./scene/loading"),movie:t("./scene/movie")},object:{base:t("./object/base"),point:t("./object/point"),sprite:t("./object/sprite"),sprite3d:t("./object/sprite3d"),pool_manager:t("./object/pool_manager"),pool_manager3d:t("./object/pool_manager3d"),ui_parts:t("./object/ui_parts")},asset_loader:{image:t("./asset_loader/image"),audio:t("./asset_loader/audio"),font:t("./asset_loader/font")},storage:{base:t("./storage/base"),save:t("./storage/save")},Util:t("./util"),Core:t("./core"),ShaderProgram:t("./shader_program"),Constant:{Button:t("./constant/button")},Manager:{Save:t("./manager/save"),Scenario:t("./manager/scenario")},Scene:{Base:t("./scene/base"),Loading:t("./scene/loading"),Movie:t("./scene/movie")},Object:{Base:t("./object/base"),Point:t("./object/point"),Sprite:t("./object/sprite"),Sprite3d:t("./object/sprite3d"),PoolManager:t("./object/pool_manager"),PoolManager3d:t("./object/pool_manager3d"),UIParts:t("./object/ui_parts"),UI:{Base:t("./object/ui/base"),Text:t("./object/ui/text"),Spinner:t("./object/ui/spinner"),Group:t("./object/ui/group"),Image:t("./object/ui/image")}},AssetLoader:{Image:t("./asset_loader/image"),Audio:t("./asset_loader/audio"),Font:t("./asset_loader/font")},Storage:{Base:t("./storage/base"),Save:t("./storage/save")},Master:{RepositoryGenerator:t("./master/repository_generator")}};e.exports=i},{"./asset_loader/audio":4,"./asset_loader/font":5,"./asset_loader/image":6,"./constant/button":7,"./core":9,"./manager/save":13,"./manager/scenario":14,"./master/repository_generator":19,"./object/base":32,"./object/point":33,"./object/pool_manager":34,"./object/pool_manager3d":35,"./object/sprite":36,"./object/sprite3d":37,"./object/ui/base":38,"./object/ui/group":39,"./object/ui/image":40,"./object/ui/spinner":41,"./object/ui/text":42,"./object/ui_parts":43,"./scene/base":44,"./scene/loading":45,"./scene/movie":46,"./shader_program":49,"./storage/base":50,"./storage/save":51,"./util":53}],11:[function(t,e,o){"use strict";var i=t("../util"),r=60,n=function(t){this.core=t,this.dom=null,this.is_debug_mode=!1,this._is_showing_collision_area=!1,this._is_showing_fps=!1,this._variables={},this._before_time=0,this._fps=0};n.prototype.init=function(){this._before_time=0,this._fps=0},n.prototype.setOn=function(t){this.is_debug_mode=!0,this.dom=t},n.prototype.setOff=function(){this.is_debug_mode=!1,this.dom=null},n.prototype.set=function(t,e){this.is_debug_mode&&(this._variables[t]=e)},n.prototype.get=function(t){return this.is_debug_mode?this._variables[t]:null},n.prototype.beforeRun=function(){this.isShowingFps()&&this._calculateFps()},n.prototype._calculateFps=function(){if(this.core.frame_count%r===0){var t=Date.now();this._before_time&&(this._fps=Math.floor(1e3*r/(t-this._before_time))),this._before_time=t}},n.prototype.afterRun=function(){this.isShowingFps()&&this._renderFps()},n.prototype._renderFps=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.textAlign="left",t.font="16px 'sans-serif'",t.fillText("FPS: "+this._fps,this.core.width-70,this.core.height-10),t.restore()},n.prototype.addMenuText=function(t){if(this.is_debug_mode){var e=window.document.createElement("pre");e.textContent=t,this.dom.appendChild(e)}},n.prototype.addNewLine=function(){if(this.is_debug_mode){var t=window.document.createElement("br");this.dom.appendChild(t)}},n.prototype.addMenuImage=function(t){if(this.is_debug_mode){var e=window.document.createElement("img");e.src=t,this.dom.appendChild(e)}},n.prototype.addMenuButton=function(t,e){if(this.is_debug_mode){var o=this.core,i=window.document.createElement("input");i.setAttribute("type","button"),i.setAttribute("value",t),i.onclick=function(){e(o)},this.dom.appendChild(i)}},n.prototype.addMenuSelect=function(t,e,o){if(this.is_debug_mode){var i=this.core,r=window.document.createElement("select"),n=document.createElement("option");n.setAttribute("value",""),n.appendChild(document.createTextNode(t)),r.appendChild(n),r.onchange=function(){""!==r.value&&o(i,r.value)};for(var a=0,s=e.length;s>a;a++){var u=e[a],c=u.value,h=h in u?u.name:c,l=document.createElement("option");l.setAttribute("value",c),l.appendChild(document.createTextNode(h)),r.appendChild(l)}this.dom.appendChild(r)}},n.prototype.addGitLatestCommitInfo=function(t,e,o){if(this.is_debug_mode){o=o||"master";var i=window.document.createElement("pre");this.dom.appendChild(i);var r="https://api.github.com/repos/"+t+"/"+e+"/branches/"+o,n=new XMLHttpRequest;n.onload=function(){if(200===n.status){var t,e=n.response;if(!e)throw new Error("Can't parse git lastest commit info");t=JSON.parse(e),i.textContent="last update date: "+new Date(t.commit.commit.author.date)+"\n"}},n.open("GET",r,!0),n.send(null)}};var a=function(t){for(var e=t.split(","),o=atob(e[1]),i=e[0].split(":")[1].split(";")[0],r=new Uint8Array(o.length),n=0;n<o.length;n++)r[n]=o.charCodeAt(n);var a=new Blob([r],{type:i});return a};n.prototype.addCaputureImageButton=function(t,e){if(this.is_debug_mode){var o=this.core.canvas_dom;this.addMenuButton(t,function(){var t=e;if("undefined"==typeof e){var r=new Date;t=Math.floor(r.getTime()/1e3)}var n=o.toDataURL("image/png"),s=a(n);i.downloadBlob(s,t+".png")})}};var s={array_buffer:"readAsArrayBuffer",binary_string:"readAsBinaryString",text:"readAsText",data_url:"readAsDataURL"};n.prototype.addUploadFileButton=function(t,e,o){if(this.is_debug_mode){if("undefined"==typeof o&&(o="array_buffer"),!s[o])throw new Error("Unknown read_type: "+o);var i=window.document.createElement("pre");i.style.display="inline",i.textContent=t,this.dom.appendChild(i);var r=window.document.createElement("input");r.setAttribute("type","file");var n=s[o],a=this.core;r.onchange=function(t){if(r.value){var o=t.target.files[0],i=new FileReader,s=o.type;i.onload=function(t){var o=t.target.result;e(a,s,o)},i[n](o)}},r.onclick=function(t){r.value=null},this.dom.appendChild(r)}},n.prototype.setShowingCollisionAreaOn=function(){return this.is_debug_mode?void(this._is_showing_collision_area=!0):null},n.prototype.setShowingCollisionAreaOff=function(){return this.is_debug_mode?void(this._is_showing_collision_area=!1):null},n.prototype.isShowingCollisionArea=function(){return this.is_debug_mode?this._is_showing_collision_area:!1},n.prototype.setShowingFpsOn=function(){return this.is_debug_mode?void(this._is_showing_fps=!0):null},n.prototype.setShowingFpsOff=function(){return this.is_debug_mode?void(this._is_showing_fps=!1):null},n.prototype.isShowingFps=function(){return this.is_debug_mode?this._is_showing_fps:!1},e.exports=n},{"../util":53}],12:[function(t,e,o){"use strict";var i=t("../constant/button"),r=t("../util"),n=t("../object/point"),a={0:i.BUTTON_Z,1:i.BUTTON_X,2:i.BUTTON_SPACE,3:i.BUTTON_SHIFT},s=function(){this.current_keyflag=0,this.before_keyflag=0,this._key_bit_code_to_down_time={},this._button_id_to_key_bit_code=r.shallowCopyHash(a),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0,this._is_gamepad_usable=!1};s.prototype.init=function(){this.current_keyflag=0,this.before_keyflag=0,this.initPressedKeyTime(),this._button_id_to_key_bit_code=r.shallowCopyHash(a),this.is_left_clicked=!1,this.is_right_clicked=!1,this.before_is_left_clicked=!1,this.before_is_right_clicked=!1,this.mouse_change_x=0,this.mouse_change_y=0,this.mouse_x=0,this.mouse_y=0,this.mouse_scroll=0},s.prototype.beforeRun=function(){this.handleGamePad(),this.handlePressedKeyTime()},s.prototype.afterRun=function(){this.before_keyflag=this.current_keyflag,this.before_is_left_clicked=this.is_left_clicked,this.before_is_right_clicked=this.is_right_clicked,this.mouse_scroll=0,this.mouse_change_x=0,this.mouse_change_y=0},s.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},s.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},s.prototype.getKeyDownTime=function(t){return this._key_bit_code_to_down_time[t]},s.prototype.handleMouseDown=function(t){"which"in t?(this.is_left_clicked=1===t.which,this.is_right_clicked=3===t.which):"button"in t&&(this.is_left_clicked=1===t.button,this.is_right_clicked=2===t.button),t.preventDefault()},s.prototype.handleMouseUp=function(t){"which"in t?(this.is_left_clicked=1===t.which?!1:this.is_left_clicked,this.is_right_clicked=3===t.which?!1:this.is_right_clicked):"button"in t&&(this.is_left_clicked=1===t.button?!1:this.is_left_clicked,this.is_right_clicked=2===t.button?!1:this.is_right_clicked),t.preventDefault()},s.prototype.isLeftClickDown=function(){return this.is_left_clicked},s.prototype.isLeftClickPush=function(){return this.is_left_clicked&&!this.before_is_left_clicked},s.prototype.isRightClickDown=function(){return this.is_right_clicked},s.prototype.isRightClickPush=function(){return this.is_right_clicked&&!this.before_is_right_clicked},s.prototype.handleMouseMove=function(t){t=t?t:window.event,t.preventDefault();var e=t.target.getBoundingClientRect(),o=t.clientX-e.left,i=t.clientY-e.top;this.mouse_change_x=this.mouse_x-o,this.mouse_change_y=this.mouse_y-i,this.mouse_x=o,this.mouse_y=i},s.prototype.mousePositionPoint=function(t){var e=this.mousePositionX(),o=this.mousePositionY(),i=new n(t);return i.init(),i.setPosition(e,o),i},s.prototype.mousePositionX=function(){return this.mouse_x},s.prototype.mousePositionY=function(){return this.mouse_y},s.prototype.mouseMoveX=function(){return this.mouse_change_x},s.prototype.mouseMoveY=function(){return this.mouse_change_y},s.prototype.handleMouseWheel=function(t){this.mouse_scroll=t.detail?t.detail:-t.wheelDelta/120},s.prototype.mouseScroll=function(){return this.mouse_scroll},s.prototype.handleTouchDown=function(t){this.is_left_clicked=!0,t.preventDefault()},s.prototype.handleTouchUp=function(t){this.is_left_clicked=!1,t.preventDefault()},s.prototype.handleTouchMove=function(t){t.preventDefault();var e=t.touches[0].clientX,o=t.touches[0].clientY;this.mouse_change_x=this.mouse_x-e,this.mouse_change_y=this.mouse_y-o,this.mouse_x=e,this.mouse_y=o},s.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=i.BUTTON_SHIFT;break;case 32:e=i.BUTTON_SPACE;break;case 37:e=i.BUTTON_LEFT;break;case 38:e=i.BUTTON_UP;break;case 39:e=i.BUTTON_RIGHT;break;case 40:e=i.BUTTON_DOWN;break;case 88:e=i.BUTTON_X;break;case 90:e=i.BUTTON_Z}return e},s.prototype.handleGamePad=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads(),e=t[0];if(e){for(var o=0,r=e.buttons.length;r>o;o++)o in this._button_id_to_key_bit_code&&(e.buttons[o].pressed?this.current_keyflag|=this.getKeyByButtonId(o):this.current_keyflag&=~this.getKeyByButtonId(o));e.axes[1]<-.5?this.current_keyflag|=i.BUTTON_UP:this.current_keyflag&=~i.BUTTON_UP,e.axes[1]>.5?this.current_keyflag|=i.BUTTON_DOWN:this.current_keyflag&=~i.BUTTON_DOWN,e.axes[0]<-.5?this.current_keyflag|=i.BUTTON_LEFT:this.current_keyflag&=~i.BUTTON_LEFT,e.axes[0]>.5?this.current_keyflag|=i.BUTTON_RIGHT:this.current_keyflag&=~i.BUTTON_RIGHT}}},s.prototype.initPressedKeyTime=function(){this._key_bit_code_to_down_time={};for(var t in i){var e=i[t];this._key_bit_code_to_down_time[e]=0}},s.prototype.handlePressedKeyTime=function(){for(var t in i){var e=i[t];this.isKeyDown(e)?this._key_bit_code_to_down_time[e]++:this._key_bit_code_to_down_time[e]=0}},s.prototype.setupEvents=function(t){var e=this;window.onkeydown=function(t){e.handleKeyDown(t)},window.onkeyup=function(t){e.handleKeyUp(t)},t.onmousedown=function(t){e.handleMouseDown(t)},t.onmouseup=function(t){e.handleMouseUp(t)},t.onmousemove=function(t){e.handleMouseMove(t)},t.ontouchstart=function(t){e.handleTouchDown(t)},t.ontouchend=function(t){e.handleTouchUp(t)},t.ontouchmove=function(t){e.handleTouchMove(t)};var o=window.navi&&/Firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener&&t.addEventListener(o,function(t){var o=window.event||t;e.handleMouseWheel(o)},!1),t.oncontextmenu=function(){return!1},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&(e._is_gamepad_usable=!0)},s.prototype.getKeyByButtonId=function(t){var e=this._button_id_to_key_bit_code[t];
return e||(e=0),e},s.prototype.getAnyButtonId=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads(),e=t[0];if(e)for(var o=0;o<e.buttons.length;o++)if(e.buttons[o].pressed)return o}},e.exports=s},{"../constant/button":7,"../object/point":33,"../util":53}],13:[function(t,e,o){"use strict";var i=function(){this._name_to_class={}};i.prototype.addClass=function(t,e){if("undefined"!=typeof this[t])throw new Error(t+" is reserved word.");this._name_to_class[t]=e},i.prototype.initialLoad=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]||(this[t]=e.load())}},i.prototype.load=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]=e.load()}},i.prototype.save=function(){for(var t in this._name_to_class)this[t].save()},i.prototype.reload=function(){for(var t in this._name_to_class)this[t].reload()},i.prototype.del=function(){for(var t in this._name_to_class)this[t].del()},e.exports=i},{}],14:[function(t,e,o){"use strict";var i=10,r=0,n=t("../util"),a=t("./serif_abolished_notifier_base"),s=function(t,e){this.core=t,e=e||{},this._typography_speed="typography_speed"in e?e.typography_speed:i,this._criteria_function_map="criteria"in e?e.criteria:{},this._event_to_callback={printend:function(){}},this._timeoutID=null,this._script=null,this._progress=null,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]};n.inherit(s,a),s.prototype.init=function(t){if(!t)throw new Error("set script arguments to use scenario_manager class");this._timeoutID&&this._stopPrintLetter(),this._script=t.slice(),this._progress=-1,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]},s.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},s.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},s.prototype.start=function(t){if(!this._script)throw new Error("start method must be called after instance was initialized.");this.isEnd()||(this._progress=t||0,this._chooseNextSerifScript(),this._setupCurrentSerifScript())},s.prototype.next=function(t){return t=t||0,this.isEnd()?!1:(this._progress++,this._chooseNextSerifScript(t),this._setupCurrentSerifScript(),!0)},s.prototype._chooseNextSerifScript=function(t){var e,o=this._script[this._progress],i=o.type||"serif";if("serif"===i);else if("junction_serif"===i){if(e=o.serifs[t],!e)throw new Error("chosen junction index '"+t+"' does not exists in next serifs array");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e))}else{if("criteria_serif"!==i)throw new Error("Unknown serif script type: "+i);var r=o.criteria,n=o.arguments;if(t=this._execCriteriaFunction(r,n),e=o.serifs[t],!e)throw new Error("choisen criteria index '"+t+"' does not exists");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e)),this._chooseNextSerifScript()}},s.prototype._execCriteriaFunction=function(t,e){var o=this._criteria_function_map[t];if(!o)throw new Error(t+" criteria does not exists");return o.apply({},[this.core].concat(e))},s.prototype.isStart=function(){return this._progress>-1},s.prototype.isEnd=function(){return this._progress===this._script.length-1},s.prototype.isPrintLetterEnd=function(){var t=this._current_message_letter_list.length;return this._letter_idx>=t?!0:!1},s.prototype._setupCurrentSerifScript=function(){var t=this._script[this._progress];this._setupChara(t),this._setupBackground(t),this._setupJunction(t),this._setupOption(t),this._saveSerifPlayed(t),"string"==typeof t.serif?this._setupSerif(t):this.isEnd()||this.next()},s.prototype._setupChara=function(t){var e=t.pos,o=t.chara,i=t.exp;e||(e=r),this._current_talking_pos=e,this._pos_to_chara_id_map[this._current_talking_pos]=o,this._pos_to_exp_id_map[this._current_talking_pos]=i},s.prototype._setupBackground=function(t){var e=t.background;this._is_background_changed=!1,e&&this._current_bg_image_name!==e&&(this._is_background_changed=!0,this._current_bg_image_name=e)},s.prototype._setupJunction=function(t){var e=t.junction;this._current_junction_list=e||[]},s.prototype._setupOption=function(t){this._current_option=t.option||{}},s.prototype._saveSerifPlayed=function(t){var e=t.id,o=t.save;if(o){if("undefined"==typeof e)throw new Error("script save property needs id property");this.core.save_manager.scenario.incrementPlayedCount(e)}},s.prototype._setupSerif=function(t){var e=t.serif;this._stopPrintLetter(),this._current_message_letter_list=e.split("");var o=e.split("\n");this._current_message_max_length_letters=0;for(var i=0,r=o.length;r>i;i++)this._current_message_max_length_letters<o[i].length&&(this._current_message_max_length_letters=o[i].length);this._current_message_sentenses_num=o.length,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[],this._startPrintLetter()},s.prototype._startPrintLetter=function(){this._printLetter(),this.isPrintLetterEnd()?this._timeoutID=null:this._timeoutID=setTimeout(n.bind(this._startPrintLetter,this),this._typography_speed)},s.prototype._stopPrintLetter=function(){null!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},s.prototype._printLetter=function(){if(!this.isPrintLetterEnd()){var t=this._current_message_letter_list,e=t[this._letter_idx++];this._current_printed_sentences[this._sentences_line_num]||(this._current_printed_sentences[this._sentences_line_num]=""),"\n"===e?this._sentences_line_num++:this._current_printed_sentences[this._sentences_line_num]+=e,this.isPrintLetterEnd()&&this._event_to_callback.printend()}},s.prototype.resumePrintLetter=function(){this._startPrintLetter()},s.prototype.pausePrintLetter=function(){this._stopPrintLetter()},s.prototype.getCurrentPrintedSentences=function(){return this._current_printed_sentences},s.prototype.getCurrentSentenceNum=function(){return this._current_message_sentenses_num},s.prototype.getCurrentMaxLengthLetters=function(){return this._current_message_max_length_letters},s.prototype.isBackgroundChanged=function(){return this._is_background_changed},s.prototype.getCurrentBackgroundImageName=function(){return this._current_bg_image_name},s.prototype.getCurrentOption=function(){return this._current_option},s.prototype.getCurrentCharaNameByPosition=function(t){return t=t||r,this._pos_to_chara_id_map[t]},s.prototype.getCurrentCharaExpressionByPosition=function(t){return t=t||r,this._pos_to_exp_id_map[t]},s.prototype.isCurrentTalkingByPosition=function(t){return this._current_talking_pos===t},s.prototype.isCurrentSerifExistsJunction=function(){return this._current_junction_list.length>0},s.prototype.getCurrentJunctionList=function(){return this._current_junction_list},e.exports=s},{"../util":53,"./serif_abolished_notifier_base":16}],15:[function(t,e,o){"use strict";var i=t("../scene/loading"),r=function(t){this.core=t,this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._scenes={},this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this.addScene("loading",new i(t))};r.prototype.init=function(){this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null},r.prototype.beforeRun=function(){this._changeNextSceneIfReserved()},r.prototype.currentScene=function(){return null===this._current_scene?null:this._scenes[this._current_scene]},r.prototype.addScene=function(t,e){this._scenes[t]=e},r.prototype.changeScene=function(t,e){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");var o=Array.prototype.slice.call(arguments);this._reserved_next_scene_name_and_arguments=o,this._is_reserved_next_scene_init=!0,this._current_scene||this._changeNextSceneIfReserved()},r.prototype.returnScene=function(t){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");this._reserved_next_scene_name_and_arguments=[t],this._is_reserved_next_scene_init=!1},r.prototype._changeNextSceneIfReserved=function(){if(this._reserved_next_scene_name_and_arguments)if(this.isSetFadeOut()&&!this.isInFadeOut())this.startFadeOut();else if(this.isSetFadeOut()&&this.isInFadeOut());else{this._current_scene=this._reserved_next_scene_name_and_arguments.shift();var t=this.currentScene(),e=this._reserved_next_scene_name_and_arguments;this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},r.prototype.changeSceneWithLoading=function(t,e){e||(e={}),this.changeScene("loading",e,t)},r.prototype.setFadeIn=function(t,e){this._fade_in_duration=t||30,this._fade_in_color=e||"white",this._startFadeIn()},r.prototype._startFadeIn=function(){this._quitFadeOut(),this._fade_in_start_frame_count=this.core.frame_count},r.prototype._quitFadeIn=function(){this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null},r.prototype.isInFadeIn=function(){return null!==this._fade_in_start_frame_count?!0:!1},r.prototype.setFadeOut=function(t,e){t="undefined"!=typeof t?t:30,this._fade_out_duration=t,this._fade_out_color=e||"black"},r.prototype.startFadeOut=function(){this.isSetFadeOut()&&(this._quitFadeIn(),this._fade_out_start_frame_count=this.core.frame_count)},r.prototype._quitFadeOut=function(){this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null},r.prototype.isInFadeOut=function(){return null!==this._fade_out_start_frame_count?!0:!1},r.prototype.isSetFadeOut=function(){return this._fade_out_duration&&this._fade_out_color?!0:!1},r.prototype.drawTransition=function(){var t,e=this.core.ctx;this.isInFadeIn()?(e.save(),t=this.core.frame_count-this._fade_in_start_frame_count<this._fade_in_duration?1-(this.core.frame_count-this._fade_in_start_frame_count)/this._fade_in_duration:0,e.globalAlpha=t,e.fillStyle=this._fade_in_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),0===t&&this._quitFadeIn()):this.isInFadeOut()&&(e.save(),t=this.core.frame_count-this._fade_out_start_frame_count<this._fade_out_duration?(this.core.frame_count-this._fade_out_start_frame_count)/this._fade_out_duration:1,e.globalAlpha=t,e.fillStyle=this._fade_out_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),1===t&&this._quitFadeOut())},e.exports=r},{"../scene/loading":45}],16:[function(t,e,o){"use strict";var i=function(t){};i.prototype.init=function(t){return console.error("this method is abolished.")},i.prototype.setAutoStart=function(t){return console.error("this method is abolished.")},i.prototype.isEnd=function(){return console.error("this method is abolished.")},i.prototype.isStart=function(){return console.error("this method is abolished.")},i.prototype.next=function(){return console.error("this method is abolished.")},i.prototype._showBackground=function(t){return console.error("this method is abolished.")},i.prototype._showChara=function(t){return console.error("this method is abolished.")},i.prototype._setOption=function(t){return console.error("this method is abolished.")},i.prototype._printMessage=function(t){return console.error("this method is abolished.")},i.prototype.isWaitingNext=function(){return console.error("this method is abolished.")},i.prototype.isEndPrinting=function(){return console.error("this method is abolished.")},i.prototype._startPrintMessage=function(){return console.error("this method is abolished.")},i.prototype._cancelPrintMessage=function(){return console.error("this method is abolished.")},i.prototype.startPrintMessage=function(){return console.error("this method is abolished.")},i.prototype.cancelPrintMessage=function(){return console.error("this method is abolished.")},i.prototype.isBackgroundChanged=function(){return console.error("this method is abolished.")},i.prototype.getBackgroundImageName=function(){return console.error("this method is abolished.")},i.prototype.getImageName=function(t){return console.error("this method is abolished.")},i.prototype.getChara=function(t){return console.error("this method is abolished.")},i.prototype.isTalking=function(t){return console.error("this method is abolished.")},i.prototype.getOption=function(){return console.error("this method is abolished.")},i.prototype.lines=function(){return console.error("this method is abolished.")},i.prototype.getSerifRowsCount=function(){return console.error("this method is abolished.")},i.prototype.right_image=function(){return console.error("this method is abolished.")},i.prototype.left_image=function(){return console.error("this method is abolished.")},i.prototype.is_right_talking=function(){return console.error("this method is abolished.")},i.prototype.is_left_talking=function(){return console.error("this method is abolished.")},i.prototype.font_color=function(){return console.error("this method is abolished.")},i.prototype.is_end=function(){return console.error("this method is abolished.")},i.prototype.is_background_changed=function(){return console.error("this method is abolished.")},i.prototype.background_image=function(){return console.error("this method is abolished.")},e.exports=i},{}],17:[function(t,e,o){"use strict";var i=0,r=function(t){this.core=t,this.events={}};r.prototype.init=function(){this.events={}},r.prototype.setTimeout=function(t,e){var o=this.core.frame_count,r=o+e,n=++i;return this.events[r]||(this.events[r]={}),this.events[r][n]={callback:t},n},r.prototype.clearTimeout=function(t){for(var e in this.events){var o=this.events[e];if(t in o)return delete o[t],!0}return!1},r.prototype.executeEvents=function(){var t=this.core.frame_count,e=this.events[t];if(e){for(var o in e){var i=e[o];i.callback()}delete this.events[t]}},e.exports=r},{}],18:[function(t,e,o){"use strict";var i={};i.exec=function(t,e){if(!t||"object"!=typeof t)throw new Error("type_info argument must be set");if(e=e||{pk:null},!e.pk)throw new Error("pk option must be set");var o=function(t){this._data=t||{}};for(var i in t){t[i];!function(t){o.prototype[t]=function(){return this._data[t]}}(i)}return o},e.exports=i},{}],19:[function(t,e,o){"use strict";var i=t("./dao_generator"),r={};r.exec=function(t,e,o){if(!t||"object"!=typeof t)throw new Error("type_info argument must be set");if(e=e||{pk:null,validate:!1},o=o||[],!e.pk)throw new Error("pk option must be set");for(var r=i.exec(t,e),n={},a=[],s=0,u=o.length;u>s;s++){var c=o[s];if(!(e.pk in c))throw new Error(e.pk+" key data does not exists in master data (index: "+s+")");var h=c[e.pk],l=new r(c);n[h]=l,a[s]=l}var _={};return _.DAOClass=r,_.find=function(t){return n[t]},_.all=function(){return a},_},e.exports=r},{"./dao_generator":18}],20:[function(t,e,o){o.glMatrix=t("./gl-matrix/common.js"),o.mat2=t("./gl-matrix/mat2.js"),o.mat2d=t("./gl-matrix/mat2d.js"),o.mat3=t("./gl-matrix/mat3.js"),o.mat4=t("./gl-matrix/mat4.js"),o.quat=t("./gl-matrix/quat.js"),o.vec2=t("./gl-matrix/vec2.js"),o.vec3=t("./gl-matrix/vec3.js"),o.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":21,"./gl-matrix/mat2.js":22,"./gl-matrix/mat2d.js":23,"./gl-matrix/mat3.js":24,"./gl-matrix/mat4.js":25,"./gl-matrix/quat.js":26,"./gl-matrix/vec2.js":27,"./gl-matrix/vec3.js":28,"./gl-matrix/vec4.js":29}],21:[function(t,e,o){var i={};i.EPSILON=1e-6,i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(t){i.ARRAY_TYPE=t};var r=Math.PI/180;i.toRadian=function(t){return t*r},i.equals=function(t,e){return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=i},{}],22:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.fromValues=function(t,e,o,r){var n=new i.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=o,n[3]=r,n},r.set=function(t,e,o,i,r){return t[0]=e,t[1]=o,t[2]=i,t[3]=r,t},r.transpose=function(t,e){if(t===e){var o=e[1];t[1]=e[2],t[2]=o}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},r.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=o*n-r*i;return a?(a=1/a,t[0]=n*a,t[1]=-i*a,t[2]=-r*a,t[3]=o*a,t):null},r.adjoint=function(t,e){var o=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=o,t},r.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},r.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=o[0],u=o[1],c=o[2],h=o[3];return t[0]=i*s+n*u,t[1]=r*s+a*u,t[2]=i*c+n*h,t[3]=r*c+a*h,t},r.mul=r.multiply,r.rotate=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=Math.sin(o),u=Math.cos(o);return t[0]=i*u+n*s,t[1]=r*u+a*s,t[2]=i*-s+n*u,t[3]=r*-s+a*u,t},r.scale=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=o[0],u=o[1];return t[0]=i*s,t[1]=r*s,t[2]=n*u,t[3]=a*u,t},r.fromRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=o,t[2]=-o,t[3]=i,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},r.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},r.LDU=function(t,e,o,i){return t[2]=i[2]/i[0],o[0]=i[0],o[1]=i[1],o[3]=i[3]-t[2]*o[1],[t,e,o]},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t[3]=e[3]+o[3],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t[3]=e[3]-o[3],t},r.sub=r.subtract,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=t[3],s=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(o-s)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},r.multiplyScalar=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t},r.multiplyScalarAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t[3]=e[3]+o[3]*i,t},e.exports=r},{"./common.js":21}],23:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.fromValues=function(t,e,o,r,n,a){var s=new i.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=o,s[3]=r,s[4]=n,s[5]=a,s},r.set=function(t,e,o,i,r,n,a){return t[0]=e,t[1]=o,t[2]=i,t[3]=r,t[4]=n,t[5]=a,t},r.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=o*n-i*r;return u?(u=1/u,t[0]=n*u,t[1]=-i*u,t[2]=-r*u,t[3]=o*u,t[4]=(r*s-n*a)*u,t[5]=(i*a-o*s)*u,t):null},r.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},r.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=o[0],h=o[1],l=o[2],_=o[3],p=o[4],d=o[5];return t[0]=i*c+n*h,t[1]=r*c+a*h,t[2]=i*l+n*_,t[3]=r*l+a*_,t[4]=i*p+n*d+s,t[5]=r*p+a*d+u,t},r.mul=r.multiply,r.rotate=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=Math.sin(o),h=Math.cos(o);return t[0]=i*h+n*c,t[1]=r*h+a*c,t[2]=i*-c+n*h,t[3]=r*-c+a*h,t[4]=s,t[5]=u,t},r.scale=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=o[0],h=o[1];return t[0]=i*c,t[1]=r*c,t[2]=n*h,t[3]=a*h,t[4]=s,t[5]=u,t},r.translate=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=o[0],h=o[1];return t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=i*c+n*h+s,t[5]=r*c+a*h+u,t},r.fromRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=o,t[2]=-o,t[3]=i,t[4]=0,t[5]=0,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t[3]=e[3]+o[3],t[4]=e[4]+o[4],t[5]=e[5]+o[5],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t[3]=e[3]-o[3],t[4]=e[4]-o[4],t[5]=e[5]-o[5],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*o,t[5]=e[5]*o,t},r.multiplyScalarAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t[3]=e[3]+o[3]*i,t[4]=e[4]+o[4]*i,t[5]=e[5]+o[5]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=e[0],h=e[1],l=e[2],_=e[3],p=e[4],d=e[5];return Math.abs(o-c)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(r-h)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-_)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-p)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-d)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))},e.exports=r},{"./common.js":21}],24:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},r.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromValues=function(t,e,o,r,n,a,s,u,c){var h=new i.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=o,h[3]=r,h[4]=n,h[5]=a,h[6]=s,h[7]=u,h[8]=c,h},r.set=function(t,e,o,i,r,n,a,s,u,c){return t[0]=e,t[1]=o,t[2]=i,t[3]=r,t[4]=n,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.transpose=function(t,e){if(t===e){var o=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=o,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*a-s*c,_=-h*n+s*u,p=c*n-a*u,d=o*l+i*_+r*p;return d?(d=1/d,t[0]=l*d,t[1]=(-h*i+r*c)*d,t[2]=(s*i-r*a)*d,t[3]=_*d,t[4]=(h*o-r*u)*d,t[5]=(-s*o+r*n)*d,t[6]=p*d,t[7]=(-c*o+i*u)*d,t[8]=(a*o-i*n)*d,t):null},r.adjoint=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=a*h-s*c,t[1]=r*c-i*h,t[2]=i*s-r*a,t[3]=s*u-n*h,t[4]=o*h-r*u,t[5]=r*n-o*s,t[6]=n*c-a*u,t[7]=i*u-o*c,t[8]=o*a-i*n,t},r.determinant=function(t){var e=t[0],o=t[1],i=t[2],r=t[3],n=t[4],a=t[5],s=t[6],u=t[7],c=t[8];return e*(c*n-a*u)+o*(-c*r+a*s)+i*(u*r-n*s)},r.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],_=o[0],p=o[1],d=o[2],f=o[3],m=o[4],g=o[5],y=o[6],v=o[7],M=o[8];return t[0]=_*i+p*a+d*c,t[1]=_*r+p*s+d*h,t[2]=_*n+p*u+d*l,t[3]=f*i+m*a+g*c,t[4]=f*r+m*s+g*h,t[5]=f*n+m*u+g*l,t[6]=y*i+v*a+M*c,t[7]=y*r+v*s+M*h,t[8]=y*n+v*u+M*l,t},r.mul=r.multiply,r.translate=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],_=o[0],p=o[1];return t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=u,t[6]=_*i+p*a+c,t[7]=_*r+p*s+h,t[8]=_*n+p*u+l,t},r.rotate=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],_=Math.sin(o),p=Math.cos(o);return t[0]=p*i+_*a,t[1]=p*r+_*s,t[2]=p*n+_*u,t[3]=p*a-_*i,t[4]=p*s-_*r,t[5]=p*u-_*n,t[6]=c,t[7]=h,t[8]=l,t},r.scale=function(t,e,o){var i=o[0],r=o[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},r.fromRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=o,t[2]=0,t[3]=-o,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},r.fromQuat=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=o+o,s=i+i,u=r+r,c=o*a,h=i*a,l=i*s,_=r*a,p=r*s,d=r*u,f=n*a,m=n*s,g=n*u;return t[0]=1-l-d,t[3]=h-g,t[6]=_+m,t[1]=h+g,t[4]=1-c-d,t[7]=p-f,t[2]=_-m,t[5]=p+f,t[8]=1-c-l,t},r.normalFromMat4=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],y=o*s-i*a,v=o*u-r*a,M=o*c-n*a,b=i*u-r*s,x=i*c-n*s,S=r*c-n*u,w=h*f-l*d,I=h*m-_*d,D=h*g-p*d,F=l*m-_*f,E=l*g-p*f,T=_*g-p*m,A=y*T-v*E+M*F+b*D-x*I+S*w;return A?(A=1/A,t[0]=(s*T-u*E+c*F)*A,t[1]=(u*D-a*T-c*I)*A,t[2]=(a*E-s*D+c*w)*A,t[3]=(r*E-i*T-n*F)*A,t[4]=(o*T-r*D+n*I)*A,t[5]=(i*D-o*E-n*w)*A,t[6]=(f*S-m*x+g*b)*A,t[7]=(m*M-d*S-g*v)*A,t[8]=(d*x-f*M+g*y)*A,t):null},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t[3]=e[3]+o[3],t[4]=e[4]+o[4],t[5]=e[5]+o[5],t[6]=e[6]+o[6],t[7]=e[7]+o[7],t[8]=e[8]+o[8],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t[3]=e[3]-o[3],t[4]=e[4]-o[4],t[5]=e[5]-o[5],t[6]=e[6]-o[6],t[7]=e[7]-o[7],t[8]=e[8]-o[8],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*o,t},r.multiplyScalarAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t[3]=e[3]+o[3]*i,t[4]=e[4]+o[4]*i,t[5]=e[5]+o[5]*i,t[6]=e[6]+o[6]*i,t[7]=e[7]+o[7]*i,t[8]=e[8]+o[8]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=t[6],h=t[7],l=t[8],_=e[0],p=e[1],d=e[2],f=e[3],m=e[4],g=e[5],y=t[6],v=e[7],M=e[8];return Math.abs(o-_)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(r-p)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-d)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-f)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-m)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-g)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(c-y)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(l-M)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))},e.exports=r},{"./common.js":21}],25:[function(t,e,o){var i=t("./common.js"),r={scalar:{},SIMD:{}};r.create=function(){var t=new i.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.clone=function(t){var e=new i.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.fromValues=function(t,e,o,r,n,a,s,u,c,h,l,_,p,d,f,m){var g=new i.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=o,g[3]=r,g[4]=n,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=h,g[10]=l,g[11]=_,g[12]=p,g[13]=d,g[14]=f,g[15]=m,g},r.set=function(t,e,o,i,r,n,a,s,u,c,h,l,_,p,d,f,m){return t[0]=e,t[1]=o,t[2]=i,t[3]=r,t[4]=n,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=h,t[10]=l,t[11]=_,t[12]=p,t[13]=d,t[14]=f,t[15]=m,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.scalar.transpose=function(t,e){if(t===e){var o=e[1],i=e[2],r=e[3],n=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=o,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},r.SIMD.transpose=function(t,e){var o,i,r,n,a,s,u,c,h,l;return o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.shuffle(o,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,n,0,1,4,5),u=SIMD.Float32x4.shuffle(a,s,0,2,4,6),c=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,c),a=SIMD.Float32x4.shuffle(o,i,2,3,6,7),s=SIMD.Float32x4.shuffle(r,n,2,3,6,7),h=SIMD.Float32x4.shuffle(a,s,0,2,4,6),l=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,l),t},r.transpose=i.USE_SIMD?r.SIMD.transpose:r.scalar.transpose,r.scalar.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],y=o*s-i*a,v=o*u-r*a,M=o*c-n*a,b=i*u-r*s,x=i*c-n*s,S=r*c-n*u,w=h*f-l*d,I=h*m-_*d,D=h*g-p*d,F=l*m-_*f,E=l*g-p*f,T=_*g-p*m,A=y*T-v*E+M*F+b*D-x*I+S*w;return A?(A=1/A,t[0]=(s*T-u*E+c*F)*A,t[1]=(r*E-i*T-n*F)*A,t[2]=(f*S-m*x+g*b)*A,t[3]=(_*x-l*S-p*b)*A,t[4]=(u*D-a*T-c*I)*A,t[5]=(o*T-r*D+n*I)*A,t[6]=(m*M-d*S-g*v)*A,t[7]=(h*S-_*M+p*v)*A,t[8]=(a*E-s*D+c*w)*A,t[9]=(i*D-o*E-n*w)*A,t[10]=(d*x-f*M+g*y)*A,t[11]=(l*M-h*x-p*y)*A,t[12]=(s*I-a*F-u*w)*A,t[13]=(o*F-i*I+r*w)*A,t[14]=(f*v-d*b-m*y)*A,t[15]=(h*b-l*v+_*y)*A,t):null},r.SIMD.invert=function(t,e){var o,i,r,n,a,s,u,c,h,l,_=SIMD.Float32x4.load(e,0),p=SIMD.Float32x4.load(e,4),d=SIMD.Float32x4.load(e,8),f=SIMD.Float32x4.load(e,12);return a=SIMD.Float32x4.shuffle(_,p,0,1,4,5),i=SIMD.Float32x4.shuffle(d,f,0,1,4,5),o=SIMD.Float32x4.shuffle(a,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,a,1,3,5,7),a=SIMD.Float32x4.shuffle(_,p,2,3,6,7),n=SIMD.Float32x4.shuffle(d,f,2,3,6,7),r=SIMD.Float32x4.shuffle(a,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,a,1,3,5,7),a=SIMD.Float32x4.mul(r,n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.mul(i,a),u=SIMD.Float32x4.mul(o,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),a=SIMD.Float32x4.mul(i,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),s),
h=SIMD.Float32x4.mul(o,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,a)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),r=SIMD.Float32x4.swizzle(r,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),s),c=SIMD.Float32x4.mul(o,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(r,a)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),a=SIMD.Float32x4.mul(o,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),c),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),h),a=SIMD.Float32x4.swizzle(a,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),c),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(r,a)),a=SIMD.Float32x4.mul(o,n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,a)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),c),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,a),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.mul(o,r),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,a)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),h),l=SIMD.Float32x4.mul(o,s),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),a=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(a,a))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,c)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,h)),t):null},r.invert=i.USE_SIMD?r.SIMD.invert:r.scalar.invert,r.scalar.adjoint=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15];return t[0]=s*(_*g-p*m)-l*(u*g-c*m)+f*(u*p-c*_),t[1]=-(i*(_*g-p*m)-l*(r*g-n*m)+f*(r*p-n*_)),t[2]=i*(u*g-c*m)-s*(r*g-n*m)+f*(r*c-n*u),t[3]=-(i*(u*p-c*_)-s*(r*p-n*_)+l*(r*c-n*u)),t[4]=-(a*(_*g-p*m)-h*(u*g-c*m)+d*(u*p-c*_)),t[5]=o*(_*g-p*m)-h*(r*g-n*m)+d*(r*p-n*_),t[6]=-(o*(u*g-c*m)-a*(r*g-n*m)+d*(r*c-n*u)),t[7]=o*(u*p-c*_)-a*(r*p-n*_)+h*(r*c-n*u),t[8]=a*(l*g-p*f)-h*(s*g-c*f)+d*(s*p-c*l),t[9]=-(o*(l*g-p*f)-h*(i*g-n*f)+d*(i*p-n*l)),t[10]=o*(s*g-c*f)-a*(i*g-n*f)+d*(i*c-n*s),t[11]=-(o*(s*p-c*l)-a*(i*p-n*l)+h*(i*c-n*s)),t[12]=-(a*(l*m-_*f)-h*(s*m-u*f)+d*(s*_-u*l)),t[13]=o*(l*m-_*f)-h*(i*m-r*f)+d*(i*_-r*l),t[14]=-(o*(s*m-u*f)-a*(i*m-r*f)+d*(i*u-r*s)),t[15]=o*(s*_-u*l)-a*(i*_-r*l)+h*(i*u-r*s),t},r.SIMD.adjoint=function(t,e){var o,i,r,n,a,s,u,c,h,l,_,p,d,o=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(o,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,n,0,1,4,5),a=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(o,i,2,3,6,7),c=SIMD.Float32x4.shuffle(r,n,2,3,6,7),u=SIMD.Float32x4.shuffle(h,c,0,2,4,6),c=SIMD.Float32x4.shuffle(c,h,1,3,5,7),h=SIMD.Float32x4.mul(u,c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.mul(s,h),_=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),l),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),_),_=SIMD.Float32x4.swizzle(_,2,3,0,1),h=SIMD.Float32x4.mul(s,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),l),d=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(c,h)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),l),p=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),h=SIMD.Float32x4.mul(a,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),p),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),d),h=SIMD.Float32x4.swizzle(h,2,3,0,1),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,h),p),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,h)),h=SIMD.Float32x4.mul(a,c),h=SIMD.Float32x4.swizzle(h,1,0,3,2),_=SIMD.Float32x4.sub(_,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),p),h=SIMD.Float32x4.swizzle(h,2,3,0,1),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),_),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(a,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,h),_),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),_=SIMD.Float32x4.sub(_,SIMD.Float32x4.mul(c,h)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),d),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,_),SIMD.Float32x4.store(t,8,p),SIMD.Float32x4.store(t,12,d),t},r.adjoint=i.USE_SIMD?r.SIMD.adjoint:r.scalar.adjoint,r.determinant=function(t){var e=t[0],o=t[1],i=t[2],r=t[3],n=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],_=t[11],p=t[12],d=t[13],f=t[14],m=t[15],g=e*a-o*n,y=e*s-i*n,v=e*u-r*n,M=o*s-i*a,b=o*u-r*a,x=i*u-r*s,S=c*d-h*p,w=c*f-l*p,I=c*m-_*p,D=h*f-l*d,F=h*m-_*d,E=l*m-_*f;return g*E-y*F+v*D+M*I-b*w+x*S},r.SIMD.multiply=function(t,e,o){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(o,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),a))));SIMD.Float32x4.store(t,0,u);var c=SIMD.Float32x4.load(o,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),a))));SIMD.Float32x4.store(t,4,h);var l=SIMD.Float32x4.load(o,8),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),a))));SIMD.Float32x4.store(t,8,_);var p=SIMD.Float32x4.load(o,12),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,3,3,3,3),a))));return SIMD.Float32x4.store(t,12,d),t},r.scalar.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],_=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=o[0],M=o[1],b=o[2],x=o[3];return t[0]=v*i+M*s+b*l+x*f,t[1]=v*r+M*u+b*_+x*m,t[2]=v*n+M*c+b*p+x*g,t[3]=v*a+M*h+b*d+x*y,v=o[4],M=o[5],b=o[6],x=o[7],t[4]=v*i+M*s+b*l+x*f,t[5]=v*r+M*u+b*_+x*m,t[6]=v*n+M*c+b*p+x*g,t[7]=v*a+M*h+b*d+x*y,v=o[8],M=o[9],b=o[10],x=o[11],t[8]=v*i+M*s+b*l+x*f,t[9]=v*r+M*u+b*_+x*m,t[10]=v*n+M*c+b*p+x*g,t[11]=v*a+M*h+b*d+x*y,v=o[12],M=o[13],b=o[14],x=o[15],t[12]=v*i+M*s+b*l+x*f,t[13]=v*r+M*u+b*_+x*m,t[14]=v*n+M*c+b*p+x*g,t[15]=v*a+M*h+b*d+x*y,t},r.multiply=i.USE_SIMD?r.SIMD.multiply:r.scalar.multiply,r.mul=r.multiply,r.scalar.translate=function(t,e,o){var i,r,n,a,s,u,c,h,l,_,p,d,f=o[0],m=o[1],g=o[2];return e===t?(t[12]=e[0]*f+e[4]*m+e[8]*g+e[12],t[13]=e[1]*f+e[5]*m+e[9]*g+e[13],t[14]=e[2]*f+e[6]*m+e[10]*g+e[14],t[15]=e[3]*f+e[7]*m+e[11]*g+e[15]):(i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],_=e[9],p=e[10],d=e[11],t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=_,t[10]=p,t[11]=d,t[12]=i*f+s*m+l*g+e[12],t[13]=r*f+u*m+_*g+e[13],t[14]=n*f+c*m+p*g+e[14],t[15]=a*f+h*m+d*g+e[15]),t},r.SIMD.translate=function(t,e,o){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(o[0],o[1],o[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,1,1,1,1)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(i,SIMD.Float32x4.add(r,SIMD.Float32x4.add(n,a)));return SIMD.Float32x4.store(t,12,u),t},r.translate=i.USE_SIMD?r.SIMD.translate:r.scalar.translate,r.scalar.scale=function(t,e,o){var i=o[0],r=o[1],n=o[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.SIMD.scale=function(t,e,o){var i,r,n,a=SIMD.Float32x4(o[0],o[1],o[2],0);return i=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(a,0,0,0,0))),r=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,1,1,1,1))),n=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(a,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.scale=i.USE_SIMD?r.SIMD.scale:r.scalar.scale,r.rotate=function(t,e,o,r){var n,a,s,u,c,h,l,_,p,d,f,m,g,y,v,M,b,x,S,w,I,D,F,E,T=r[0],A=r[1],P=r[2],R=Math.sqrt(T*T+A*A+P*P);return Math.abs(R)<i.EPSILON?null:(R=1/R,T*=R,A*=R,P*=R,n=Math.sin(o),a=Math.cos(o),s=1-a,u=e[0],c=e[1],h=e[2],l=e[3],_=e[4],p=e[5],d=e[6],f=e[7],m=e[8],g=e[9],y=e[10],v=e[11],M=T*T*s+a,b=A*T*s+P*n,x=P*T*s-A*n,S=T*A*s-P*n,w=A*A*s+a,I=P*A*s+T*n,D=T*P*s+A*n,F=A*P*s-T*n,E=P*P*s+a,t[0]=u*M+_*b+m*x,t[1]=c*M+p*b+g*x,t[2]=h*M+d*b+y*x,t[3]=l*M+f*b+v*x,t[4]=u*S+_*w+m*I,t[5]=c*S+p*w+g*I,t[6]=h*S+d*w+y*I,t[7]=l*S+f*w+v*I,t[8]=u*D+_*F+m*E,t[9]=c*D+p*F+g*E,t[10]=h*D+d*F+y*E,t[11]=l*D+f*F+v*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},r.scalar.rotateX=function(t,e,o){var i=Math.sin(o),r=Math.cos(o),n=e[4],a=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+c*i,t[5]=a*r+h*i,t[6]=s*r+l*i,t[7]=u*r+_*i,t[8]=c*r-n*i,t[9]=h*r-a*i,t[10]=l*r-s*i,t[11]=_*r-u*i,t},r.SIMD.rotateX=function(t,e,o){var i=SIMD.Float32x4.splat(Math.sin(o)),r=SIMD.Float32x4.splat(Math.cos(o));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(n,i))),t},r.rotateX=i.USE_SIMD?r.SIMD.rotateX:r.scalar.rotateX,r.scalar.rotateY=function(t,e,o){var i=Math.sin(o),r=Math.cos(o),n=e[0],a=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-c*i,t[1]=a*r-h*i,t[2]=s*r-l*i,t[3]=u*r-_*i,t[8]=n*i+c*r,t[9]=a*i+h*r,t[10]=s*i+l*r,t[11]=u*i+_*r,t},r.SIMD.rotateY=function(t,e,o){var i=SIMD.Float32x4.splat(Math.sin(o)),r=SIMD.Float32x4.splat(Math.cos(o));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),SIMD.Float32x4.mul(a,r))),t},r.rotateY=i.USE_SIMD?r.SIMD.rotateY:r.scalar.rotateY,r.scalar.rotateZ=function(t,e,o){var i=Math.sin(o),r=Math.cos(o),n=e[0],a=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+c*i,t[1]=a*r+h*i,t[2]=s*r+l*i,t[3]=u*r+_*i,t[4]=c*r-n*i,t[5]=h*r-a*i,t[6]=l*r-s*i,t[7]=_*r-u*i,t},r.SIMD.rotateZ=function(t,e,o){var i=SIMD.Float32x4.splat(Math.sin(o)),r=SIMD.Float32x4.splat(Math.cos(o));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,r),SIMD.Float32x4.mul(a,i))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(n,i))),t},r.rotateZ=i.USE_SIMD?r.SIMD.rotateZ:r.scalar.rotateZ,r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e,o){var r,n,a,s=o[0],u=o[1],c=o[2],h=Math.sqrt(s*s+u*u+c*c);return Math.abs(h)<i.EPSILON?null:(h=1/h,s*=h,u*=h,c*=h,r=Math.sin(e),n=Math.cos(e),a=1-n,t[0]=s*s*a+n,t[1]=u*s*a+c*r,t[2]=c*s*a-u*r,t[3]=0,t[4]=s*u*a-c*r,t[5]=u*u*a+n,t[6]=c*u*a+s*r,t[7]=0,t[8]=s*c*a+u*r,t[9]=u*c*a-s*r,t[10]=c*c*a+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},r.fromXRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=o,t[7]=0,t[8]=0,t[9]=-o,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromYRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-o,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=o,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromZRotation=function(t,e){var o=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=o,t[2]=0,t[3]=0,t[4]=-o,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotationTranslation=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,u=r+r,c=n+n,h=i*s,l=i*u,_=i*c,p=r*u,d=r*c,f=n*c,m=a*s,g=a*u,y=a*c;return t[0]=1-(p+f),t[1]=l+y,t[2]=_-g,t[3]=0,t[4]=l-y,t[5]=1-(h+f),t[6]=d+m,t[7]=0,t[8]=_+g,t[9]=d-m,t[10]=1-(h+p),t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t},r.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},r.getRotation=function(t,e){var o=e[0]+e[5]+e[10],i=0;return o>0?(i=2*Math.sqrt(o+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},r.fromRotationTranslationScale=function(t,e,o,i){var r=e[0],n=e[1],a=e[2],s=e[3],u=r+r,c=n+n,h=a+a,l=r*u,_=r*c,p=r*h,d=n*c,f=n*h,m=a*h,g=s*u,y=s*c,v=s*h,M=i[0],b=i[1],x=i[2];return t[0]=(1-(d+m))*M,t[1]=(_+v)*M,t[2]=(p-y)*M,t[3]=0,t[4]=(_-v)*b,t[5]=(1-(l+m))*b,t[6]=(f+g)*b,t[7]=0,t[8]=(p+y)*x,t[9]=(f-g)*x,t[10]=(1-(l+d))*x,t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t},r.fromRotationTranslationScaleOrigin=function(t,e,o,i,r){var n=e[0],a=e[1],s=e[2],u=e[3],c=n+n,h=a+a,l=s+s,_=n*c,p=n*h,d=n*l,f=a*h,m=a*l,g=s*l,y=u*c,v=u*h,M=u*l,b=i[0],x=i[1],S=i[2],w=r[0],I=r[1],D=r[2];return t[0]=(1-(f+g))*b,t[1]=(p+M)*b,t[2]=(d-v)*b,t[3]=0,t[4]=(p-M)*x,t[5]=(1-(_+g))*x,t[6]=(m+y)*x,t[7]=0,t[8]=(d+v)*S,t[9]=(m-y)*S,t[10]=(1-(_+f))*S,t[11]=0,t[12]=o[0]+w-(t[0]*w+t[4]*I+t[8]*D),t[13]=o[1]+I-(t[1]*w+t[5]*I+t[9]*D),t[14]=o[2]+D-(t[2]*w+t[6]*I+t[10]*D),t[15]=1,t},r.fromQuat=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=o+o,s=i+i,u=r+r,c=o*a,h=i*a,l=i*s,_=r*a,p=r*s,d=r*u,f=n*a,m=n*s,g=n*u;return t[0]=1-l-d,t[1]=h+g,t[2]=_-m,t[3]=0,t[4]=h-g,t[5]=1-c-d,t[6]=p+f,t[7]=0,t[8]=_+m,t[9]=p-f,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.frustum=function(t,e,o,i,r,n,a){var s=1/(o-e),u=1/(r-i),c=1/(n-a);return t[0]=2*n*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*u,t[6]=0,t[7]=0,t[8]=(o+e)*s,t[9]=(r+i)*u,t[10]=(a+n)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*c,t[15]=0,t},r.perspective=function(t,e,o,i,r){var n=1/Math.tan(e/2),a=1/(i-r);return t[0]=n/o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},r.perspectiveFromFieldOfView=function(t,e,o,i){var r=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(r+n);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(r-n)*c*.5,t[10]=i/(o-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o/(o-i),t[15]=0,t},r.ortho=function(t,e,o,i,r,n,a){var s=1/(e-o),u=1/(i-r),c=1/(n-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+o)*s,t[13]=(r+i)*u,t[14]=(a+n)*c,t[15]=1,t},r.lookAt=function(t,e,o,n){var a,s,u,c,h,l,_,p,d,f,m=e[0],g=e[1],y=e[2],v=n[0],M=n[1],b=n[2],x=o[0],S=o[1],w=o[2];return Math.abs(m-x)<i.EPSILON&&Math.abs(g-S)<i.EPSILON&&Math.abs(y-w)<i.EPSILON?r.identity(t):(_=m-x,p=g-S,d=y-w,f=1/Math.sqrt(_*_+p*p+d*d),_*=f,p*=f,d*=f,a=M*d-b*p,s=b*_-v*d,u=v*p-M*_,f=Math.sqrt(a*a+s*s+u*u),f?(f=1/f,a*=f,s*=f,u*=f):(a=0,s=0,u=0),c=p*u-d*s,h=d*a-_*u,l=_*s-p*a,f=Math.sqrt(c*c+h*h+l*l),f?(f=1/f,c*=f,h*=f,l*=f):(c=0,h=0,l=0),t[0]=a,t[1]=c,t[2]=_,t[3]=0,t[4]=s,t[5]=h,t[6]=p,t[7]=0,t[8]=u,t[9]=l,t[10]=d,t[11]=0,t[12]=-(a*m+s*g+u*y),t[13]=-(c*m+h*g+l*y),t[14]=-(_*m+p*g+d*y),t[15]=1,t)},r.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t[3]=e[3]+o[3],t[4]=e[4]+o[4],t[5]=e[5]+o[5],t[6]=e[6]+o[6],t[7]=e[7]+o[7],t[8]=e[8]+o[8],t[9]=e[9]+o[9],t[10]=e[10]+o[10],t[11]=e[11]+o[11],t[12]=e[12]+o[12],t[13]=e[13]+o[13],t[14]=e[14]+o[14],t[15]=e[15]+o[15],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t[3]=e[3]-o[3],t[4]=e[4]-o[4],t[5]=e[5]-o[5],t[6]=e[6]-o[6],t[7]=e[7]-o[7],t[8]=e[8]-o[8],t[9]=e[9]-o[9],t[10]=e[10]-o[10],t[11]=e[11]-o[11],t[12]=e[12]-o[12],t[13]=e[13]-o[13],t[14]=e[14]-o[14],t[15]=e[15]-o[15],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12]*o,t[13]=e[13]*o,t[14]=e[14]*o,t[15]=e[15]*o,t},r.multiplyScalarAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t[3]=e[3]+o[3]*i,t[4]=e[4]+o[4]*i,t[5]=e[5]+o[5]*i,t[6]=e[6]+o[6]*i,t[7]=e[7]+o[7]*i,t[8]=e[8]+o[8]*i,t[9]=e[9]+o[9]*i,t[10]=e[10]+o[10]*i,t[11]=e[11]+o[11]*i,t[12]=e[12]+o[12]*i,t[13]=e[13]+o[13]*i,t[14]=e[14]+o[14]*i,t[15]=e[15]+o[15]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=t[3],s=t[4],u=t[5],c=t[6],h=t[7],l=t[8],_=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=e[0],M=e[1],b=e[2],x=e[3],S=e[4],w=e[5],I=e[6],D=e[7],F=e[8],E=e[9],T=e[10],A=e[11],P=e[12],R=e[13],C=e[14],k=e[15];return Math.abs(o-v)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(r-M)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(n-b)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-x)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-S)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-w)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-I)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(h-D)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(l-F)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(_-E)<=i.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(p-T)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(d-A)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(f-P)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-R)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-C)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(y-k)<=i.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))},e.exports=r},{"./common.js":21}],26:[function(t,e,o){var i=t("./common.js"),r=t("./mat3.js"),n=t("./vec3.js"),a=t("./vec4.js"),s={};s.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=n.create(),e=n.fromValues(1,0,0),o=n.fromValues(0,1,0);return function(i,r,a){var u=n.dot(r,a);return-.999999>u?(n.cross(t,e,r),n.length(t)<1e-6&&n.cross(t,o,r),n.normalize(t,t),s.setAxisAngle(i,t,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(n.cross(t,r,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+u,s.normalize(i,i))}}(),s.setAxes=function(){var t=r.create();return function(e,o,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-o[0],t[5]=-o[1],t[8]=-o[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=a.clone,s.fromValues=a.fromValues,s.copy=a.copy,s.set=a.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,o){o=.5*o;var i=Math.sin(o);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(o),t},s.getAxisAngle=function(t,e){var o=2*Math.acos(e[3]),i=Math.sin(o/2);return 0!=i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),o},s.add=a.add,s.multiply=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3],s=o[0],u=o[1],c=o[2],h=o[3];return t[0]=i*h+a*s+r*c-n*u,t[1]=r*h+a*u+n*s-i*c,t[2]=n*h+a*c+i*u-r*s,t[3]=a*h-i*s-r*u-n*c,t},s.mul=s.multiply,s.scale=a.scale,s.rotateX=function(t,e,o){o*=.5;var i=e[0],r=e[1],n=e[2],a=e[3],s=Math.sin(o),u=Math.cos(o);return t[0]=i*u+a*s,t[1]=r*u+n*s,t[2]=n*u-r*s,t[3]=a*u-i*s,t},s.rotateY=function(t,e,o){o*=.5;var i=e[0],r=e[1],n=e[2],a=e[3],s=Math.sin(o),u=Math.cos(o);return t[0]=i*u-n*s,t[1]=r*u+a*s,t[2]=n*u+i*s,t[3]=a*u-r*s,t},s.rotateZ=function(t,e,o){o*=.5;var i=e[0],r=e[1],n=e[2],a=e[3],s=Math.sin(o),u=Math.cos(o);return t[0]=i*u+r*s,t[1]=r*u-i*s,t[2]=n*u+a*s,t[3]=a*u-n*s,t},s.calculateW=function(t,e){var o=e[0],i=e[1],r=e[2];return t[0]=o,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-o*o-i*i-r*r)),t},s.dot=a.dot,s.lerp=a.lerp,s.slerp=function(t,e,o,i){var r,n,a,s,u,c=e[0],h=e[1],l=e[2],_=e[3],p=o[0],d=o[1],f=o[2],m=o[3];return n=c*p+h*d+l*f+_*m,0>n&&(n=-n,p=-p,d=-d,f=-f,m=-m),1-n>1e-6?(r=Math.acos(n),a=Math.sin(r),s=Math.sin((1-i)*r)/a,u=Math.sin(i*r)/a):(s=1-i,u=i),t[0]=s*c+u*p,t[1]=s*h+u*d,t[2]=s*l+u*f,t[3]=s*_+u*m,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(o,i,r,n,a,u){return s.slerp(t,i,a,u),s.slerp(e,r,n,u),s.slerp(o,t,e,2*u*(1-u)),o}}(),s.invert=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=o*o+i*i+r*r+n*n,s=a?1/a:0;return t[0]=-o*s,t[1]=-i*s,t[2]=-r*s,t[3]=n*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=a.length,s.len=s.length,s.squaredLength=a.squaredLength,s.sqrLen=s.squaredLength,s.normalize=a.normalize,s.fromMat3=function(t,e){var o,i=e[0]+e[4]+e[8];if(i>0)o=Math.sqrt(i+1),t[3]=.5*o,o=.5/o,t[0]=(e[5]-e[7])*o,t[1]=(e[6]-e[2])*o,t[2]=(e[1]-e[3])*o;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var n=(r+1)%3,a=(r+2)%3;o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*a+a]+1),t[r]=.5*o,o=.5/o,t[3]=(e[3*n+a]-e[3*a+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[a]=(e[3*a+r]+e[3*r+a])*o}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=a.exactEquals,s.equals=a.equals,e.exports=s},{"./common.js":21,"./mat3.js":24,"./vec3.js":28,"./vec4.js":29}],27:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var o=new i.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,o){return t[0]=e,t[1]=o,t},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},r.sub=r.subtract,r.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},r.mul=r.multiply,r.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},r.min=function(t,e,o){return t[0]=Math.min(e[0],o[0]),t[1]=Math.min(e[1],o[1]),t},r.max=function(t,e,o){return t[0]=Math.max(e[0],o[0]),t[1]=Math.max(e[1],o[1]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},r.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},r.scaleAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t},r.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},r.dist=r.distance,r.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},r.len=r.length,r.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},r.normalize=function(t,e){var o=e[0],i=e[1],r=o*o+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.cross=function(t,e,o){var i=e[0]*o[1]-e[1]*o[0];return t[0]=t[1]=0,t[2]=i,t},r.lerp=function(t,e,o,i){var r=e[0],n=e[1];return t[0]=r+i*(o[0]-r),t[1]=n+i*(o[1]-n),t},r.random=function(t,e){e=e||1;var o=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(o)*e,t[1]=Math.sin(o)*e,t},r.transformMat2=function(t,e,o){var i=e[0],r=e[1];return t[0]=o[0]*i+o[2]*r,t[1]=o[1]*i+o[3]*r,t},r.transformMat2d=function(t,e,o){var i=e[0],r=e[1];return t[0]=o[0]*i+o[2]*r+o[4],t[1]=o[1]*i+o[3]*r+o[5],t},r.transformMat3=function(t,e,o){var i=e[0],r=e[1];return t[0]=o[0]*i+o[3]*r+o[6],t[1]=o[1]*i+o[4]*r+o[7],t},r.transformMat4=function(t,e,o){var i=e[0],r=e[1];return t[0]=o[0]*i+o[4]*r+o[12],t[1]=o[1]*i+o[5]*r+o[13],t},r.forEach=function(){var t=r.create();return function(e,o,i,r,n,a){var s,u;for(o||(o=2),i||(i=0),u=r?Math.min(r*o+i,e.length):e.length,s=i;u>s;s+=o)t[0]=e[s],t[1]=e[s+1],n(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r.equals=function(t,e){var o=t[0],r=t[1],n=e[0],a=e[1];return Math.abs(o-n)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(n))&&Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},e.exports=r},{"./common.js":21}],28:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},r.fromValues=function(t,e,o){var r=new i.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=o,r},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},r.set=function(t,e,o,i){return t[0]=e,t[1]=o,t[2]=i,t},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t},r.sub=r.subtract,r.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t[2]=e[2]*o[2],t},r.mul=r.multiply,r.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t[2]=e[2]/o[2],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},r.min=function(t,e,o){return t[0]=Math.min(e[0],o[0]),t[1]=Math.min(e[1],o[1]),t[2]=Math.min(e[2],o[2]),t},r.max=function(t,e,o){return t[0]=Math.max(e[0],o[0]),t[1]=Math.max(e[1],o[1]),t[2]=Math.max(e[2],o[2]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},r.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},r.scaleAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t},r.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(o*o+i*i+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return o*o+i*i+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],o=t[1],i=t[2];return Math.sqrt(e*e+o*o+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],o=t[1],i=t[2];return e*e+o*o+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},r.normalize=function(t,e){var o=e[0],i=e[1],r=e[2],n=o*o+i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.cross=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=o[0],s=o[1],u=o[2];return t[0]=r*u-n*s,t[1]=n*a-i*u,t[2]=i*s-r*a,t},r.lerp=function(t,e,o,i){var r=e[0],n=e[1],a=e[2];return t[0]=r+i*(o[0]-r),t[1]=n+i*(o[1]-n),t[2]=a+i*(o[2]-a),t},r.hermite=function(t,e,o,i,r,n){var a=n*n,s=a*(2*n-3)+1,u=a*(n-2)+n,c=a*(n-1),h=a*(3-2*n);return t[0]=e[0]*s+o[0]*u+i[0]*c+r[0]*h,t[1]=e[1]*s+o[1]*u+i[1]*c+r[1]*h,t[2]=e[2]*s+o[2]*u+i[2]*c+r[2]*h,t},r.bezier=function(t,e,o,i,r,n){var a=1-n,s=a*a,u=n*n,c=s*a,h=3*n*s,l=3*u*a,_=u*n;return t[0]=e[0]*c+o[0]*h+i[0]*l+r[0]*_,t[1]=e[1]*c+o[1]*h+i[1]*l+r[1]*_,t[2]=e[2]*c+o[2]*h+i[2]*l+r[2]*_,t},r.random=function(t,e){e=e||1;var o=2*i.RANDOM()*Math.PI,r=2*i.RANDOM()-1,n=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(o)*n,t[1]=Math.sin(o)*n,t[2]=r*e,t},r.transformMat4=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=o[3]*i+o[7]*r+o[11]*n+o[15];return a=a||1,t[0]=(o[0]*i+o[4]*r+o[8]*n+o[12])/a,t[1]=(o[1]*i+o[5]*r+o[9]*n+o[13])/a,t[2]=(o[2]*i+o[6]*r+o[10]*n+o[14])/a,t},r.transformMat3=function(t,e,o){var i=e[0],r=e[1],n=e[2];return t[0]=i*o[0]+r*o[3]+n*o[6],t[1]=i*o[1]+r*o[4]+n*o[7],t[2]=i*o[2]+r*o[5]+n*o[8],t},r.transformQuat=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=o[0],s=o[1],u=o[2],c=o[3],h=c*i+s*n-u*r,l=c*r+u*i-a*n,_=c*n+a*r-s*i,p=-a*i-s*r-u*n;return t[0]=h*c+p*-a+l*-u-_*-s,t[1]=l*c+p*-s+_*-a-h*-u,t[2]=_*c+p*-u+h*-s-l*-a,t},r.rotateX=function(t,e,o,i){var r=[],n=[];return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=n[0]+o[0],t[1]=n[1]+o[1],t[2]=n[2]+o[2],t},r.rotateY=function(t,e,o,i){var r=[],n=[];return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=n[0]+o[0],t[1]=n[1]+o[1],t[2]=n[2]+o[2],t},r.rotateZ=function(t,e,o,i){var r=[],n=[];return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],t[0]=n[0]+o[0],t[1]=n[1]+o[1],t[2]=n[2]+o[2],t},r.forEach=function(){var t=r.create();return function(e,o,i,r,n,a){var s,u;for(o||(o=3),i||(i=0),u=r?Math.min(r*o+i,e.length):e.length,
s=i;u>s;s+=o)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],n(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),r.angle=function(t,e){var o=r.fromValues(t[0],t[1],t[2]),i=r.fromValues(e[0],e[1],e[2]);r.normalize(o,o),r.normalize(i,i);var n=r.dot(o,i);return n>1?0:Math.acos(n)},r.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(o-a)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))},e.exports=r},{"./common.js":21}],29:[function(t,e,o){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.fromValues=function(t,e,o,r){var n=new i.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=o,n[3]=r,n},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.set=function(t,e,o,i,r){return t[0]=e,t[1]=o,t[2]=i,t[3]=r,t},r.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2],t[3]=e[3]+o[3],t},r.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t[2]=e[2]-o[2],t[3]=e[3]-o[3],t},r.sub=r.subtract,r.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t[2]=e[2]*o[2],t[3]=e[3]*o[3],t},r.mul=r.multiply,r.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t[2]=e[2]/o[2],t[3]=e[3]/o[3],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},r.min=function(t,e,o){return t[0]=Math.min(e[0],o[0]),t[1]=Math.min(e[1],o[1]),t[2]=Math.min(e[2],o[2]),t[3]=Math.min(e[3],o[3]),t},r.max=function(t,e,o){return t[0]=Math.max(e[0],o[0]),t[1]=Math.max(e[1],o[1]),t[2]=Math.max(e[2],o[2]),t[3]=Math.max(e[3],o[3]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},r.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t},r.scaleAndAdd=function(t,e,o,i){return t[0]=e[0]+o[0]*i,t[1]=e[1]+o[1]*i,t[2]=e[2]+o[2]*i,t[3]=e[3]+o[3]*i,t},r.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(o*o+i*i+r*r+n*n)},r.dist=r.distance,r.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],n=e[3]-t[3];return o*o+i*i+r*r+n*n},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],o=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+o*o+i*i+r*r)},r.len=r.length,r.squaredLength=function(t){var e=t[0],o=t[1],i=t[2],r=t[3];return e*e+o*o+i*i+r*r},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},r.normalize=function(t,e){var o=e[0],i=e[1],r=e[2],n=e[3],a=o*o+i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=o*a,t[1]=i*a,t[2]=r*a,t[3]=n*a),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},r.lerp=function(t,e,o,i){var r=e[0],n=e[1],a=e[2],s=e[3];return t[0]=r+i*(o[0]-r),t[1]=n+i*(o[1]-n),t[2]=a+i*(o[2]-a),t[3]=s+i*(o[3]-s),t},r.random=function(t,e){return e=e||1,t[0]=i.RANDOM(),t[1]=i.RANDOM(),t[2]=i.RANDOM(),t[3]=i.RANDOM(),r.normalize(t,t),r.scale(t,t,e),t},r.transformMat4=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=e[3];return t[0]=o[0]*i+o[4]*r+o[8]*n+o[12]*a,t[1]=o[1]*i+o[5]*r+o[9]*n+o[13]*a,t[2]=o[2]*i+o[6]*r+o[10]*n+o[14]*a,t[3]=o[3]*i+o[7]*r+o[11]*n+o[15]*a,t},r.transformQuat=function(t,e,o){var i=e[0],r=e[1],n=e[2],a=o[0],s=o[1],u=o[2],c=o[3],h=c*i+s*n-u*r,l=c*r+u*i-a*n,_=c*n+a*r-s*i,p=-a*i-s*r-u*n;return t[0]=h*c+p*-a+l*-u-_*-s,t[1]=l*c+p*-s+_*-a-h*-u,t[2]=_*c+p*-u+h*-s-l*-a,t[3]=e[3],t},r.forEach=function(){var t=r.create();return function(e,o,i,r,n,a){var s,u;for(o||(o=4),i||(i=0),u=r?Math.min(r*o+i,e.length):e.length,s=i;u>s;s+=o)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],n(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),r.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var o=t[0],r=t[1],n=t[2],a=t[3],s=e[0],u=e[1],c=e[2],h=e[3];return Math.abs(o-s)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},e.exports=r},{"./common.js":21}],30:[function(t,e,o){(function(t){WebGLDebugUtils=function(){function e(t){if(null==d){d={},f={};for(var e in t)"number"==typeof t[e]&&(d[t[e]]=e,f[e]=t[e])}}function o(){if(null==d)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return o(),void 0!==d[t]}function r(t){o();var e=d[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function n(t,e,o,i){var n=p[t];if(void 0!==n){var n=n[e];if(void 0!==n&&n[o]){if("object"==typeof n[o]&&void 0!==n[o].enumBitwiseOr){for(var a=n[o].enumBitwiseOr,s=0,u=[],c=0;c<a.length;++c){var h=f[a[c]];0!==(i&h)&&(s|=h,u.push(r(h)))}return s===i?u.join(" | "):r(i)}return r(i)}}return null===i?"null":void 0===i?"undefined":i.toString()}function a(t,e){for(var o="",i=e.length,r=0;i>r;++r)o+=(0==r?"":", ")+n(t,i,r,e[r]);return o}function s(t,e,o){t.__defineGetter__(o,function(){return e[o]}),t.__defineSetter__(o,function(t){e[o]=t})}function u(t,o,i,a){function c(t,e){return function(){i&&i(e,arguments);var r=t[e].apply(t,arguments),n=a.getError();return 0!=n&&(h[n]=!0,o(n,e,arguments)),r}}a=a||t,e(t),o=o||function(t,e,o){for(var i="",a=o.length,s=0;a>s;++s)i+=(0==s?"":", ")+n(e,a,s,o[s]);_("WebGL error "+r(t)+" in "+e+"("+i+")")};var h={},l={};for(var p in t)if("function"==typeof t[p])if("getExtension"!=p)l[p]=c(t,p);else{var d=c(t,p);l[p]=function(){var e=d.apply(t,arguments);return u(e,o,i,a)}}else s(l,t,p);return l.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return t.NO_ERROR},l}function c(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o);for(var i=0;e>i;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(o);for(var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),i=0;r>i;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function o(t){var e=t.addEventListener;t.addEventListener=function(o,i,r){switch(o){case"webglcontextlost":S(i);break;case"webglcontextrestored":w(i);break;default:e.apply(t,arguments)}}}function i(){for(var t=Object.keys(x),e=0;e<t.length;++e)delete x[t]}function r(){++v,m||y==v&&t.loseContext()}function n(t,e){var o=t[e];return function(){if(r(),!m){var e=o.apply(t,arguments);return e}}}function a(){for(var t=0;t<g.length;++t){var e=g[t];e instanceof WebGLBuffer?l.deleteBuffer(e):e instanceof WebGLFramebuffer?l.deleteFramebuffer(e):e instanceof WebGLProgram?l.deleteProgram(e):e instanceof WebGLRenderbuffer?l.deleteRenderbuffer(e):e instanceof WebGLShader?l.deleteShader(e):e instanceof WebGLTexture&&l.deleteTexture(e)}}function u(t){return{statusMessage:t,preventDefault:function(){M=!0}}}function h(t){for(var e in t)"function"==typeof t[e]?_[e]=n(t,e):s(_,t,e);_.getError=function(){if(r(),!m)for(var t;t=l.getError();)x[t]=!0;for(var t in x)if(x[t])return delete x[t],t;return _.NO_ERROR};for(var o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],i=0;i<o.length;++i){var a=o[i];_[a]=function(e){return function(){if(r(),m)return null;var o=e.apply(t,arguments);return o.__webglDebugContextLostId__=f,g.push(o),o}}(t[a])}for(var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],i=0;i<u.length;++i){var a=u[i];_[a]=function(e){return function(){return r(),m?null:e.apply(t,arguments)}}(_[a])}for(var c=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],i=0;i<c.length;++i){var a=c[i];_[a]=function(e){return function(){return r(),m?!1:e.apply(t,arguments)}}(_[a])}return _.checkFramebufferStatus=function(e){return function(){return r(),m?_.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(_.checkFramebufferStatus),_.getAttribLocation=function(e){return function(){return r(),m?-1:e.apply(t,arguments)}}(_.getAttribLocation),_.getVertexAttribOffset=function(e){return function(){return r(),m?0:e.apply(t,arguments)}}(_.getVertexAttribOffset),_.isContextLost=function(){return m},_}var l,_,p=[],d=[],_={},f=1,m=!1,g=[],y=0,v=0,M=!1,b=0,x={};t.getContext=function(e){return function(){var o=e.apply(t,arguments);if(o instanceof WebGLRenderingContext){if(o!=l){if(l)throw"got different context";l=o,_=h(l)}return _}return o}}(t.getContext);var S=function(t){p.push(e(t))},w=function(t){d.push(e(t))};return o(t),t.loseContext=function(){if(!m){for(m=!0,y=0,++f;l.getError(););i(),x[l.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),o=p.slice();setTimeout(function(){for(var i=0;i<o.length;++i)o[i](e);b>=0&&setTimeout(function(){t.restoreContext()},b)},0)}},t.restoreContext=function(){m&&d.length&&setTimeout(function(){if(!M)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),c(l),m=!1,v=0,M=!1;for(var t=d.slice(),e=u("context restored"),o=0;o<t.length;++o)t[o](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";y=v+t},t.getNumCalls=function(){return v},t.setRestoreTimeout=function(t){b=t},t}"undefined"==typeof window&&(window=t);var l=function(t){window.console&&window.console.log&&window.console.log(t)},_=function(t){window.console&&window.console.error?window.console.error(t):l(t)},p={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},d=null,f=null;return{init:e,mightBeEnum:i,glEnumToString:r,glFunctionArgToString:n,glFunctionArgsToString:a,makeDebugContext:u,makeLostContextSimulatingCanvas:h,resetToInitialState:c}}(),e.exports=WebGLDebugUtils}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],31:[function(t,e,o){"use strict";var i=t("../util"),r=100,n=0,a=function(t){this.scene=t,this.core=t.core,this.parent=null,this.id=++n,this.frame_count=0,this._x=0,this._y=0,this._auto_disable_times_map={},this._velocity=null,this.resetVelocity(),this._previous_x=null,this._previous_y=null,this.objects=[]};i.defineProperty(a,"x"),i.defineProperty(a,"y"),a.prototype.init=function(){this.frame_count=0,this._auto_disable_times_map={},this.resetVelocity(),this._previous_x=null,this._previous_y=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},a.prototype.beforeDraw=function(){this.frame_count++,this._checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this._move()},a.prototype.draw=function(){this.core.debug_manager.isShowingCollisionArea()&&this._drawCollisionArea("white");for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw()},a.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},a.prototype.width=function(){return 0},a.prototype.height=function(){return 0},a.prototype.setPosition=function(t,e){this._x=t,this._y=e},a.prototype.root=function(){return this.parent?this.parent.root():this},a.prototype.globalCenterX=function(){return this.scene.x()+this.x()},a.prototype.globalCenterY=function(){return this.scene.y()+this.y()},a.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},a.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},a.prototype.globalUpY=function(){return this.scene.y()+this.y()-this.height()/2},a.prototype.globalDownY=function(){return this.scene.y()+this.y()+this.height()/2},a.prototype.addSubObject=function(t){t.setParent(this),this.objects.push(t)},a.prototype.addSubObjects=function(t){for(var e=0,o=t.length;o>e;e++){var i=t[e];i.setParent(this)}this.objects=this.objects.concat(t)},a.prototype.removeSubObject=function(t){for(var e=0,o=this.objects.length;o>e;e++)if(this.objects[e].id===t.id){this.objects[e].resetParent(),this.objects.splice(e,1);break}},a.prototype.removeAllSubObject=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].resetParent();this.objects=[]},a.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},a.prototype.resetParent=function(){this.parent=null},a.prototype.collisionWidth=function(t){return 0},a.prototype.collisionHeight=function(t){return 0},a.prototype.onCollision=function(t){},a.prototype.isCollision=function(t){return!0},a.prototype.checkCollisionWithObject=function(t){var e=this,o=t.intersect(e);return o&&(t.onCollision(e),e.onCollision(t)),o},a.prototype.checkCollisionWithObjects=function(t){for(var e=this,o=!1,i=0;i<t.length;i++){var r=t[i];e.checkCollisionByObject(r)&&(e.onCollision(r),r.onCollision(e),o=!0)}return o},a.prototype.checkCollisionWithPosition=function(t,e){var o=new s(this.scene);return o.init(),o.setPosition(t,e),this.checkCollisionWithObject(o)},a.prototype.intersect=function(t){return this.isCollision(t)&&t.isCollision(this)&&Math.abs(this.collisionX()-t.collisionX())<this.collisionWidth(t)/2+t.collisionWidth(this)/2&&Math.abs(this.collisionY()-t.collisionY())<this.collisionHeight(t)/2+t.collisionHeight(this)/2?!0:!1},a.prototype.collisionX=function(){return this.x()},a.prototype.collisionY=function(){return this.y()},a.prototype.getCollisionLeftX=function(t){return this.collisionX()-this.collisionWidth(t)/2},a.prototype.getCollisionRightX=function(t){return this.collisionX()+this.collisionWidth(t)/2},a.prototype.getCollisionUpY=function(t){return this.collisionY()-this.collisionHeight(t)/2},a.prototype.getCollisionDownY=function(t){return this.collisionY()+this.collisionHeight(t)/2},a.prototype._drawCollisionArea=function(t){var e=new a(this.scene);if(this.isCollision(e)){t=t||"rgb( 255, 255, 255 )";var o=this.core.ctx;o.save(),o.fillStyle=t,o.globalAlpha=.4,o.fillRect(this.getCollisionLeftX(e),this.getCollisionUpY(e),this.collisionWidth(e),this.collisionHeight(e)),o.restore()}},a.prototype.checkCollision=function(t){return this.checkCollisionByObject(t)},a.prototype.checkCollisionByObject=function(t){return this.intersect(t)},a.prototype.setAutoDisableFlag=function(t,e){var o=this;o[t]=!0,o._auto_disable_times_map[t]=o.frame_count+e},a.prototype._checkAutoDisableFlags=function(){var t=this;for(var e in t._auto_disable_times_map)this._auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t._auto_disable_times_map[e])},a.prototype.setVelocity=function(t){this._velocity=t},a.prototype.resetVelocity=function(){this._velocity={magnitude:0,theta:0}},a.prototype.setVelocityMagnitude=function(t){this._velocity.magnitude=t},a.prototype.setVelocityTheta=function(t){this._velocity.theta=t},a.prototype._move=function(){var t=i.calcMoveXByVelocity(this._velocity),e=i.calcMoveYByVelocity(this._velocity);this._previous_x=this._x,this._previous_y=this._y,this._x+=t,this._y+=e},a.prototype.moveBack=function(){if(null!==this._previous_x||!this._previous_y){var t=this._x,e=this._y;this._x=this._previous_x,this._y=this._previous_y,this._previous_x=t,this._previous_y=e}},a.prototype.isOutOfStage=function(){return this.x()+r<0||this.y()+r<0||this.x()>this.core.width+r||this.y()>this.core.height+r?!0:!1};var s=function(t){a.apply(this,arguments)};i.inherit(s,a),s.prototype.collisionWidth=function(){return 1},s.prototype.collisionHeight=function(){return 1},s.prototype.width=function(){return 1},s.prototype.height=function(){return 1},e.exports={object_base:a,object_point:s}},{"../util":53}],32:[function(t,e,o){"use strict";var i=t("./_base_and_point_classes");e.exports=i.object_base},{"./_base_and_point_classes":31}],33:[function(t,e,o){"use strict";var i=t("./_base_and_point_classes");e.exports=i.object_point},{"./_base_and_point_classes":31}],34:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t,e){i.apply(this,arguments),this.Class=e,this.objects={}};r.inherit(n,i),n.prototype.init=function(){i.prototype.init.apply(this,arguments),this.objects={}},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},n.prototype.draw=function(){i.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},n.prototype.afterDraw=function(){i.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},n.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},n.prototype.remove=function(t){delete this.objects[t]},n.prototype.checkCollisionWithObject=function(t){var e=!1;for(var o in this.objects){var i=this.objects[o];t.intersect(i)&&(t.onCollision(i),i.onCollision(t),e=!0)}return e},n.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var o in t.objects)if(this.objects[e].checkCollision(t.objects[o])){var i=this.objects[e],r=t.objects[o];if(i.onCollision(r),r.onCollision(i),!this.objects[e])break}},n.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},e.exports=n},{"../util":53,"./base":32}],35:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=t("gl-matrix"),a=t("../constant/webgl").SPRITE3D,s=function(t,e){i.apply(this,arguments),this.Class=e,this.objects={},this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[];var o=this.core.gl;this.vBuffer=o.createBuffer(),this.cBuffer=o.createBuffer(),this.iBuffer=o.createBuffer(),this.aBuffer=o.createBuffer(),this.mvMatrix=n.mat4.create(),this.pMatrix=n.mat4.create()};r.inherit(s,i),s.prototype.init=function(){i.prototype.init.apply(this,arguments),this.objects={},this._initmvpMatrix()},s.prototype._initmvpMatrix=function(){n.mat4.identity(this.mvMatrix),n.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._setOrthographicProjection=function(){n.mat4.identity(this.pMatrix);var t=.1,e=10;n.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw();this._updateAttributes()},s.prototype._updateAttributes=function(){this._resetAttributes();var t=0;for(var e in this.objects){var o=this.objects[e];if(o.isShow()){var i;for(i=0;i<a.V_SIZE;i++)this.vertices[t*a.V_SIZE+i]=o.vertices[i];for(i=0;i<a.C_SIZE;i++)this.coordinates[t*a.C_SIZE+i]=o.coordinates[i];for(i=0;i<a.I_SIZE;i++)this.indices[t*a.I_SIZE+i]=t*a.V_ITEM_NUM+o.indices[i];for(i=0;i<a.A_SIZE;i++)this.colors[t*a.A_SIZE+i]=o.colors[i];t++}}},s.prototype._resetAttributes=function(){this.vertices.length=0,this.coordinates.length=0,this.indices.length=0,this.colors.length=0},s.prototype.draw=function(){if(i.prototype.draw.apply(this,arguments),0!==this.vertices.length){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),a.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),a.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),a.A_ITEM_SIZE);for(var o in this.objects){var r=this.objects[o].texture;this._setupTexture("uSampler",0,r);break}t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}},s.prototype._setupAttribute=function(t,e,o,i){var r=this.core.gl,n=this.shader();r.bindBuffer(r.ARRAY_BUFFER,e),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),r.enableVertexAttribArray(n.attribute_locations[t]),r.vertexAttribPointer(n.attribute_locations[t],i,r.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,o){var i=this.core.gl,r=this.shader();i.activeTexture(i["TEXTURE"+e]),i.bindTexture(i.TEXTURE_2D,o),i.uniform1i(r.uniform_locations[t],e)},s.prototype.afterDraw=function(){i.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},s.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},s.prototype.remove=function(t){delete this.objects[t]},s.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var o=this.objects[e];t.checkCollision(o)&&(t.onCollision(o),o.onCollision(t))}},s.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var o in t.objects)if(this.objects[e].checkCollision(t.objects[o])){var i=this.objects[e],r=t.objects[o];if(i.onCollision(r),r.onCollision(i),!this.objects[e])break}},s.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},s.prototype.shader=function(){return this.core.sprite_3d_shader},e.exports=s},{"../constant/webgl":8,"../util":53,"./base":32,"gl-matrix":20}],36:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t){i.apply(this,arguments),this.current_sprite_index=0};r.inherit(n,i),n.prototype.init=function(){i.prototype.init.apply(this,arguments),this.current_sprite_index=0},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},n.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var o=r.thetaToRadian(this._velocity.theta+this.rotateAdjust());e.rotate(o);var n=this.spriteWidth(),a=this.spriteHeight();n||(n=t.width),a||(a=t.height);var s=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.globalAlpha=this.alpha(),e.drawImage(t,n*this.spriteIndexX(),a*this.spriteIndexY(),n,a,-s/2,-u/2,s,u),e.restore()}i.prototype.draw.apply(this,arguments)},n.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},n.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},n.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},n.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},n.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},n.prototype.isShow=function(){return!0},n.prototype.spriteAnimationSpan=function(){return 0},n.prototype.spriteIndices=function(){return[{x:0,y:0}]},n.prototype.spriteWidth=function(){return 0},n.prototype.spriteHeight=function(){return 0},n.prototype.rotateAdjust=function(){return 0},n.prototype.scale=function(){return 0},n.prototype.scaleWidth=function(){return 1},n.prototype.scaleHeight=function(){return 1},n.prototype.isReflect=function(){return!1},n.prototype.alpha=function(){return 1},e.exports=n},{"../util":53,"./base":32}],37:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=t("../constant/webgl").SPRITE3D,a=t("gl-matrix"),s=function(t){i.apply(this,arguments),this.current_sprite_index=0,this._z=0,this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[],this.vertices.length=n.V_SIZE,this.coordinates.length=n.C_SIZE,this.indices.length=n.I_SIZE,this.colors.length=n.A_SIZE;var e=this.core.gl;this.vBuffer=e.createBuffer(),this.cBuffer=e.createBuffer(),this.iBuffer=e.createBuffer(),this.aBuffer=e.createBuffer(),this.texture=null,this.mvMatrix=a.mat4.create(),this.pMatrix=a.mat4.create()};r.inherit(s,i),s.prototype.init=function(){i.prototype.init.apply(this,arguments),this.current_sprite_index=0,this._initmvpMatrix(),this._initVertices(),this._initCoordinates(),this._initIndices(),this._initColors(),this._initTexture()},s.prototype._initmvpMatrix=function(){a.mat4.identity(this.mvMatrix),a.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},s.prototype._initVertices=function(){var t=this.spriteWidth()/2,e=this.spriteHeight()/2;this.vertices[0]=-t,this.vertices[1]=-e,this.vertices[2]=-1,this.vertices[3]=t,this.vertices[4]=-e,this.vertices[5]=-1,this.vertices[6]=t,this.vertices[7]=e,this.vertices[8]=-1,this.vertices[9]=-t,this.vertices[10]=e,this.vertices[11]=-1},s.prototype._initCoordinates=function(){var t=this.core.image_loader.getImage(this.spriteName()),e=this.spriteWidth()/t.width,o=this.spriteHeight()/t.height,i=e*this.spriteIndexX(),r=o*this.spriteIndexY(),n=i+e,a=r+o;this.coordinates[0]=i,this.coordinates[1]=a,this.coordinates[2]=n,this.coordinates[3]=a,this.coordinates[4]=n,this.coordinates[5]=r,this.coordinates[6]=i,this.coordinates[7]=r},s.prototype._initIndices=function(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3},s.prototype._initColors=function(){this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1,this.colors[12]=1,this.colors[13]=1,this.colors[14]=1,this.colors[15]=1},s.prototype._initTexture=function(){var t=this.core.gl,e=this.core.image_loader.getImage(this.spriteName()),o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this.texture=o},s.prototype._setOrthographicProjection=function(){a.mat4.identity(this.pMatrix);var t=.1,e=10;a.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,t,e)},s.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0)),this._initVertices(),this._initCoordinates(),this._translate()},s.prototype._translate=function(){for(var t=0;t<n.V_ITEM_NUM;t++)this.vertices[t*n.V_ITEM_SIZE+0]+=this.x(),this.vertices[t*n.V_ITEM_SIZE+1]-=this.y(),this.vertices[t*n.V_ITEM_SIZE+2]+=this.z()},s.prototype._rotate=function(){for(var t=this._getRadian(),e=0;e<n.V_ITEM_NUM;e++){var o=this.vertices[e*n.V_ITEM_SIZE+0],i=this.vertices[e*n.V_ITEM_SIZE+1];this.vertices[e*n.V_ITEM_SIZE+0]=o*Math.cos(t)-i*Math.sin(t),this.vertices[e*n.V_ITEM_SIZE+1]=o*Math.sin(t)+i*Math.cos(t)}},s.prototype._getRadian=function(){var t=this.velocity.theta;return r.thetaToRadian(t)},s.prototype.draw=function(){if(this.isShow()){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),n.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),n.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),n.A_ITEM_SIZE),this._setupTexture("uSampler",0,this.texture),t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.setupAdditionalVariables(),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}i.prototype.draw.apply(this,arguments)},s.prototype._setupAttribute=function(t,e,o,i){var r=this.core.gl,n=this.shader();r.bindBuffer(r.ARRAY_BUFFER,e),r.bufferData(r.ARRAY_BUFFER,o,r.STATIC_DRAW),r.enableVertexAttribArray(n.attribute_locations[t]),
r.vertexAttribPointer(n.attribute_locations[t],i,r.FLOAT,!1,0,0)},s.prototype._setupTexture=function(t,e,o){var i=this.core.gl,r=this.shader();i.activeTexture(i["TEXTURE"+e]),i.bindTexture(i.TEXTURE_2D,o),i.uniform1i(r.uniform_locations[t],e)},s.prototype.z=function(t){return"undefined"!=typeof t&&(this._z=t),this._z},s.prototype.shader=function(){return this.core.sprite_3d_shader},s.prototype.setupAdditionalVariables=function(){},s.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},s.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},s.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},s.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},s.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},s.prototype.isShow=function(){return!0},s.prototype.spriteAnimationSpan=function(){return 0},s.prototype.spriteIndices=function(){return[{x:0,y:0}]},s.prototype.spriteWidth=function(){return 0},s.prototype.spriteHeight=function(){return 0},s.prototype.rotateAdjust=function(){return 0},s.prototype.scaleWidth=function(){return 1},s.prototype.scaleHeight=function(){return 1},s.prototype.isReflect=function(){return!1},e.exports=s},{"../constant/webgl":8,"../util":53,"./base":32,"gl-matrix":20}],38:[function(t,e,o){"use strict";var i=t("../base"),r=t("../../util"),n=function(t,e){i.apply(this,arguments),e=e||{},this._default_property={x:e.x||0,y:e.y||0,children:e.children||[]},this._event_to_callback={beforedraw:function(){}},this.objects=this._default_property.children,this._show_call_count=0};r.inherit(n,i),n.prototype.init=function(){this.objects=this._default_property.children,i.prototype.init.apply(this,arguments),this._show_call_count=0,this.x(this._default_property.x),this.y(this._default_property.y),this.show()},n.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},n.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},n.prototype._callEvent=function(t){this._event_to_callback[t].apply(this)},n.prototype.isEventSet=function(t){return this._event_to_callback[t]?!0:!1},n.prototype.beforeDraw=function(){if(i.prototype.beforeDraw.apply(this,arguments),this._callEvent("beforedraw"),this.isEventSet("click")&&this.core.input_manager.isLeftClickPush()){var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();this.checkCollisionWithPosition(t,e)&&this._callEvent("click")}},n.prototype.draw=function(){i.prototype.draw.apply(this,arguments)},n.prototype.isShow=function(){return this._show_call_count>0},n.prototype.collisionWidth=function(){return this.width()},n.prototype.collisionHeight=function(){return this.height()},n.prototype.show=function(){++this._show_call_count},n.prototype.hide=function(){--this._show_call_count},e.exports=n},{"../../util":53,"../base":32}],39:[function(t,e,o){"use strict";var i=t("./base"),r=t("../../util"),n=function(t,e){i.apply(this,arguments),e=e||{},this._default_property=r.assign(this._default_property,{width:e.width||0,height:e.height||0,backgroundColor:e.backgroundColor||null})};r.inherit(n,i),r.defineProperty(n,"width"),r.defineProperty(n,"height"),r.defineProperty(n,"backgroundColor"),n.prototype.init=function(){i.prototype.init.apply(this,arguments),this.width(this._default_property.width),this.height(this._default_property.height),this.backgroundColor(this._default_property.backgroundColor)},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},n.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;this.backgroundColor()&&(t.save(),t.translate(this.x(),this.y()),t.fillStyle=this.backgroundColor(),t.fillRect(-this.width()/2,-this.height()/2,this.width(),this.height()),t.restore()),i.prototype.draw.apply(this,arguments)}},e.exports=n},{"../../util":53,"./base":38}],40:[function(t,e,o){"use strict";var i=t("./base"),r=t("../../util"),n=function(t,e){i.apply(this,arguments),e=e||{},this._default_property=r.assign(this._default_property,{image_name:e.image_name||null,scale:e.scale||1,width:e.width||null,height:e.height||null})};r.inherit(n,i),r.defineProperty(n,"image_name"),r.defineProperty(n,"scale"),r.defineProperty(n,"width"),r.defineProperty(n,"height"),n.prototype.init=function(){if(i.prototype.init.apply(this,arguments),this.image_name(this._default_property.image_name),this.scale(this._default_property.scale),this.width(this._default_property.width),this.height(this._default_property.height),!this.width()&&!this.height()){var t=this.core.image_loader.getImage(this.image_name());this.width(t.width*this.scale()),this.height(t.height*this.scale())}},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},n.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.image_name()),e=t.width*this.scale(),o=t.height*this.scale(),r=this.core.ctx;r.save(),r.translate(this.x(),this.y()),r.drawImage(t,-e/2,-o/2,e,o),r.restore(),i.prototype.draw.apply(this,arguments)}},e.exports=n},{"../../util":53,"./base":38}],41:[function(t,e,o){"use strict";var i=16,r=t("./base"),n=t("../../util"),a=function(t,e){r.apply(this,arguments),e=e||{},this._default_property=n.assign(this._default_property,{size:e.size||"",color:e.color||"black"})};n.inherit(a,r),n.defineProperty(a,"size"),n.defineProperty(a,"color"),a.prototype.init=function(){r.prototype.init.apply(this,arguments),this.size(this._default_property.size),this.color(this._default_property.color),this._start=new Date},a.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},a.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx,e=Math.floor(this.frame_count/60*i)/i;t.save(),t.translate(this.x(),this.y()),t.rotate(2*Math.PI*e);for(var o=0;i>o;o++)t.beginPath(),t.rotate(2*Math.PI/i),t.moveTo(this.size()/10,0),t.lineTo(this.size()/4,0),t.lineWidth=this.size()/30,t.globalAlpha=o/i,t.strokeStyle=this.color(),t.stroke();t.restore(),r.prototype.draw.apply(this,arguments)}},a.prototype.width=function(){return this.size()/2},a.prototype.height=function(){return this.size()/2},e.exports=a},{"../../util":53,"./base":38}],42:[function(t,e,o){"use strict";var i=t("./base"),r=t("../../util"),n=function(t,e){i.apply(this,arguments),e=e||{},this._default_property=r.assign(this._default_property,{text:e.text||"",textColor:e.textColor||"black",textSize:e.textSize||"24px",textAlign:e.textAlign||"left"})};r.inherit(n,i),r.defineProperty(n,"text"),r.defineProperty(n,"textColor"),r.defineProperty(n,"textSize"),r.defineProperty(n,"textAlign"),n.prototype.init=function(){i.prototype.init.apply(this,arguments),this.text(this._default_property.text),this.textColor(this._default_property.textColor),this.textSize(this._default_property.textSize),this.textAlign(this._default_property.textAlign)},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},n.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;t.save(),t.fillStyle=this.textColor(),t.textAlign=this.textAlign(),t.font=this.textSize()+" 'sans-serif'",t.fillText(this.text(),this.x(),this.y()),t.restore(),i.prototype.draw.apply(this,arguments)}},e.exports=n},{"../../util":53,"./base":38}],43:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t,e,o,n,a,s){i.apply(this,arguments),this.x(e),this.y(o),this._width=n,this._height=a,this._draw_function=null,"undefined"!=typeof s&&(this._draw_function=r.bind(s,this)),this._is_show_rect=!1,this._collision_callback=null};r.inherit(n,i),n.prototype.onCollision=function(t){this._collision_callback&&this._collision_callback(t)},n.prototype.collisionWidth=function(){return this._width},n.prototype.collisionHeight=function(){return this._height},n.prototype.setShowRect=function(){return this._is_show_rect=!0,this},n.prototype.setVariable=function(t,e){return this[t]=e,this},n.prototype.setCollisionCallback=function(t){this._collision_callback=r.bind(t,this)},n.prototype.draw=function(){i.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),this._draw_function&&this._draw_function(),t.restore(),this._is_show_rect&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},e.exports=n},{"../util":53,"./base":32}],44:[function(t,e,o){"use strict";var i=t("../object/base"),r=t("../util"),n=function(t){this.core=t,this.parent=null,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this.scenes={},this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null,this._background_color=null,this.ui=new a(this),this.addObject(this.ui)};n.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this._x=0,this._y=0,this.frame_count=0,this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},n.prototype.beforeDraw=function(){this._wait_to_start_bgm_name&&this.frame_count-this._wait_to_start_bgm_start_frame_count>=this._wait_to_start_bgm_duration&&(this.core.audio_loader.playBGM(this._wait_to_start_bgm_name),this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null),this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw(),this.frame_count++},n.prototype.draw=function(){this._drawBackground();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},n.prototype._drawBackground=function(){var t=this.core.ctx;this._background_color&&(t.save(),t.fillStyle=this._background_color,t.fillRect(0,0,this.width,this.height),t.restore())},n.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},n.prototype.addObject=function(t){this.objects.push(t)},n.prototype.addObjects=function(t){this.objects=this.objects.concat(t)},n.prototype.removeAllObject=function(){this.objects=[]},n.prototype.removeObject=function(t){for(var e=0,o=this.objects.length;o>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},n.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},n.prototype.resetParent=function(){this.parent=null},n.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},n.prototype.getSubScene=function(t){return this.scenes[t]},n.prototype.addSubScene=function(t,e){e.setParent(this),this.scenes[t]=e},n.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t,this._is_reserved_next_scene_init=!0,this.current_scene||this.changeNextSubSceneIfReserved()},n.prototype.returnSubScene=function(t){this._reserved_next_scene=[t],this._is_reserved_next_scene_init=!1},n.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene(),e=this._reserved_next_scene;this._reserved_next_scene=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},n.prototype.setWaitToStartBGM=function(t,e){e||(e=0),this._wait_to_start_bgm_name=t,this._wait_to_start_bgm_duration=e,this._wait_to_start_bgm_start_frame_count=this.frame_count},n.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},n.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},n.prototype.root=function(){return this.parent?this.parent.root():this},n.prototype.setBackgroundColor=function(t){this._background_color=t},n.prototype.setFadeIn=function(t,e){return console.error("scene's setFadeIn method is deprecated."),this.core.scene_manager.setFadeIn.apply(this.core.scene_manager,arguments)},n.prototype.isInFadeIn=function(){return console.error("scene's isInFadeIn method is deprecated."),this.core.scene_manager.isInFadeIn.apply(this.core.scene_manager,arguments)},n.prototype.setFadeOut=function(t,e){return console.error("scene's setFadeOut method is deprecated."),this.core.scene_manager.setFadeOut.apply(this.core.scene_manager,arguments)},n.prototype.startFadeOut=function(){return console.error("scene's startFadeOut method is deprecated."),this.core.scene_manager.startFadeOut.apply(this.core.scene_manager,arguments)},n.prototype.isInFadeOut=function(){return console.error("scene's isInFadeOut method is deprecated."),this.core.scene_manager.isInFadeOut.apply(this.core.scene_manager,arguments)},n.prototype.isSetFadeOut=function(){return console.error("scene's isSetFadeOut method is deprecated."),this.core.scene_manager.isSetFadeOut.apply(this.core.scene_manager,arguments)};var a=function(t){i.apply(this,arguments)};r.inherit(a,i),e.exports=n},{"../object/base":32,"../util":53}],45:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t){i.apply(this,arguments),this.next_scene_name=null};r.inherit(n,i),n.prototype.init=function(t,e){i.prototype.init.apply(this,arguments);var o=t.images||[],r=t.sounds||[],n=t.bgms||[],a=t.fonts||[];this.next_scene_name=e;for(var s in o){var u=o[s];"string"==typeof u?this.core.image_loader.loadImage(s,u):this.core.image_loader.loadImage(s,u.path,u.scale_width,u.scale_height)}for(var c in r){var h=r[c];this.core.audio_loader.loadSound(c,h.path,h.volume)}for(var l in n){var _=n[l],p="volume"in _?_.volume:1;this.core.audio_loader.loadBGM(l,_.path,p,_.loopStart,_.loopEnd)}for(var d in a){var f=a[d];this.core.font_loader.loadFont(d,f.path,f.format)}},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.core.isAllLoaded()&&this.notifyAllLoaded()},n.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},n.prototype.draw=function(){i.prototype.draw.apply(this,arguments)},n.prototype.notifyAllLoaded=function(){this.next_scene_name&&this.core.scene_manager.changeScene(this.next_scene_name)},e.exports=n},{"../util":53,"./base":44}],46:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t){i.apply(this,arguments),this.video=null,this.next_scene_name_and_args=null,this.is_playing=!1,this._height=null,this._width=null,this._top=null,this._left=null,this.is_mute=!1};r.inherit(n,i),n.prototype.init=function(t,e,o){i.prototype.init.apply(this,arguments);var r=this,n=Array.prototype.slice.call(arguments);t=n.shift(),o=n,r.is_playing=!1,r._height=null,r._width=null,r._top=null,r._left=null,r.next_scene_name_and_args=null,o.length>0&&(r.next_scene_name_and_args=o),this.core.audio_loader.stopBGM();var a=document.createElement("video");a.src=t,a.controls=!1,a.preload="auto",a.oncanplaythrough=function(){r._calcDrawSizeAndPosition(),a.play(),r.is_playing=!0},this.is_mute&&(a.muted=!0),a.load(),r.video=a},n.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.is_playing&&this.video.ended&&this.notifyEnd()},n.prototype.draw=function(){i.prototype.draw.apply(this,arguments);var t=this.core.ctx;t&&(t.save(),t.fillStyle="black",t.fillRect(0,0,this.core.width,this.core.height),this.is_playing&&t.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this._left,this._top,this._width,this._height),t.restore())},n.prototype._calcDrawSizeAndPosition=function(){var t,e,o,i,r=this.width/this.height,n=this.video.videoWidth/this.video.videoHeight;n>=r?(o=this.width,i=this.width/n,e=(this.height-i)/2,t=0):(i=this.height,o=this.height*n,e=0,t=(this.width-o)/2),this._height=i,this._width=o,this._top=e,this._left=t},n.prototype.notifyEnd=function(){this.video=null,this.is_playing=!1,this.next_scene_name_and_args&&this.core.scene_manager.changeScene.apply(this.core.scene_manager,this.next_scene_name_and_args)},e.exports=n},{"../util":53,"./base":44}],47:[function(t,e,o){e.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoordinates;\nattribute vec4 aColor;\n\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n	vTextureCoordinates = aTextureCoordinates;\n	vColor = aColor;\n}\n\n"},{}],48:[function(t,e,o){e.exports="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n	vec4 textureColor = texture2D(uSampler, vTextureCoordinates);\n	gl_FragColor = textureColor * vColor;\n}\n\n"},{}],49:[function(t,e,o){"use strict";var i=(t("gl-matrix"),function(t,e,o,i,r){if(!t)throw new Error("arguments 1 must be WebGLRenderingContext instance");this.gl=t;var n,a=this.createShader(t,t.VERTEX_SHADER,e),s=this.createShader(t,t.FRAGMENT_SHADER,o),u=this.createShaderProgram(t,a,s),c={};for(n=0;n<i.length;n++)c[i[n]]=t.getAttribLocation(u,i[n]);var h={};for(n=0;n<r.length;n++)h[r[n]]=t.getUniformLocation(u,r[n]);this.shader_program=u,this.attribute_locations=c,this.uniform_locations=h});i.prototype.createShader=function(t,e,o){if(e!==t.VERTEX_SHADER&&e!==t.FRAGMENT_SHADER)throw new Error("type must be vertex or fragment");var i=t.createShader(e);if(t.shaderSource(i,o),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw(e===t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(i);return i},i.prototype.createShaderProgram=function(t,e,o){var i=t.createProgram();if(t.attachShader(i,e),t.attachShader(i,o),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("Could not initialize shaders:\n\n"+t.getProgramInfoLog(i));return i},e.exports=i},{"gl-matrix":20}],50:[function(t,e,o){"use strict";var i=t("../util"),r=function(t){t||(t={}),this._data=t};r.KEY=function(){throw new Error("KEY method must be overridden.")},r.localFileDirectory=function(){return"save"},r.prototype.set=function(t,e){this._data[t]=e},r.prototype.get=function(t){return this._data[t]},r.prototype.exists=function(t){return t in this._data},r.prototype.remove=function(t){return delete this._data[t]},r.prototype.isEmpty=function(){return 0===Object.keys(this._data).length},r.prototype.toHash=function(){return i.shallowCopyHash(this._data)},r.isLocalMode=function(){return i.isElectron()?!0:!1},r.prototype.save=function(){var t=this.constructor;t.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},r.prototype._saveToLocalFile=function(){var t=this.constructor,e=window.require("fs"),o=JSON.stringify(this._data),i=t._localFileDirectoryPath(),r=i+t._localFileName(t.KEY());e.existsSync(i)||e.mkdirSync(i),e.writeFileSync(r,o)},r._localFileDirectoryPath=function(){var t=window.require("path"),e=window.require("electron").remote.app,o=e.getPath("appData"),i=e.getName();return t.join(o,i,this.localFileDirectory())},r._localFileName=function(t){return t+".json"},r._localFilePath=function(t){return this._localFileDirectoryPath()+this._localFileName(t)},r.prototype._saveToWebStorage=function(){var t=this.constructor,e=t.KEY(),o=JSON.stringify(this._data);try{window.localStorage.setItem(e,o)}catch(i){}},r.prototype.reload=function(){var t,e=this.constructor;t=e.isLocalMode()?e._loadFromLocalFile():e._loadFromWebStorage(),this._data=t},r.load=function(){var t;t=this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage();var e=this;return t?new e(t):new e},r._loadFromLocalFile=function(){var t=window.require("fs"),e=this._localFilePath(this.KEY());if(!t.existsSync(e))return null;var o=t.readFileSync(e,{encoding:"utf8"});return o?JSON.parse(o):null},r._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(o){}return t?JSON.parse(t):null},r.prototype.del=function(){var t=this.constructor;t.isLocalMode()?this._removeLocalFile():this._removeWebStorage(),this._data={}},r.prototype._removeLocalFile=function(){var t=this.constructor,e=window.require("fs"),o=t._localFilePath(t.KEY());e.existsSync(o)&&e.unlinkSync(o)},r.prototype._removeWebStorage=function(){var t=this.constructor,e=t.KEY();try{window.localStorage.removeItem(e)}catch(o){}},e.exports=r},{"../util":53}],51:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t){i.apply(this,arguments)};r.inherit(n,i);var a="hakurei_engine",s="save";n.KEY=function(){return!this.isLocalMode()&&window&&window.location?[a,s,window.location.pathname].join(":"):s},e.exports=n},{"../util":53,"./base":50}],52:[function(t,e,o){"use strict";var i=t("./base"),r=t("../util"),n=function(t){i.apply(this,arguments)};r.inherit(n,i);var a="hakurei_engine",s="scenario";n.KEY=function(){return!this.isLocalMode()&&window&&window.location?[a,s,window.location.pathname].join(":"):s},n.prototype.getSerifStatus=function(t){var e=this.get(t);return e||(e={}),e},n.prototype.getPlayedCount=function(t){var e=this.getSerifStatus(t);return e.played_count||0},n.prototype.incrementPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=e.played_count||0,e.played_count++,this.set(t,e)},e.exports=n},{"../util":53,"./base":50}],53:[function(t,e,o){"use strict";var i={inherit:function(t,e){var o=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=o(e.prototype),t.prototype.constructor=t;for(var i in e)t[i]=e[i]},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(i.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(i.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,o=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return"rgb("+o+", "+i+", "+r+")"},clamp:function(t,e,o){return e>t?e:t>o?o:t},isElectron:function(){return"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?!0:!1},canPlayOgg:function(){var t=document.createElement("audio");return t.canPlayType?t.canPlayType("audio/ogg"):!1},getRandomInt:function(t,e){return 1===arguments.length&&(e=arguments[0],t=1),Math.floor(Math.random()*(e-t+1))+t},downloadBlob:function(t,e){var o=window.URL||window.webkitURL,i=o.createObjectURL(t),r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=i,n.download=e,n.dispatchEvent(r)},shallowCopyHash:function(t){var e={};for(var o in t)e[o]=t[o];return e},assign:function(t,e){if(!t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o},bind:function(t,e){if("function"!=typeof t)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var o=Array.prototype.slice.call(arguments,1),i=t,r=function(){},n=function(){return i.apply(t instanceof r?t:e,o.concat(Array.prototype.slice.call(arguments)))};return t.prototype&&(r.prototype=t.prototype),n.prototype=new r,n},defineProperty:function(t,e){var o="_"+e;t.prototype[e]=function(t){return"undefined"!=typeof t&&(this[o]=t),this[o]}}};e.exports=i},{}],54:[function(t,e,o){"use strict";var i,r=t("./game");window.onload=function(){var t=document.getElementById("mainCanvas"),e={};i=new r(t,e),i.setupEvents(),i.init(),i.startRun()},window.require&&window.require("electron").webFrame.setVisualZoomLevelLimits(1,1)},{"./game":2}],55:[function(t,e,o){"use strict";var i=t("../hakurei").scene.base,r=t("../hakurei").util,n=t("../assets_config"),a=function(t){i.apply(this,arguments)};r.inherit(a,i),a.prototype.init=function(){i.prototype.init.apply(this,arguments);var t=r.canPlayOgg()?".ogg":".m4a";for(var e in n.images)this.core.image_loader.loadImage(e,n.images[e]);for(var o in n.sounds){var a=n.sounds[o];this.core.audio_loader.loadSound(o,a.path+t,a.volume)}for(var s in n.bgms){var u=n.bgms[s];this.core.audio_loader.loadBGM(s,u.path,1,u.loopStart,u.loopEnd)}},a.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.audio_loader.isAllLoaded()&&this.core.scene_manager.changeScene("main")},a.prototype.draw=function(){i.prototype.draw.apply(this,arguments);var t=this.core.ctx;if(t){t.save(),t.fillStyle="white",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,o=15,r="";r=o>e&&e>=0?"":2*o>e&&e>=1*o?".":3*o>e&&e>=2*o?"..":"...",t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="left",t.font="30px 'OradanoGSRR'",t.fillText("Now Loading"+r,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="rgb(119, 66, 244)",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()}},a.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},e.exports=a},{"../assets_config":1,"../hakurei":3}],56:[function(t,e,o){"use strict";var i=t("../hakurei").scene.base,r=t("../hakurei").util,n=t("../hakurei").object.ui_parts,a=100,s=5,u=1200,c=function(t){i.apply(this,arguments);var e=this;e.ui_parts=[],e.renko_canvas=null,e.renko=new n(e,this.width/2,this.height/2,400,320,function(){this.core.input_manager.isLeftClickDown()?this.size>.5&&(this.size-=.05):1>this.size&&(this.size+=.05);var t=this.core.ctx;t.save(),t.translate(this.x(),this.y()),t.drawImage(e.renko_canvas,-e.renko_canvas.width/2*this.size,-e.renko_canvas.height/2*this.size,e.renko_canvas.width*this.size,e.renko_canvas.height*this.size),t.restore()}),e.renko.setVariable("size",1)};r.inherit(c,i),c.prototype.init=function(t,e){i.prototype.init.apply(this,arguments),this.removeAllObject(),this.renko_canvas=this._createRenko("00","00","00"),this.renko.init(),this.score=0,this._renko_chan_score=0,this._renko_chan_time=0,this.is_renko_chan_time=!1,this._renko_chan_time_logo=0},c.prototype.beforeDraw=function(){if(i.prototype.beforeDraw.apply(this,arguments),this.renko.beforeDraw(),this.removeOutOfStageObjects(),this.core.input_manager.isLeftClickPush()){var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();if(this.renko.checkCollisionWithPosition(t,e)){if(this.is_renko_chan_time){for(var o=10,r=0,n=o;n>r;r++)this.addObject(this._createMerry());this.score+=o}else this.addObject(this._createMerry()),this.score+=1,this._renko_chan_score+=1;this.core.audio_loader.playSound("got")}}!this.is_renko_chan_time&&this._renko_chan_score>=a?(this.is_renko_chan_time=!0,this._renko_chan_score=0,this._renko_chan_time=u,this._renko_chan_time_logo=0,this.core.audio_loader.playSound("flash")):this.is_renko_chan_time&&(this._renko_chan_time<=0?(this.is_renko_chan_time=!1,this._renko_chan_time=0):(this._renko_chan_time--,this._renko_chan_time_logo<100&&(this._renko_chan_time_logo+=2)))},c.prototype.draw=function(){var t=this.core.ctx;if(this.is_renko_chan_time){var e=this.core.image_loader.getImage("bg_super");t.drawImage(e,0,0,e.width,e.height,0,0,this.core.width,this.core.height)}else t.fillStyle="white",t.fillRect(0,0,this.width,this.height);i.prototype.draw.apply(this,arguments),this.renko.draw(),t.font="48px 'Comic Sans MS'",t.textAlign="right",t.textBaseAlign="middle",t.fillStyle="rgb( 0, 0, 0 )",t.fillText("Score: "+this.score,this.width-10,this.height-10),this._showGauge(),this._showLogo(),t.restore()},c.prototype._createRenko=function(){var t=window.document.createElement("canvas");t.width=400,t.height=320;var e=t.getContext("2d"),o=this.core.image_loader.getImage("renko_base");e.drawImage(o,0,0,o.width,o.height);var i=this.core.image_loader.getImage("renko_eye_00");e.drawImage(i,0,0,i.width,i.height);var r=this.core.image_loader.getImage("renko_eyebrow_00");e.drawImage(r,0,0,r.width,r.height);var n=this.core.image_loader.getImage("renko_mouse_00");return e.drawImage(n,0,0,n.width,n.height),t},c.prototype._createMerry=function(){var t=window.document.createElement("canvas");t.width=400,t.height=320;var e=t.getContext("2d"),o=this.core.image_loader.getImage("merry_base");e.drawImage(o,0,0,o.width,o.height);var i=this.core.image_loader.getImage("merry_eye_00");e.drawImage(i,0,0,i.width,i.height);var r=this.core.image_loader.getImage("merry_eyebrow_00");e.drawImage(r,0,0,r.width,r.height);var a=this.core.image_loader.getImage("merry_mouse_00");e.drawImage(a,0,0,a.width,a.height);var s=Math.floor(Math.random()*this.width),u=-60,c=Math.floor(360*Math.random()),h=10+Math.floor(5*Math.random());return new n(this,s,u,0,0,function(){this.y(this.y()+h);var e=this.core.ctx;e.save(),e.translate(this.x(),this.y()),e.rotate(c),e.drawImage(t,-t.width/2,-t.height/2,.5*t.width,.5*t.height),e.restore()})},c.prototype._showGauge=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.fillRect(s,s,this._renko_chan_score/a*(this.width-2*s),4*s),t.restore()},c.prototype._showLogo=function(){if(this.is_renko_chan_time){var t=this.core.ctx;t.save();var e=this.core.image_loader.getImage("super_logo");t.translate(this.width/2+50,80);var o=e.width*this._renko_chan_time_logo/100*.5,i=e.height*this._renko_chan_time_logo/100*1;t.drawImage(e,-o/2,-i/2,o,i),t.restore()}};var h=100;c.prototype.removeOutOfStageObjects=function(){for(var t=[],e=0,o=this.objects.length;o>e;e++){var i=this.objects[e];i.x()+h<0||i.y()+h<0||i.x()>this.width+h||i.y()>this.height+h||t.push(i)}this.objects=t},e.exports=c},{"../hakurei":3}]},{},[54]);